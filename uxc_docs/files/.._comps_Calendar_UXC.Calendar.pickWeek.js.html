<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../comps/Calendar/UXC.Calendar.pickWeek.js - UXC jquery components</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../uxc.png" title="UXC jquery components"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/.window.html">.window</a></li>
            
                <li><a href="../classes/UXC.alert.html">UXC.alert</a></li>
            
                <li><a href="../classes/UXC.Calendar.html">UXC.Calendar</a></li>
            
                <li><a href="../classes/UXC.confirm.html">UXC.confirm</a></li>
            
                <li><a href="../classes/UXC.Dialog.html">UXC.Dialog</a></li>
            
                <li><a href="../classes/UXC.Dialog.alert.html">UXC.Dialog.alert</a></li>
            
                <li><a href="../classes/UXC.Dialog.confirm.html">UXC.Dialog.confirm</a></li>
            
                <li><a href="../classes/UXC.Dialog.mask.html">UXC.Dialog.mask</a></li>
            
                <li><a href="../classes/UXC.Form.html">UXC.Form</a></li>
            
                <li><a href="../classes/UXC.hideAllPanel.html">UXC.hideAllPanel</a></li>
            
                <li><a href="../classes/UXC.hideAllPopup.html">UXC.hideAllPopup</a></li>
            
                <li><a href="../classes/UXC.LunarCalendar.html">UXC.LunarCalendar</a></li>
            
                <li><a href="../classes/UXC.LunarCalendar.Model.html">UXC.LunarCalendar.Model</a></li>
            
                <li><a href="../classes/UXC.LunarCalendar.View.html">UXC.LunarCalendar.View</a></li>
            
                <li><a href="../classes/UXC.Panel.html">UXC.Panel</a></li>
            
                <li><a href="../classes/UXC.Panel.Model.html">UXC.Panel.Model</a></li>
            
                <li><a href="../classes/UXC.Panel.View.html">UXC.Panel.View</a></li>
            
                <li><a href="../classes/UXC.Slider.html">UXC.Slider</a></li>
            
                <li><a href="../classes/UXC.Slider.Model.html">UXC.Slider.Model</a></li>
            
                <li><a href="../classes/UXC.Tab.html">UXC.Tab</a></li>
            
                <li><a href="../classes/UXC.Tab.Model.html">UXC.Tab.Model</a></li>
            
                <li><a href="../classes/UXC.Tab.View.html">UXC.Tab.View</a></li>
            
                <li><a href="../classes/UXC.Test.html">UXC.Test</a></li>
            
                <li><a href="../classes/UXC.Tips.html">UXC.Tips</a></li>
            
                <li><a href="../classes/UXC.Tips.Model.html">UXC.Tips.Model</a></li>
            
                <li><a href="../classes/UXC.Tips.View.html">UXC.Tips.View</a></li>
            
                <li><a href="../classes/UXC.Tree.html">UXC.Tree</a></li>
            
                <li><a href="../classes/UXC.Tree.Model.html">UXC.Tree.Model</a></li>
            
                <li><a href="../classes/UXC.Valid.html">UXC.Valid</a></li>
            
                <li><a href="../classes/window.jQuery.html">window.jQuery</a></li>
            
                <li><a href="../classes/window.UXC.html">window.UXC</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ../comps/Calendar/UXC.Calendar.pickWeek.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
(function($){
    /**
     * 弹出一年中所有周的选择框
     * @method  pickWeek
     * @for     UXC.Calendar
     * @static
     * @param   {selector}  _selector
     */
    UXC.Calendar.pickWeek =
        function( _selector ){
            _logic.lastDateObj = UXC.Calendar.getDate( _selector );
            UXC.Calendar.lastIpt = _selector;
            UXC.Calendar.setPosition( _selector, _logic.update( _logic.lastDateObj ) );
        };
    /**
     * 自定义周弹框的模板HTML
     * @for         UXC.Calendar
     * @property    pickWeek.tpl
     * @type        string
     * @default     empty
     * @static
     */
    UXC.Calendar.pickWeek.tpl = &#x27;&#x27;;
    /**
     * 自定义周日历每周的起始日期 
     * &lt;br /&gt; 0 - 6, 0=周日, 1=周一
     * @for         UXC.Calendar
     * @property    pickWeek.dayOffset
     * @static
     * @type    int
     * @default 1
     */
    UXC.Calendar.pickWeek.dayOffset = 1;

    var _logic = {
        getLayout:
            function(){
                var _box
                if( !( _box = $(&#x27;#UXCCalendar_week&#x27;) ).length ){
                    _box = $( UXC.Calendar.pickWeek.tpl || _logic.tpl ); 
                    _box.appendTo( document.body );
                    _box.data(&#x27;confirmMethod&#x27;, _logic.onConfirm );
                    _box.data(&#x27;updateYearMethod&#x27;, _logic.updateYear );
                    _box.data(&#x27;nextYearMethod&#x27;, _logic.nextYear );
                    _box.data(&#x27;preYearMethod&#x27;, _logic.preYear );
                }
                return _box;
            }

        , onConfirm:
            function(){
                UXC.log( &#x27;Calendar.pickWeek, onConfirm&#x27; );
                var _cur = _logic.getLayout().find(&#x27;td.cur&#x27;);
                if( !_cur.length ) _logic.getLayout().find(&#x27;td.today&#x27;);
                if( _cur.length ) _cur.find(&#x27;a&#x27;).trigger(&#x27;click&#x27;);
            }
        , updateYear:
            function( _val ){
                if( !_logic.lastDateObj ) return;
                _logic.lastDateObj.date.setFullYear( _val );
                UXC.Calendar.updateInitYearList( _logic.lastDateObj );
                _logic.update( _logic.lastDateObj );
            }
        , nextYear:
            function(){
                UXC.log( &#x27;nextYearMethod&#x27; );
                if( !_logic.lastDateObj ) return;
                _logic.updateYear( _logic.lastDateObj.date.getFullYear() + 1)
            }
        , preYear:
            function(){
                UXC.log( &#x27;preYearMethod&#x27; );
                if( !_logic.lastDateObj ) return;
                _logic.updateYear( _logic.lastDateObj.date.getFullYear() - 1)
            }
        , update:
            function( _dateObj ){
                _logic.getLayout();
                _logic.updateHead( _dateObj );
                _logic.updateBody( _dateObj );
                return _logic.getLayout();
            }
        , updateHead:
            function( _dateObj ){
                var _layout = _logic.getLayout(), _ls = [], _tmp, _selected
                    , _sYear = _dateObj.initMinvalue.getFullYear()
                    , _eYear = _dateObj.initMaxvalue.getFullYear();


                if( !_selected ) _selected = _dateObj.date.getFullYear();

                for( var i = _sYear; i &lt;= _eYear; i++ ){
                    _tmp = &#x27;&#x27;;
                    if( _selected === i ) _tmp = &quot; selected &quot;
                    _ls.push( &#x27;&lt;option value=&quot;&#x27;+i+&#x27;&quot;&#x27;+_tmp+&#x27;&gt;&#x27;+i+&#x27;&lt;/option&gt;&#x27; );
                }

                $( _ls.join(&#x27;&#x27;) ).appendTo( _layout.find(&#x27;select.UYear&#x27;).html(&#x27;&#x27;) );

            }
        , updateBody:
            function( _dateObj ){
                var _date = _dateObj.date;
                var _layout = _logic.getLayout();
                    _layout.find(&#x27;button.UYearButton&#x27;).html( _date.getFullYear() );

                var today = new Date( new Date().getFullYear(), new Date().getMonth(), new Date().getDate() ).getTime();
                var weeks = weekOfYear( _date.getFullYear(), UXC.Calendar.pickWeek.dayOffset );
                var nextYearWeeks = weekOfYear( _date.getFullYear() + 1, UXC.Calendar.pickWeek.dayOffset );
                var nextCount = 0;
                var _ls = [], _class, _data, _title, _sdate, _edate, _year = _date.getFullYear()
                    , _rows = Math.ceil( weeks.length / 8 );

                var ipt = UXC.Calendar.lastIpt, currentcanselect = parseBool( ipt.attr(&#x27;currentcanselect&#x27;) );

                if( _dateObj.maxvalue &amp;&amp; currentcanselect ){
                    var _wd = _dateObj.maxvalue.getDay();
                    if( _wd &gt; 0 ) {
                        _dateObj.maxvalue.setDate( _dateObj.maxvalue.getDate() + ( 7 - _wd ) );
                    }
                }

                _ls.push(&#x27;&lt;tr&gt;&#x27;);
                for( i = 1, j = _rows * 8; i &lt;= j; i++ ){
                    _data = weeks[ i - 1];
                    if( !_data ) {
                        _data = nextYearWeeks[ nextCount++ ];
                        _year = _date.getFullYear() + 1;
                    }
                    _sdate = new Date(); _edate = new Date();
                    _sdate.setTime( _data.start ); _edate.setTime( _data.end );

                    _title = printf( &quot;{0}年 第{1}周&lt;br/&gt;开始日期: {2} (周{4})&lt;br /&gt;结束日期: {3} (周{5})&quot;
                                , _year
                                , UXC.Calendar.getCnNum( _data.week )
                                , formatISODate( _sdate )
                                , formatISODate( _edate )
                                , UXC.Calendar.cnWeek.charAt( _sdate.getDay() % 7 )
                                , UXC.Calendar.cnWeek.charAt( _edate.getDay() % 7 )
                                );

                    _class = [];

                    if( _dateObj.minvalue &amp;&amp; _sdate.getTime() &lt; _dateObj.minvalue.getTime() ) 
                        _class.push( &#x27;unable&#x27; );
                    if( _dateObj.maxvalue &amp;&amp; _edate.getTime() &gt; _dateObj.maxvalue.getTime() ){
                        _class.push( &#x27;unable&#x27; );
                    }

                    if( _date.getTime() &gt;= _sdate.getTime() &amp;&amp; _date.getTime() &lt;= _edate.getTime() ) _class.push( &#x27;cur&#x27; );
                    if( today &gt;= _sdate.getTime() &amp;&amp; today &lt;= _edate.getTime() ) _class.push( &#x27;today&#x27; );

                    _ls.push( printf( &#x27;&lt;td class=&quot;{0}&quot;&gt;&lt;a href=&quot;javascript:&quot; title=&quot;{2}&quot;&#x27;+
                                    &#x27; dstart=&quot;{3}&quot; dend=&quot;{4}&quot; week=&quot;{1}&quot; &gt;{1}&lt;/a&gt;&lt;/td&gt;&#x27;
                                , _class.join(&#x27; &#x27;)
                                , _data.week 
                                , _title
                                , _sdate.getTime()
                                , _edate.getTime()
                            ));
                    if( i % 8 === 0 &amp;&amp; i != j ) _ls.push( &#x27;&lt;/tr&gt;&lt;tr&gt;&#x27; );
                }
                _ls.push(&#x27;&lt;/tr&gt;&#x27;); 
 
                _layout.find(&#x27;table.UTableBorder tbody&#x27; ).html( $( _ls.join(&#x27;&#x27;) ) );

            }
        /**
         * 最后一个显示日历组件的日期对象
         * @property    _logic.lastDateObj
         * @type        Object
         * @private
         */
        , lastDateObj: null
        , tpl:
            [
            &#x27;&lt;div id=&quot;UXCCalendar_week&quot; class=&quot;UXCCalendar UXCCalendar_week&quot; &gt;&#x27;
            ,&#x27;    &lt;div class=&quot;UHeader&quot;&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UButton UNextYear&quot;&gt;&amp;nbsp;&amp;gt;&amp;gt;&amp;nbsp;&lt;/button&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UButton UPreYear&quot;&gt;&amp;nbsp;&amp;lt;&amp;lt;&amp;nbsp;&lt;/button&gt;&#x27;
            ,&#x27;        &lt;select class=&quot;UYear&quot; style=&quot;&quot;&gt;&lt;/select&gt;&#x27;
            ,&#x27;    &lt;/div&gt;&#x27;
            ,&#x27;    &lt;table class=&quot;UTable UTableBorder&quot;&gt;&#x27;
            ,&#x27;        &lt;tbody&gt;&lt;/tbody&gt;&#x27;
            ,&#x27;    &lt;/table&gt;&#x27;
            ,&#x27;    &lt;div class=&quot;UFooter&quot;&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UConfirm&quot;&gt;确定&lt;/button&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UClear&quot;&gt;清空&lt;/button&gt;&#x27;
            ,&#x27;        &lt;button type=&quot;button&quot; class=&quot;UCancel&quot;&gt;取消&lt;/button&gt;&#x27;
            ,&#x27;    &lt;/div&gt;&#x27;
            ,&#x27;&lt;/div&gt;&#x27;
            ].join(&#x27;&#x27;)
    };
    /**
     * 取一年中所有的星期, 及其开始结束日期
     * @method  weekOfYear
     * @static
     * @param   {int}   _year
     * @param   {int}   _dayOffset  每周的默认开始为周几, 默认0(周日)
     * @return  Array
     */
    function weekOfYear( _year, _dayOffset ){
        var _r = [], _tmp, _count = 1, _dayOffset = _dayOffset || 0
            , _year = parseInt( _year, 10 )
            , _d = new Date( _year, 0, 1 );
        /**
         * 元旦开始的第一个星期一开始的一周为政治经济上的第一周
         */
         _d.getDay() &gt; 1 &amp;&amp; _d.setDate( _d.getDate() - _d.getDay() + 7 );

         _dayOffset &gt; 0 &amp;&amp; ( _dayOffset = (new Date( 2000, 1, 2 ) - new Date( 2000, 1, 1 )) * _dayOffset );

        while( _d.getFullYear() &lt;= _year ){
            _tmp = { &#x27;week&#x27;: _count++, &#x27;start&#x27;: null, &#x27;end&#x27;: null };
            _tmp.start = _d.getTime() + _dayOffset;
            _d.setDate( _d.getDate() + 6 );
            _tmp.end = _d.getTime() + _dayOffset;
            _d.setDate( _d.getDate() + 1 );
            if( _d.getFullYear() &gt; _year ) {
                _d = new Date( _d.getFullYear(), 0, 1 );
                if( _d.getDay() &lt; 2 ) break;
             }
            _r.push( _tmp );
        }
        return _r;
    }

    $(document).delegate(&#x27;#UXCCalendar_week table a&#x27;, &#x27;click&#x27;, function( _evt ){
        var p = $(this), dstart = new Date(), dend = new Date();
        if( !UXC.Calendar.lastIpt ) return;
        if( p.parent(&#x27;td&#x27;).hasClass( &#x27;unable&#x27; ) ) return;
        dstart.setTime( p.attr(&#x27;dstart&#x27;) );
        dend.setTime( p.attr(&#x27;dend&#x27;) );
        UXC.Calendar.lastIpt.val( printf( &#x27;{0} 至 {1}&#x27;, formatISODate( dstart ), formatISODate( dend ) ) );
        UXC.Calendar.hide();
    });

}(jQuery));

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
