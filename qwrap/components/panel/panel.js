(function(){var R=QW.ObjectH.mix,M=QW.ArrayH.remove,H=QW.StringH.format,aa=QW.Browser.ie6,F=QW.DomU,N=F.createElement,I=F.getDocRect,E=QW.NodeH,W=QW.EventTargetH.addEventListener,Q=QW.EventTargetH.removeEventListener,C=E.fire,T=E.hide,ab=E.setStyle,D=E.getXY,O=function(c,e,d,f,a){var b=F.getDocRect();if(f==null){f=(b.width-e)/2+b.scrollX}f=Math.max(Math.min(f,b.scrollX+b.width-e),b.scrollX);if(a==null){a=(b.height-d)/2+b.scrollY}a=Math.max(Math.min(a,b.scrollY+b.height-d),b.scrollY);E.setXY(c,f,a)},X=E.contains,K=E.removeNode,U=QW.EventH,B=U.getTarget,Y=U.getKeyCode,Z=U.preventDefault,S=QW.CustEvent;var L={VERSION:"0.0.1"};(function(){var c=100;var b=[];var d,e=0;function f(){var h=N("div",{className:"mask",tabIndex:-1,unselectable:"on"});if(aa){h.innerHTML='<div unselectable="on"></div><iframe src="'+L.bgIframeSrc+'"></iframe>'}document.body.insertBefore(h,document.body.firstChild);return h}function g(){var i=d.offsetParent,h=document.documentElement,j=d.style;if(parseInt(j.top)!=i.scrollTop||parseInt(j.left)!=i.scrollLeft){j.top=i.scrollTop;j.left=i.scrollLeft}if(h.clientHeight!=d.offsetHeight){j.height=h.clientHeight}if(h.clientWidth!=d.offsetWidth){j.width=h.clientWidth}}function a(h){if(h.keyEsc){Q(document,"keydown",L.keydownHdl);W(document,"keydown",L.keydownHdl)}}R(L,{showPanel:function(r,j,k,i,m,o){if(r._rendered){r.render()}M(b,r);b.push(r);var q=r.oWrap.style;if(r.isVisible){if(q.zIndex!=c){q.zIndex=(c+=2)}}else{q.zIndex=(c+=2)}if(r.withMask){d=d||f();ab(d,{zIndex:c-1,display:"block"});if(aa){g(d);clearInterval(e);e=setInterval(g,1000)}}if(i!=null){q.width=i+"px"}if(m!=null){q.height=m+"px"}if(r.posCenter){var p=L.getWrapSize(r);O(r.oWrap,p[0],p[1],j,k)}else{j=j||0;k=k||0;if(o){var h=D(o);j+=h[0];k+=h[1]}if(r.posAdjust){var p=L.getWrapSize(r);var l=I();j=Math.min(j,l.scrollX+l.width-p[0]);j=Math.max(j,l.scrollX);k=Math.min(k,l.scrollY+l.height-p[1]);k=Math.max(k,l.scrollY)}q.left=j+"px";q.top=k+"px"}if((r.posAdjust||r.posCenter)&&b.length>1){var n=b[b.length-2].oWrap.style;if(n.top==q.top&&n.left==q.left){q.top=(parseInt(q.top)+10)+"px";q.left=(parseInt(q.left)+10)+"px"}}q.display="block";r.isVisible=true;a(r)},hidePanel:function(k){T(k.oWrap);k.isVisible=false;M(b,k);var h=false;for(var i=b.length-1;i>-1;i--){var j=b[i];if(j.withMask){h=true;d.style.zIndex=j.oWrap.style.zIndex-1;break}}if(!h&&d){T(d);clearInterval(e)}},disposePanel:function(i){K(i.oWrap);for(var h in i){i[h]=null}},risePanel:function(j){if(j.isVisible){var i=j.oWrap.style;if(i.zIndex!=c){i.zIndex=(c+=2);M(b,j);b.push(j);if(j.withMask){var h=d.style;h.zIndex=c-1}}}else{alert("程序错误.");throw"错误：还没有打开panel呢."}},keydownHdl:function(h){if(b.length&&Y(h)==27){var i=b[b.length-1];if(i.keyEsc){i.hide();Z(h)}}if(!b.length){Q(document,"keydown",L.keydownHdl)}},getWrapSize:function(i,j,m){var l=i.oWrap,n=l.style;var k=[n.display,n.width,n.height];n.display="block";if(j){n.width=j}if(m){n.height=m}var h=[l.offsetWidth,l.offsetHeight];n.display=k[0];if(k[1]){n.width=k[1]}if(k[2]){n.height=k[2]}return h},bgIframeSrc:"about:blank"})}());function G(a){R(this,a,1);if(!this.lazyRender){this.render()}return this}(function(){G.EVENTS=["beforeshow","aftershow","beforehide","afterhide"];function a(b,c){c=c||"";if(c.tagName){b.innerHTML="";b.appendChild(c)}else{b.innerHTML=c}}G._elHtml={content:'<div class="panel-content" remark="oContent"><div class="hd"></div><div class="bd"></div><div class="ft"></div></div>',closeHdl:'<span class="close"></span>',resizeHdl:'<span class="resize"><span></span></span>',corner1:'<span class="co1"><span></span></span>',corner2:'<span class="co2"><span></span></span>',cue:'<span class="cue"></span>',shadow:'<span class="sd"></span>',bgIframe:'<iframe class="panel-iframe" src="'+L.bgIframeSrc+'" FRAMEBORDER=0 height="100%"></iframe>'};G.prototype={defaultClassName:"panel",wrapId:"",className:"",title:"",header:"",body:"Panel Body",footer:"",withCorner:0,withCue:0,withShadow:0,withClose:0,withBgIframe:aa,withMask:0,dragable:0,resizable:0,keyEsc:0,posCenter:0,posAdjust:0,isVisible:false,oWrap:null,oContent:null,oHeader:null,oBody:null,oFooter:null,oCloseHdl:null,oResizeHdl:null,oShadow:null,oCue:null,oCorner1:null,oCorner2:null,oBgIframe:null,render:function(){var d=this;if(d._rendered){return}var c=N("div",{className:d.defaultClassName+" "+(d.className||"")});c.style.display="none";d.oWrap=c;if(d.wrapId){c.id=d.wrapId}T(c);var h=G._elHtml;var e=[h.content,d.withClose?h.closeHdl:"",d.resizable?h.resizeHdl:"",d.withCorner?(h.corner1+h.corner2):"",d.withCue?h.cue:"",d.withShadow?h.shadow:"",(d.withBgIframe&&aa)?h.bgIframe:""];c.innerHTML=e.join("");var f=c.childNodes;d.oContent=f[0];var g=1;if(d.withClose){d.oCloseHdl=f[g++]}if(d.resizable){d.oResizeHdl=f[g++]}if(d.withCorner){d.oCorner1=f[g++];d.oCorner2=f[g++]}if(d.withCue){d.oCue=f[g++]}if(d.withShadow){d.oShadow=f[g++]}if(d.withBgIframe&&aa){d.oBgIframe=f[g++]}var f=d.oContent.childNodes;d.oHeader=f[0];d.oBody=f[1];d.oFooter=f[2];d.isVisible=false;var b=(d.title&&"<h3>"+d.title+"</h3>")||d.header;if(b){a(d.oHeader,b)}if(d.body){a(d.oBody,d.body)}if(d.footer){a(d.oFooter,d.footer)}if(d.withClose){W(d.oCloseHdl,"click",function(){d.hide()})}if(d.dragable){d.initDrag()}if(d.resizable){d.initResize()}document.body.insertBefore(c,document.body.firstChild);S.createEvents(d,G.EVENTS);d._rendered=true},show:function(f,b,e,c,d){if(this._rendered){this.render()}if(this.fire("beforeshow")==false){return false}L.showPanel(this,f,b,e,c,d);this.fire("aftershow");return true},hide:function(){if(this.fire("beforehide")==false){return false}L.hidePanel(this);this.fire("afterhide");return true},dispose:function(){if(this.isVisible){return false}else{L.disposePanel(this)}},rise:function(){L.risePanel(this)},initDrag:function(){var c=this;var b=new QW.SimpleDrag({oSrc:this.oWrap,oHdl:this.oHeader,minXAttr:1,minYAttr:1,withProxy:true});b.on("dragstart",function(){c.rise()})},initResize:function(){var c=this;var b=new QW.SimpleResize({oSrc:this.oWrap,oHdl:this.oResizeHdl,minXAttr:150,yFixed:true,withProxy:true});b.on("dragstart",function(){c.rise()})}}}());function V(a){R(this,a,1);if(!this.lazyRender){this.render()}return this}(function(){V.MENTOR_CLASS=G;V.prototype={posAdjust:1,defaultClassName:"panel panel-popup",relatedEls:null,_refreshBlurHdl:function(a){if(this._fnBlur){Q(document,"keydown",this._fnBlur);Q(document,"keyup",this._fnBlur);Q(document,"mousedown",this._fnBlur);if(a){W(document,"keydown",this._fnBlur);W(document,"keyup",this._fnBlur);W(document,"mousedown",this._fnBlur)}}},show:function(f,a,e,c,d){var b=this;if(b._rendered){b.render()}b._fnBlur=b._fnBlur||function(h){var i=B(h)||document.body;if(!b.oWrap){return}var g=b.relatedEls||[];g.push(b.oWrap);for(var j=0;j<g.length;j++){var k=g[j];if(k==i||X(k,i)){return}}b.hide()};if(b.fire("beforeshow")==false){return false}L.showPanel(b,f,a,e,c,d);b._refreshBlurHdl(true);b.fire("aftershow");return true},hide:function(){if(this.fire("beforehide")==false){return false}L.hidePanel(this);this._refreshBlurHdl(false);this.fire("afterhide");return true},setContent:function(a){}};R(V.prototype,G.prototype)}());function P(a){R(this,a,1);if(!this.lazyRender){this.render()}return this}(function(){P.MENTOR_CLASS=G;P.prototype={defaultClassName:"panel panel-dialog",withMask:1,withClose:1,dragable:!!QW.SimpleDrag};R(P.prototype,G.prototype)}());var J=(function(){var b={alert:'<div class="panel-dialog-sys panel-alert cls"><div class="msg">{0}</div><div class="btn-ctn"><button>确定</button></div></div>',confirm:'<div class="panel-dialog-sys panel-confirm cls"><div class="msg">{0}</div><div class="btn-ctn"><button>确定</button><button>取消</button></div></div>',prompt:'<div class="panel-dialog-sys panel-prompt cls"><div class="msg">{0}</div><div class="ipt-ctn"><input type="text-input"></div><div class="btn-ctn"><button>确定</button><button>取消</button></div></div>',msgbox:'<div class="panel-dialog-sys panel-msgbox cls"><div class="msg">{0}</div><div class="btn-ctn"><button>是(Yes)</button><button>否(No)</button><button>取消</button></div></div>'};var a={getSysDialog:function(g,d,c,e){e=e||{};R(e,{posCenter:1,keyEsc:1,title:"系统提示",dragable:!!QW.SimpleDrag,body:H(b[g]||"error",d)});var i=new P(e);var f=i.oWrap.getElementsByTagName("button");i.dialogButtons=f;switch(g){case"alert":W(f[0],"click",function(j){i.hide()});break;case"confirm":W(f[0],"click",function(j){i.returnValue=true;i.hide()});W(f[1],"click",function(j){i.hide()});i.returnValue=false;break;case"prompt":var h=i.oWrap.getElementsByTagName("input")[0];i.dialogInput=h;W(h,"keydown",function(j){if(Y(j)==U.KEY_ENTER){setTimeout(function(){C(f[0],"click")},10)}});W(f[0],"click",function(j){i.returnValue=h.value;i.hide()});W(f[1],"click",function(j){i.hide()});break;case"msgbox":W(f[0],"click",function(j){i.returnValue=true;i.hide()});W(f[1],"click",function(j){i.returnValue=false;i.hide()});W(f[2],"click",function(j){i.hide()});break}i.on("aftershow",function(){var j=(h||f[0]);try{j.focus();j.select()}catch(k){}});i.on("afterhide",function(){try{c&&c(this.returnValue)}finally{}});return i},_sysDialog:function(g,d,h,c,f){f=f||{};var e=QW.Panel.getSysDialog(g,d,c,f);if(g=="prompt"){e.dialogInput.value=h||""}e.show(null,null,f.width||300,f.height)},alert:function(d,c,e){QW.Panel._sysDialog("alert",d,null,c,e)},confirm:function(d,c,e){QW.Panel._sysDialog("confirm",d,null,c,e)},prompt:function(d,f,c,e){QW.Panel._sysDialog("prompt",d,f,c,e)},msgbox:function(d,c,e){QW.Panel._sysDialog("msgbox",d,null,c,e)}};return a}());QW.provide({PanelManager:L,BasePanel:G,LayerPopup:V,LayerDialog:P,Panel:J})}());