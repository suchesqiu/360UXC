(function(){var R=QW.ObjectH.mix,D=QW.FunctionH.lazyApply,F=QW.DomU,K=F.createElement,E=QW.NodeH,ab=QW.EventTargetH,V=ab.addEventListener,P=ab.removeEventListener,G=ab.delegate,I=E.ancestorNode,T=E.getCurrentStyle,aa=E.setStyle,M=E.getRect,X=E.setRect,Q=E.addClass,O=E.removeClass,L=E.marginWidth,U=QW.EventH,N=U.getTarget,W=U.preventDefault,ac=U.getPageX,ad=U.getPageY,S=QW.CustEvent;var Y={isDragging:false,oDrag:null,startDate:null,startX:0,startY:0,pageX:0,pageY:0,deltaX:0,deltaY:0,deltaDeltaX:0,deltaDeltaY:0,mouseDownTarget:null,startDrag:function(a,b){}};(function(){var c=function(d){var e=Y.oDrag;if(Y.isDragging||!e){return}Y.isDragging=true;V(document,"mousemove",b);V(document,"mouseup",a);Y.startDate=new Date();Y.deltaX=Y.deltaY=Y.deltaDeltaX=Y.deltaDeltaY=0;Y.startX=Y.pageX=ac(d);Y.startY=Y.pageY=ad(d);Y.mouseDownTarget=N(d);W(d);e.dragstart(d)};var a=function(d){var e=Y.oDrag;if(!Y.isDragging||!e){return}e.dragend(d);Y.isDragging=false;Y.oDrag=null;P(document,"mousemove",b);P(document,"mouseup",a)};var b=function(e){var f=Y.oDrag;if(!Y.isDragging||!f){return}var g=ac(e);var d=ad(e);Y.deltaDeltaX=g-Y.pageX;Y.deltaDeltaY=d-Y.pageY;Y.pageX=g;Y.pageY=d;Y.deltaX=g-Y.startX;Y.deltaY=d-Y.startY;f.drag(e)};Y.startDrag=function(d,e){Y.oDrag=e;c(d)}}());function H(a){R(this,a,1);if(!this.lazyRender){this.render()}}(function(){H.EVENTS=["dragstart","drag","dragend"];var a=function(b){return parseFloat(b)||0};H.prototype={oSrc:null,oHdl:null,oProxy:null,xAttr:"left",yAttr:"top",maxXAttr:null,minXAttr:null,maxYAttr:null,minYAttr:null,xFixed:false,yFixed:false,withProxy:false,getProxy:(function(){var b=null;return function(){var c=this.oProxy||b;if(!c){c=K("div",{className:"proxy-dd"});document.body.appendChild(c);c.style.display="none"}return this.oProxy=c}}()),dragstart:function(b){var c=this;if(c.oHdl.setCapture){c.oHdl.setCapture()}c.startXAttr=a(T(c.oSrc,c.xAttr.replace(/^-/,"")));c.startYAttr=a(T(c.oSrc,c.yAttr.replace(/^-/,"")));if(c.withProxy){var e=c.getProxy();var d=M(c.oSrc);X(e,d.left,d.top,d.width,d.height,false);c.startXAttrProxy=a(e.style[c.xAttr.replace(/^-/,"")]);c.startYAttrProxy=a(e.style[c.yAttr.replace(/^-/,"")]);e.__deltaX=e.__deltaY=0;D(function(){e.style.display="block"},null,[],20,function(){if(c!=Y.oDrag||e.style.display!="none"){return -1}if(Y.deltaX*Y.deltaX+Y.deltaY*Y.deltaY>4||(new Date()-Y.startDate)>500){return 1}return 0})}c.fire("dragstart")},drag:function(c){var e=this,d={X:1,Y:1};for(var f in d){var h=f.toLowerCase();if(!e[h+"Fixed"]){var b=(e[h+"Attr"].indexOf("-")==0?-1:1)*Y["delta"+f];if(e["max"+f+"Attr"]!=null){b=Math.min(b,e["max"+f+"Attr"]-e["start"+f+"Attr"])}if(e["min"+f+"Attr"]!=null){b=Math.max(b,e["min"+f+"Attr"]-e["start"+f+"Attr"])}if(e.withProxy){try{aa(e.oProxy,e[h+"Attr"],(e["start"+f+"AttrProxy"]+b)+"px")}catch(g){}e.oProxy["__delta"+f]=b}else{aa(e.oSrc,e[h+"Attr"].replace(/^-/,""),(e["start"+f+"Attr"]+b)+"px")}}}e.fire("drag")},dragend:function(b){var c=this;if(c.oHdl.releaseCapture){c.oHdl.releaseCapture()}if(c.withProxy){var d=c.oProxy;d.style.display="none";if(!c.xFixed){aa(c.oSrc,c.xAttr.replace(/^-/,""),(c.startXAttr+d.__deltaX)+"px")}if(!c.yFixed){aa(c.oSrc,c.yAttr.replace(/^-/,""),(c.startYAttr+d.__deltaY)+"px")}}c.fire("dragend")},render:function(){var b=this;if(b._rendered){return}S.createEvents(b,H.EVENTS);if(b.delegateContainer){G(b.delegateContainer,b.oHdlSelector,"mousedown",function(c){b.oHdl=this;if(b.oSrcSelector){b.oSrc=I(this,b.oSrcSelector)}else{b.oSrc=b.oHdl}Y.startDrag(c,b)})}else{b.oHdl=b.oHdl||b.oSrc;V(b.oHdl,"mousedown",function(c){Y.startDrag(c,b)})}b._rendered=true}}}());function Z(a){H.call(this,a)}(function(){Z.MENTOR_CLASS=H;Z.prototype={xAttr:"width",yAttr:"height",minXAttr:0,minYAttr:0};R(Z.prototype,H.prototype)}());function J(a){R(this,a,1);if(!this.lazyRender){this.render()}}(function(){J.EVENTS=["dragstart","drag","dragend"];J.prototype={oProxy:null,oHdl:null,getProxy:(function(){var a=null;return function(){var b=this.oProxy||a;if(!b){b=K("div",{className:"proxy-rectselector"});document.body.appendChild(b);b.style.display="none"}return this.oProxy=b}}()),dragstart:function(a){this.oProxy=this.getProxy();this.oProxy.style.display="block";if(this.oHdl.setCapture){this.oHdl.setCapture()}X(this.oProxy,Y.startX,Y.startY,1,1);this.fire("dragstart")},drag:function(a){X(this.oProxy,Math.min(Y.startX,Y.pageX),Math.min(Y.startY,Y.pageY),Math.abs(Y.deltaX),Math.abs(Y.deltaY));this.fire("drag")},dragend:function(a){if(this.oHdl.releaseCapture){this.oHdl.releaseCapture()}this.oProxy.style.display="none";this.fire("dragend")},render:function(){var a=this;if(a._rendered){return}S.createEvents(a,J.EVENTS);V(a.oHdl,"mousedown",function(b){if(N(b)==a.oHdl){Y.startDrag(b,a)}});a._rendered=true}}}());function C(a){H.call(this,a)}(function(){C.MENTOR_CLASS=H;C.prototype={withProxy:true,isInline:false,dragstart:function(a){Q(this.oSrc,"dragingModule");H.prototype.dragstart.call(this,a)},dragend:function(a){O(this.oSrc,"dragingModule");H.prototype.dragend.call(this,a)},adjustLayout:function(k){var i=this,d=Y.pageX,g=Y.pageY,e=i.siblings,b=i.containers,h=i.isInline?"deltaDeltaX":"deltaDeltaY",f;if(k.type=="dragstart"){if(i.__elAnim){i.__elAnim.cancel()}}else{if(k.type=="drag"){if(b||e){var c=false;f=M(i.oSrc);var j=L(i.oSrc);if(d>=f.left-j[3]&&d<=f.right+j[1]&&g>=f.top-j[0]&&g<=f.bottom+j[2]){return}for(var l=0;e!=null&&l<e.length;l++){var m=e[l];if(m==i.oSrc){continue}f=M(m);j=L(m);if(d>=f.left-j[3]&&d<=f.right+j[1]&&g>=f.top-j[0]&&g<=f.bottom+j[2]){if(Y[h]>0){m.parentNode.insertBefore(i.oSrc,m.nextSibling)}else{if(Y[h]<0){m.parentNode.insertBefore(i.oSrc,m)}}c=true;break}}for(var l=0;!c&&b!=null&&l<b.length;l++){m=b[l];f=M(m);if(d>f.left+1&&d<f.right-1&&g>f.top+1&&g<f.bottom-1){if(m.lastChild!=i.oSrc){m.appendChild(i.oSrc);c=true}break}}if(c&&i.oHdl.setCapture){i.oHdl.setCapture()}}}}if(k.type=="dragend"){if(i.needAnim&&QW.ElAnim){f=M(i.oSrc);i.oProxy.style.display="block";var a=new QW.ElAnim(i.oProxy,{width:{to:f.width},height:{to:f.height},left:{to:f.left},top:{to:f.top}},300);a.on("end",function(){i.oProxy.style.display="none"});a.start();i.oProxy.__elAnim=a}}},render:function(){var a=this;H.prototype.render.call(a);var b=a.adjustLayout;if(b){a.on("dragstart",b);a.on("drag",b);a.on("dragend",b)}}};R(C.prototype,H.prototype)}());QW.provide({DragManager:Y,SimpleDrag:H,SimpleResize:Z,LayoutDrag:C,RectSelector:J})}());