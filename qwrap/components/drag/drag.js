(function(){var i=QW.ObjectH.mix,w=QW.FunctionH.lazyApply,u=QW.DomU,p=u.createElement,v=QW.NodeH,A=QW.EventTargetH,e=A.addEventListener,k=A.removeEventListener,t=A.delegate,r=v.ancestorNode,g=v.getCurrentStyle,B=v.setStyle,n=v.getRect,c=v.setRect,j=v.addClass,l=v.removeClass,o=v.marginWidth,f=QW.EventH,m=f.getTarget,d=f.preventDefault,z=f.getPageX,y=f.getPageY,h=QW.CustEvent;var b={isDragging:false,oDrag:null,startDate:null,startX:0,startY:0,pageX:0,pageY:0,deltaX:0,deltaY:0,deltaDeltaX:0,deltaDeltaY:0,mouseDownTarget:null,startDrag:function(D,C){}};(function(){var E=function(G){var F=b.oDrag;if(b.isDragging||!F){return}b.isDragging=true;e(document,"mousemove",C);e(document,"mouseup",D);b.startDate=new Date();b.deltaX=b.deltaY=b.deltaDeltaX=b.deltaDeltaY=0;b.startX=b.pageX=z(G);b.startY=b.pageY=y(G);b.mouseDownTarget=m(G);d(G);F.dragstart(G)};var D=function(G){var F=b.oDrag;if(!b.isDragging||!F){return}F.dragend(G);b.isDragging=false;b.oDrag=null;k(document,"mousemove",C);k(document,"mouseup",D)};var C=function(H){var G=b.oDrag;if(!b.isDragging||!G){return}var F=z(H);var I=y(H);b.deltaDeltaX=F-b.pageX;b.deltaDeltaY=I-b.pageY;b.pageX=F;b.pageY=I;b.deltaX=F-b.startX;b.deltaY=I-b.startY;G.drag(H)};b.startDrag=function(G,F){b.oDrag=F;E(G)}}());function s(C){i(this,C,1);if(!this.lazyRender){this.render()}}(function(){s.EVENTS=["dragstart","drag","dragend"];var C=function(D){return parseFloat(D)||0};s.prototype={oSrc:null,oHdl:null,oProxy:null,xAttr:"left",yAttr:"top",maxXAttr:null,minXAttr:null,maxYAttr:null,minYAttr:null,xFixed:false,yFixed:false,withProxy:false,getProxy:(function(){var D=null;return function(){var E=this.oProxy||D;if(!E){E=p("div",{className:"proxy-dd"});document.body.appendChild(E);E.style.display="none"}return this.oProxy=E}}()),dragstart:function(D){var G=this;if(G.oHdl.setCapture){G.oHdl.setCapture()}G.startXAttr=C(g(G.oSrc,G.xAttr.replace(/^-/,"")));G.startYAttr=C(g(G.oSrc,G.yAttr.replace(/^-/,"")));if(G.withProxy){var E=G.getProxy();var F=n(G.oSrc);c(E,F.left,F.top,F.width,F.height,false);G.startXAttrProxy=C(E.style[G.xAttr.replace(/^-/,"")]);G.startYAttrProxy=C(E.style[G.yAttr.replace(/^-/,"")]);E.__deltaX=E.__deltaY=0;w(function(){E.style.display="block"},null,[],20,function(){if(G!=b.oDrag||E.style.display!="none"){return -1}if(b.deltaX*b.deltaX+b.deltaY*b.deltaY>4||(new Date()-b.startDate)>500){return 1}return 0})}G.fire("dragstart")},drag:function(J){var H=this,I={X:1,Y:1};for(var G in I){var E=G.toLowerCase();if(!H[E+"Fixed"]){var D=(H[E+"Attr"].indexOf("-")==0?-1:1)*b["delta"+G];if(H["max"+G+"Attr"]!=null){D=Math.min(D,H["max"+G+"Attr"]-H["start"+G+"Attr"])}if(H["min"+G+"Attr"]!=null){D=Math.max(D,H["min"+G+"Attr"]-H["start"+G+"Attr"])}if(H.withProxy){try{B(H.oProxy,H[E+"Attr"],(H["start"+G+"AttrProxy"]+D)+"px")}catch(F){}H.oProxy["__delta"+G]=D}else{B(H.oSrc,H[E+"Attr"].replace(/^-/,""),(H["start"+G+"Attr"]+D)+"px")}}}H.fire("drag")},dragend:function(D){var F=this;if(F.oHdl.releaseCapture){F.oHdl.releaseCapture()}if(F.withProxy){var E=F.oProxy;E.style.display="none";if(!F.xFixed){B(F.oSrc,F.xAttr.replace(/^-/,""),(F.startXAttr+E.__deltaX)+"px")}if(!F.yFixed){B(F.oSrc,F.yAttr.replace(/^-/,""),(F.startYAttr+E.__deltaY)+"px")}}F.fire("dragend")},render:function(){var D=this;if(D._rendered){return}h.createEvents(D,s.EVENTS);if(D.delegateContainer){t(D.delegateContainer,D.oHdlSelector,"mousedown",function(E){D.oHdl=this;if(D.oSrcSelector){D.oSrc=r(this,D.oSrcSelector)}else{D.oSrc=D.oHdl}b.startDrag(E,D)})}else{D.oHdl=D.oHdl||D.oSrc;e(D.oHdl,"mousedown",function(E){b.startDrag(E,D)})}D._rendered=true}}}());function a(C){s.call(this,C)}(function(){a.MENTOR_CLASS=s;a.prototype={xAttr:"width",yAttr:"height",minXAttr:0,minYAttr:0};i(a.prototype,s.prototype)}());function q(C){i(this,C,1);if(!this.lazyRender){this.render()}}(function(){q.EVENTS=["dragstart","drag","dragend"];q.prototype={oProxy:null,oHdl:null,getProxy:(function(){var C=null;return function(){var D=this.oProxy||C;if(!D){D=p("div",{className:"proxy-rectselector"});document.body.appendChild(D);D.style.display="none"}return this.oProxy=D}}()),dragstart:function(C){this.oProxy=this.getProxy();this.oProxy.style.display="block";if(this.oHdl.setCapture){this.oHdl.setCapture()}c(this.oProxy,b.startX,b.startY,1,1);this.fire("dragstart")},drag:function(C){c(this.oProxy,Math.min(b.startX,b.pageX),Math.min(b.startY,b.pageY),Math.abs(b.deltaX),Math.abs(b.deltaY));this.fire("drag")},dragend:function(C){if(this.oHdl.releaseCapture){this.oHdl.releaseCapture()}this.oProxy.style.display="none";this.fire("dragend")},render:function(){var C=this;if(C._rendered){return}h.createEvents(C,q.EVENTS);e(C.oHdl,"mousedown",function(D){if(m(D)==C.oHdl){b.startDrag(D,C)}});C._rendered=true}}}());function x(C){s.call(this,C)}(function(){x.MENTOR_CLASS=s;x.prototype={withProxy:true,isInline:false,dragstart:function(C){j(this.oSrc,"dragingModule");s.prototype.dragstart.call(this,C)},dragend:function(C){l(this.oSrc,"dragingModule");s.prototype.dragend.call(this,C)},adjustLayout:function(E){var G=this,L=b.pageX,I=b.pageY,K=G.siblings,N=G.containers,H=G.isInline?"deltaDeltaX":"deltaDeltaY",J;if(E.type=="dragstart"){if(G.__elAnim){G.__elAnim.cancel()}}else{if(E.type=="drag"){if(N||K){var M=false;J=n(G.oSrc);var F=o(G.oSrc);if(L>=J.left-F[3]&&L<=J.right+F[1]&&I>=J.top-F[0]&&I<=J.bottom+F[2]){return}for(var D=0;K!=null&&D<K.length;D++){var C=K[D];if(C==G.oSrc){continue}J=n(C);F=o(C);if(L>=J.left-F[3]&&L<=J.right+F[1]&&I>=J.top-F[0]&&I<=J.bottom+F[2]){if(b[H]>0){C.parentNode.insertBefore(G.oSrc,C.nextSibling)}else{if(b[H]<0){C.parentNode.insertBefore(G.oSrc,C)}}M=true;break}}for(var D=0;!M&&N!=null&&D<N.length;D++){C=N[D];J=n(C);if(L>J.left+1&&L<J.right-1&&I>J.top+1&&I<J.bottom-1){if(C.lastChild!=G.oSrc){C.appendChild(G.oSrc);M=true}break}}if(M&&G.oHdl.setCapture){G.oHdl.setCapture()}}}}if(E.type=="dragend"){if(G.needAnim&&QW.ElAnim){J=n(G.oSrc);G.oProxy.style.display="block";var O=new QW.ElAnim(G.oProxy,{width:{to:J.width},height:{to:J.height},left:{to:J.left},top:{to:J.top}},300);O.on("end",function(){G.oProxy.style.display="none"});O.start();G.oProxy.__elAnim=O}}},render:function(){var D=this;s.prototype.render.call(D);var C=D.adjustLayout;if(C){D.on("dragstart",C);D.on("drag",C);D.on("dragend",C)}}};i(x.prototype,s.prototype)}());QW.provide({DragManager:b,SimpleDrag:s,SimpleResize:a,LayoutDrag:x,RectSelector:q})}());