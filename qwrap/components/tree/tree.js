(function(){function b(g){QW.ObjectH.mix(this,g,true);if(!this.lazyRender){this.render()}}var o=(/msie/i).test(navigator.userAgent);var i=QW.EventH.getTarget,a=QW.DomU.createElement,c=QW.EventTargetH.addEventListener,m=QW.NodeH,d=m.hasClass,j=m.addClass,p=m.removeClass,l=m.replaceClass,n=m.show,h=m.hide,e=m.ancestorNode,f=m.g;var k=0;b.prototype={rootItemData:["folderRoot","0","Root示例"],loadItemsData:function(g){this.setItemsData(g,this.dataSource[g],true)},getItemHtml:function(g){return"需要重写"},getNoDataHtml:function(g){return"没有数据"},setItemsData:function(s,r,g){var q=f(this._idPre+s);if(!q){alert("程序错误：节点还没生成："+s);return}q.itemsData=r||[];q.dataIsLoading=false;if(g){this._renderItems(s)}},openFolder:function(r){var g=f(this._idPre+r);if(!g){alert("程序错误：节点还没生成："+r);return}var q=g.childNodes[2];if(!q.innerHTML){if(!g.itemsData&&!g.dataIsLoading){j(g.firstChild,"folder-img-loading");this.loadItemsData(r)}this._renderItems(r,true)}l(g,"folder-closed","folder-open");l(g.firstChild,"folder-img-closed","folder-img-open");n(q)},closeFolder:function(q){var g=f(this._idPre+q);if(!g){alert("程序错误：节点还没生成："+q);return}l(g,"folder-open","folder-closed");l(g.firstChild,"folder-img-open","folder-img-closed");h(g.childNodes[2])},openFolders:function(q){for(var g=0;g<q.length;g++){this.openFolder(q[g])}},refreshFolder:function(q){var g=f(this._idPre+q);if(!g){alert("程序错误：节点还没生成："+q);return}j(g.firstChild,"folder-img-loading");g.childNodes[2].innerHTML="";this.loadItemsData(q)},focusItem:function(u){var s=f(this._idPre+u);if(!s){alert("程序错误：节点还没生成："+u);return}var g=s.getElementsByTagName("a");try{if(g.length){if(this._highlightEl){try{p(this._highlightEl,"highlight")}catch(r){}}var q=g[0];q.focus();j(q,"highlight");this._highlightEl=q}else{s.scrollIntoView()}}catch(t){}},_highlightEl:null,_idPre:"",_renderItems:function(g,u){var q=f(this._idPre+g);var x=q.itemsData;if(!x){if(!u){alert("还没有load出数据来呢!")}return false}var z=q.childNodes[2];if(x.length){var t=[];for(var s=0;s<x.length;s++){var v=x[s];var w=this.getItemHtml(v);var y=(s==x.length-1)?"folder-last ":"";if(v[0].toLowerCase().indexOf("folder")>-1){t[s]='<li id="'+this._idPre+v[1]+'" class="folder-closed '+y+v[0]+'"><span class="folder-img-closed '+v[0]+'">&nbsp;</span><div class="node-ctn">'+w+'</div><ul style="display:none"></ul></li>'}else{t[s]='<li id="'+this._idPre+v[1]+'" class="folder-closed '+y+v[0]+'"><div class="node-ctn">'+w+"</div></li>";t[s]='<li id="'+this._idPre+v[1]+'" class="folder-closed '+v[0]+'"><span class="folder-img-bottom '+v[0]+'">&nbsp;</span><div class="node-ctn">'+w+"</div></li>";t[x.length-1]='<li id="'+this._idPre+v[1]+'" class="folder-closed '+v[0]+'"><span class="folder-img-last '+v[0]+'">&nbsp;</span><div class="node-ctn">'+w+"</div></li>"}}z.innerHTML=t.join("")}else{z.innerHTML="<li>"+this.getNoDataHtml(g)+"</li>"}var r=W(".folder-last");r.firstChild("ul").addClass("folder-ul-lst");r.firstChild("span").addClass("folder-span-lst");p(q.firstChild,"folder-img-loading")},_mouseover:function(q){var g=i(q);if(g.tagName=="UL"){return}if(g.tagName!="LI"){g=e(g,"LI")}var r=g.getElementsByTagName("div")[0];if(r){j(r,"ms-over")}},_mouseout:function(q){var g=i(q);if(g.tagName=="UL"){return}if(g.tagName!="LI"){g=e(g,"LI")}var r=g.getElementsByTagName("div")[0];if(r){p(r,"ms-over")}},_click:function(q){var g=i(q);if(d(g,"folder-img-closed")){this.openFolder(g.parentNode.id.substr(this._idPre.length))}else{if(d(g,"folder-img-open")){this.closeFolder(g.parentNode.id.substr(this._idPre.length))}}},render:function(){var q=this;if(q._rendered){return}q._rendered=true;this._idPre="tree"+(++k)+"_";var r=q.rootItemData;q.treeCtn.innerHTML='<ul class="tree-wrap"><li id="'+this._idPre+r[1]+'"><span class="folder-img-root '+r[0]+'">&nbsp;</span><div class="node-ctn">'+r[2]+'</div><ul style="display:none" class="tree-wrap-inner"></ul></li></ul>';var g=this.treeCtn.firstChild;c(g,"mouseover",function(s){q._mouseover(s)});c(g,"mouseout",function(s){q._mouseout(s)});c(g,"click",function(s){q._click(s)});q.openFolder(r[1])}};QW.provide("Tree",b)})();