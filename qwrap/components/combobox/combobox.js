(function(){var g=QW.ObjectH.mix,m=QW.DomU,k=m.createElement,f=QW.EventH,r=f.getTarget,c=f.getKeyCode,d=f.preventDefault,h=QW.CustEvent,n=QW.NodeH,i=n.addClass,j=n.removeClass,a=n.setStyle,o=n.getXY,l=n.ancestorNode,e=QW.EventTargetH.addEventListener,q=(/msie/i).test(navigator.userAgent);function b(u){var v=[/&/g,/"/g,/'/g,/</g,/>/g];var w=["&amp;","&quot;","&#039;","&lt;","&gt;"];for(var t=0;t<v.length;t++){u=u.replace(v[t],w[t])}return u}function p(s){g(this,s,1);this.acValue=this.oText.value;if(!this.lazyRender){this.render()}}p.EVENTS=["enter","selectitem","clear","refresh"];p.prototype={width:0,oText:null,_itemsData:null,minFilterLen:1,oMenu:null,oToolbar:null,oWrap:null,selectedIndex:-1,filteredValue:"",filteringValue:"",acValue:"",disabled:false,closed:false,show:function(){if(this.oMenu.rows.length){var s=o(this.oText);a(this.oWrap,{top:s[1]+this.oText.offsetHeight+"px",left:s[0]+"px",display:""})}},hide:function(){this.oWrap.style.display="none"},setItems:function(s){this._itemsData=s.slice(0)},refreshItems:function(){var v=this;var w=v._itemsData;if(w&&!w.__isRendered){var u=[];for(var t=0;t<w.length;t++){var s=w[t].constructor;if(s==String){u.push('<tr acValue="'+b(w[t])+'"><td>'+b(w[t])+"</td></tr>")}else{if(s==Array){u.push('<tr acValue="'+b(w[t][0])+'"><td>'+w[t][1]+"</td></tr>")}else{u.push('<tr acValue="'+b(w[t].value)+'"><td>'+w[t].html+"</td></tr>")}}u.push("</tr>")}v._setMenuInnerHtml(u.join("").replace(/(<\w+)/g,'$1 unselectable="on"'));if(w.length){v.show()}else{v.hide()}v.filteredValue=v.filteringValue;v.acValue="";v.selectedIndex=-1;w.__isRendered=true}},setSelectedIndex:function(s,t){var u=this;var v=u.oMenu.rows;if(v.length){if(u.selectedIndex>-1){j(v[u.selectedIndex],"selected")}s=(s+v.length+1)%(v.length+1);if(s==v.length){u.acValue=u.oText.value=u.filteringValue;s=-1}else{u.acValue=u.oText.value=v[s].getAttribute("acValue");i(v[s],"selected")}}else{s=-1}u.selectedIndex=s},_setMenuInnerHtml:function(u){var w=k("div",{innerHTML:"<table>"+u+"</table>"});var v=w.firstChild.rows;var s=this.oMenu;for(var t=s.childNodes.length-1;t>=0;t--){s.removeChild(s.childNodes[t])}while(v.length){s.appendChild(v[0])}},_init:function(){var s=this;if(s.disabled){return}if(s._refreshTimer){clearInterval(s._refreshTimer)}s._refreshTimer=setInterval(function(){var t=s.oText.value;if(t.length<s.minFilterLen){if(s.acValue||s.filteringValue||s.filteredValue){s.fire("clear")}s.acValue=s.filteringValue=s.filteredValue="";s.hide();s.closed=false}else{if(!s.closed){if(t!=s.filteredValue&&t!=s.filteringValue&&t!=s.acValue){s.filteringValue=t;s.fire("refresh")}if(false!==s.returnValue&&s._itemsData){s.refreshItems()}}}},100)},render:function(){var z=this;if(z._rendered){return}z._rendered=true;h.createEvents(z,p.EVENTS);var A=k("div",{className:"ac_wrap",innerHTML:(q?'<iframe class="ac_bgIframe"></iframe>':"")+"<div class=ac_wrap_inner><div class=ac_menu_ctn><table cellspacing=0><tbody class=ac_menu></tbody></table></div><table><tbody class=ac_toolbar><tr><td><a href=# class=close>关闭</a></div></td></tr></tbody></table></div>".replace(/(<\w+)/g,'$1 unselectable="on"')});var s=document.body;s.insertBefore(A,s.firstChild);var x=A.getElementsByTagName("tbody");var v=z.oText,y=z.oToolbar=x[1],u=z.oMenu=x[0];v.setAttribute("autoComplete","off");var t=(z.width||z.oText.offsetWidth)+"px";if(q){A.style.width=t}else{A.style.minWidth=t}z.oWrap=A;z.hide();e(z.oText,"dblclick",function(w){if(z.disabled||v.value.length<z.minFilterLen){return}if(z.closed=!z.closed){z.hide()}else{z.show()}});e(z.oText,"keydown",function(C){if(!z._refreshTimer){z._init()}if(z.disabled){return}var B=c(C);var w=0;switch(B){case 40:w=1;break;case 38:w=-1;break;case 27:if(!z.closed){z.hide();z.closed=true;d(C)}break;case 13:z.hide();z.fire("enter");break}if(w&&v.value.length>=z.minFilterLen){d(C);if(A.style.display=="none"){z.show();z.closed=false}else{z.setSelectedIndex(z.selectedIndex+w)}}});e(z.oText,"focus",function(w){z._init()});e(z.oText,"blur",function(w){z.hide();clearInterval(z._refreshTimer)});A.onmousedown=function(w){if(q){v.setCapture();setTimeout(function(){v.releaseCapture()},10)}d(w)};u.onclick=function(C){var w=r(C);var B=l(w,"TR");if(B){v.blur();setTimeout(function(){v.focus()},10);z.setSelectedIndex(B.rowIndex,true);z.hide();z.fire("selectitem")}};u.onmouseover=function(C){var w=r(C);var B=l(w,"TR");if(B){i(B,"mouseover")}};u.onmouseout=function(C){var w=r(C);var B=l(w,"TR");if(B){j(B,"mouseover")}};y.getElementsByTagName("a")[0].onclick=function(w){z.closed=true;z.hide();d(w)}}};QW.provide("ComboBox",p)}());