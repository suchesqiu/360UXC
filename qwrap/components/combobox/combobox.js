(function(){var o=QW.ObjectH.mix,e=QW.DomU,a=e.createElement,l=QW.EventH,n=l.getTarget,f=l.getKeyCode,h=l.preventDefault,p=QW.CustEvent,g=QW.NodeH,q=g.addClass,r=g.removeClass,b=g.setStyle,i=g.getXY,c=g.ancestorNode,k=QW.EventTargetH.addEventListener,m=(/msie/i).test(navigator.userAgent);function d(v){var s=[/&/g,/"/g,/'/g,/</g,/>/g];var t=["&amp;","&quot;","&#039;","&lt;","&gt;"];for(var u=0;u<s.length;u++){v=v.replace(s[u],t[u])}return v}function j(s){o(this,s,1);this.acValue=this.oText.value;if(!this.lazyRender){this.render()}}j.EVENTS=["enter","selectitem","clear","refresh"];j.prototype={width:0,oText:null,_itemsData:null,minFilterLen:1,oMenu:null,oToolbar:null,oWrap:null,selectedIndex:-1,filteredValue:"",filteringValue:"",acValue:"",disabled:false,closed:false,show:function(){if(this.oMenu.rows.length){var s=i(this.oText);b(this.oWrap,{top:s[1]+this.oText.offsetHeight+"px",left:s[0]+"px",display:""})}},hide:function(){this.oWrap.style.display="none"},setItems:function(s){this._itemsData=s.slice(0)},refreshItems:function(){var s=this;var t=s._itemsData;if(t&&!t.__isRendered){var w=[];for(var v=0;v<t.length;v++){var u=t[v].constructor;if(u==String){w.push('<tr acValue="'+d(t[v])+'"><td>'+d(t[v])+"</td></tr>")}else{if(u==Array){w.push('<tr acValue="'+d(t[v][0])+'"><td>'+t[v][1]+"</td></tr>")}else{w.push('<tr acValue="'+d(t[v].value)+'"><td>'+t[v].html+"</td></tr>")}}w.push("</tr>")}s._setMenuInnerHtml(w.join("").replace(/(<\w+)/g,'$1 unselectable="on"'));if(t.length){s.show()}else{s.hide()}s.filteredValue=s.filteringValue;s.acValue="";s.selectedIndex=-1;t.__isRendered=true}},setSelectedIndex:function(u,v){var s=this;var t=s.oMenu.rows;if(t.length){if(s.selectedIndex>-1){r(t[s.selectedIndex],"selected")}u=(u+t.length+1)%(t.length+1);if(u==t.length){s.acValue=s.oText.value=s.filteringValue;u=-1}else{s.acValue=s.oText.value=t[u].getAttribute("acValue");q(t[u],"selected")}}else{u=-1}s.selectedIndex=u},_setMenuInnerHtml:function(w){var t=a("div",{innerHTML:"<table>"+w+"</table>"});var s=t.firstChild.rows;var u=this.oMenu;for(var v=u.childNodes.length-1;v>=0;v--){u.removeChild(u.childNodes[v])}while(s.length){u.appendChild(s[0])}},_init:function(){var s=this;if(s.disabled){return}if(s._refreshTimer){clearInterval(s._refreshTimer)}s._refreshTimer=setInterval(function(){var t=s.oText.value;if(t.length<s.minFilterLen){if(s.acValue||s.filteringValue||s.filteredValue){s.fire("clear")}s.acValue=s.filteringValue=s.filteredValue="";s.hide();s.closed=false}else{if(!s.closed){if(t!=s.filteredValue&&t!=s.filteringValue&&t!=s.acValue){s.filteringValue=t;s.fire("refresh")}if(false!==s.returnValue&&s._itemsData){s.refreshItems()}}}},100)},render:function(){var v=this;if(v._rendered){return}v._rendered=true;p.createEvents(v,j.EVENTS);var s=a("div",{className:"ac_wrap",innerHTML:(m?'<iframe class="ac_bgIframe"></iframe>':"")+"<div class=ac_wrap_inner><div class=ac_menu_ctn><table cellspacing=0><tbody class=ac_menu></tbody></table></div><table><tbody class=ac_toolbar><tr><td><a href=# class=close>关闭</a></div></td></tr></tbody></table></div>".replace(/(<\w+)/g,'$1 unselectable="on"')});var w=document.body;w.insertBefore(s,w.firstChild);var t=s.getElementsByTagName("tbody");var z=v.oText,u=v.oToolbar=t[1],y=v.oMenu=t[0];z.setAttribute("autoComplete","off");var x=(v.width||v.oText.offsetWidth)+"px";if(m){s.style.width=x}else{s.style.minWidth=x}v.oWrap=s;v.hide();k(v.oText,"dblclick",function(A){if(v.disabled||z.value.length<v.minFilterLen){return}if(v.closed=!v.closed){v.hide()}else{v.show()}});k(v.oText,"keydown",function(B){if(!v._refreshTimer){v._init()}if(v.disabled){return}var A=f(B);var C=0;switch(A){case 40:C=1;break;case 38:C=-1;break;case 27:if(!v.closed){v.hide();v.closed=true;h(B)}break;case 13:v.hide();v.fire("enter");break}if(C&&z.value.length>=v.minFilterLen){h(B);if(s.style.display=="none"){v.show();v.closed=false}else{v.setSelectedIndex(v.selectedIndex+C)}}});k(v.oText,"focus",function(A){v._init()});k(v.oText,"blur",function(A){v.hide();clearInterval(v._refreshTimer)});s.onmousedown=function(A){if(m){z.setCapture();setTimeout(function(){z.releaseCapture()},10)}h(A)};y.onclick=function(B){var C=n(B);var A=c(C,"TR");if(A){z.blur();setTimeout(function(){z.focus()},10);v.setSelectedIndex(A.rowIndex,true);v.hide();v.fire("selectitem")}};y.onmouseover=function(B){var C=n(B);var A=c(C,"TR");if(A){q(A,"mouseover")}};y.onmouseout=function(B){var C=n(B);var A=c(C,"TR");if(A){r(A,"mouseover")}};u.getElementsByTagName("a")[0].onclick=function(A){v.closed=true;v.hide();h(A)}}};QW.provide("ComboBox",j)}());