Suggest.UI=function(b){Suggest._argValid(b,"object",arguments.callee);this._config={textbox:"",uiCaption:null,uiView:null,uiBaseLayerConfig:{autoPosition:false},uiContainer:null,uiReferEl:null,_interval:50};this._prop={_textChangeTimer:null,textbox:null,keyword:"",baseLayer:null,view:null,_isTimerOn:null};QW.ObjectH.mix(this._config,b,true);return this._init()};Suggest.UI._EVENT=["backspace","up","down","change","esc","enter","focus","blur","itemfocus","itemblur","itemselect"];Suggest.UI.prototype={_dispatch:function(f,e){if(!QW.ArrayH.contains(Suggest.UI._EVENT,f)){Suggest._debug("arg",'event type "'+f.toString()+'" not exist when dispatching Suggest.UI instance ',this);return false}if(e){this.fire(e)}else{var d=new QW.CustEvent(this,f);d.suggestUI=this;this.fire(d)}},_init:function(){return this._initTextbox()&&this._initView()&&this._initBaseLayer()&&this._initEvent()},_initTextbox:function(){var f=QW.NodeW(this.get("textbox")).core;f=f.length?f[0]:f;var e=QW.NodeW(f);this.set("textbox",e);this._prop.textbox=e;var d=this;e.setAttr("autocomplete","off").on("keydown",function(a){d._keyEventHandler(a)}).on("focus",function(a){d._dispatch("focus");d._addTextChangeTimer()}).on("blur",function(a){d._dispatch("blur");d._removeTextChangeTimer()});return true},_initView:function(){var c=this.get("uiView");if(c===null){c=new Suggest.UI.ListView(this._config)}this.set("uiView",c);this._prop.view=c;var d=this;c.on("itemfocus",function(a){d._dispatch("itemfocus",a)});c.on("itemblur",function(a){d._dispatch("itemblur",a)});c.on("itemselect",function(a){d._removeTextChangeTimer();d._dispatch("itemselect",a)});return true},_initBaseLayer:function(){var e=this.get("uiBaseLayerConfig");if(this.get("uiContainer")&&QW.DomU.isElement(this.get("uiContainer"))){this._prop.baselayer=new QW.LayerPopup(this.get("uiContainer"),e)}else{e.INNER_CLASS="panel-content "+this.get("uiStyle").containerClass;this._prop.baselayer=new QW.LayerPopup(e)}if(this.get("uiCaption")!==null&&this.get("uiCaption")!==""){this._prop.baselayer.setCaption(this.get("uiCaption"))}this._prop.baselayer.setContent(QW.NodeH.g(this._prop.view.getContainer()));if(this.get("uiReferEl")!==null){var d=QW.NodeW(this.get("uiReferEl")).core;d=d.length?d[0]:d;var f=QW.NodeW(d);this.set("uiReferEl",f)}else{this.set("uiReferEl",this.get("textbox"))}return true},_initEvent:function(){QW.CustEvent.createEvents(this,Suggest.UI._EVENT);return true},_hasTextChangeTimer:function(){return this._prop._isTimerOn},_removeTextChangeTimer:function(){if(this._prop._isTimerOn){clearInterval(this._prop._textChangeTimer);this._prop._isTimerOn=false;return true}return true},_addTextChangeTimer:function(){if(!this._prop._isTimerOn){var b=this;b._prop._textChangeTimer=window.setInterval(function(){var a=b.getTextboxValue();if(b.getKeyword()!=a){b._prop.keyword=a;b._dispatch("change")}},b.get("_interval"));this._prop._isTimerOn=true;return true}return true},_keyManager:{DOWN:40,UP:38,ESC:27,ENTER:13,BACKSPACE:8,_invalidKeyCode:[40,39,38,37,27,13,17,16]},_isKeyValid:function(g){var e=this._keyManager._invalidKeyCode;for(var h=0,f=e.length;h<f;h++){if(e[h]==g){return false}}return true},_keyEventHandler:function(d){var c="";switch(d.keyCode){case this._keyManager.UP:c="up";d.preventDefault();this._removeTextChangeTimer();break;case this._keyManager.DOWN:c="down";this._removeTextChangeTimer();break;case this._keyManager.ESC:c="esc";this._removeTextChangeTimer();break;case this._keyManager.BACKSPACE:c="backspace";this._addTextChangeTimer();break;case this._keyManager.ENTER:c="enter";d.preventDefault();this._removeTextChangeTimer();break;default:if(this._isKeyValid(d.keyCode)){this._addTextChangeTimer()}}if(c!=""){this._dispatch(c)}},set:function(c,d){this._config[c]=d;return d},get:function(b){return this._config[b]},render:function(b){return this._prop.view.render(b)},setTextboxValue:function(b){this._prop.textbox.core.value=b;return true},getTextboxValue:function(){return QW.StringH.trim(this._prop.textbox.core.value)},show:function(){this._prop.baselayer.showPopup(null,this.get("uiReferEl").get("offsetHeight"),null,null,this.get("uiReferEl").core);return true},hide:function(){this._prop.baselayer.hide();return true},setKeyword:function(b){this._prop.keyword=b},getKeyword:function(){return QW.StringH.trim(this._prop.keyword)},getItem:function(b){return this._prop.view.getItem(b)},selectItem:function(b){this._prop.view.focusItem(b);return true},focusItem:function(b){this._prop.view.focusItem(b);return true},blurItem:function(b){this._prop.view.blurItem(b);return true}};