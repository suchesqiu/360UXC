/*!
 * jQuery Raty - A Star Rating Plugin
 *
 * Licensed under The MIT License
 *
 * @version        2.5.2
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/raty
 *
 */
;(function(b){var a={init:function(c){return this.each(function(){a.destroy.call(this);this.opt=b.extend(true,{},b.fn.raty.defaults,c);var f=b(this),d=["number","readOnly","score","scoreName"];a._callback.call(this,d);if(this.opt.precision){a._adjustPrecision.call(this)}this.opt.number=a._between(this.opt.number,0,this.opt.numberMax);this.opt.path=this.opt.path||"";if(this.opt.path&&this.opt.path.slice(this.opt.path.length-1,this.opt.path.length)!=="/"){this.opt.path+="/"}this.stars=a._createStars.call(this);this.score=a._createScore.call(this);a._apply.call(this,this.opt.score);var g=this.opt.space?4:0,e=this.opt.width||(this.opt.number*this.opt.size+this.opt.number*g);if(this.opt.cancel){this.cancel=a._createCancel.call(this);e+=(this.opt.size+g)}if(this.opt.readOnly){a._lock.call(this)}else{f.css("cursor","pointer");a._binds.call(this)}if(this.opt.width!==false){f.css("width",e)}a._target.call(this,this.opt.score);f.data({settings:this.opt,raty:true})})},_adjustPrecision:function(){this.opt.targetType="score";this.opt.half=true},_apply:function(c){if(c&&c>0){c=a._between(c,0,this.opt.number);this.score.val(c)}a._fill.call(this,c);if(c){a._roundStars.call(this,c)}},_between:function(d,c,e){return Math.min(Math.max(parseFloat(d),c),e)},_binds:function(){if(this.cancel){a._bindCancel.call(this)}a._bindClick.call(this);a._bindOut.call(this);a._bindOver.call(this)},_bindCancel:function(){a._bindClickCancel.call(this);a._bindOutCancel.call(this);a._bindOverCancel.call(this)},_bindClick:function(){var c=this,d=b(c);c.stars.on("click.raty",function(e){c.score.val((c.opt.half||c.opt.precision)?d.data("score"):this.alt);if(c.opt.click){c.opt.click.call(c,parseFloat(c.score.val()),e)}})},_bindClickCancel:function(){var c=this;c.cancel.on("click.raty",function(d){c.score.removeAttr("value");if(c.opt.click){c.opt.click.call(c,null,d)}})},_bindOut:function(){var c=this;b(this).on("mouseleave.raty",function(e){var d=parseFloat(c.score.val())||undefined;a._apply.call(c,d);a._target.call(c,d,e);if(c.opt.mouseout){c.opt.mouseout.call(c,d,e)}})},_bindOutCancel:function(){var c=this;c.cancel.on("mouseleave.raty",function(d){b(this).attr("src",c.opt.path+c.opt.cancelOff);if(c.opt.mouseout){c.opt.mouseout.call(c,c.score.val()||null,d)}})},_bindOverCancel:function(){var c=this;c.cancel.on("mouseover.raty",function(d){b(this).attr("src",c.opt.path+c.opt.cancelOn);c.stars.attr("src",c.opt.path+c.opt.starOff);a._target.call(c,null,d);if(c.opt.mouseover){c.opt.mouseover.call(c,null)}})},_bindOver:function(){var e=this,c=b(e),d=e.opt.half?"mousemove.raty":"mouseover.raty";e.stars.on(d,function(g){var h=parseInt(this.alt,10);if(e.opt.half){var f=parseFloat((g.pageX-b(this).offset().left)/e.opt.size),j=(f>0.5)?1:0.5;h=h-1+j;a._fill.call(e,h);if(e.opt.precision){h=h-j+f}a._roundStars.call(e,h);c.data("score",h)}else{a._fill.call(e,h)}a._target.call(e,h,g);if(e.opt.mouseover){e.opt.mouseover.call(e,h,g)}})},_callback:function(c){for(i in c){if(typeof this.opt[c[i]]==="function"){this.opt[c[i]]=this.opt[c[i]].call(this)}}},_createCancel:function(){var d=b(this),e=this.opt.path+this.opt.cancelOff,c=b("<img />",{src:e,alt:"x",title:this.opt.cancelHint,"class":"raty-cancel"});if(this.opt.cancelPlace=="left"){d.prepend("&#160;").prepend(c)}else{d.append("&#160;").append(c)}return c},_createScore:function(){return b("<input />",{type:"hidden",name:this.opt.scoreName}).appendTo(this)},_createStars:function(){var c=b(this);for(var e=1;e<=this.opt.number;e++){var d=a._getHint.call(this,e),f=(this.opt.score&&this.opt.score>=e)?"starOn":"starOff";f=this.opt.path+this.opt[f];b("<img />",{src:f,alt:e,title:d}).appendTo(this);if(this.opt.space){c.append((e<this.opt.number)?"&#160;":"")}}return c.children("img")},_error:function(c){b(this).html(c);b.error(c)},_fill:function(l){var j=this,m=0;for(var c=1;c<=j.stars.length;c++){var d=j.stars.eq(c-1),h=j.opt.single?(c==l):(c<=l);if(j.opt.iconRange&&j.opt.iconRange.length>m){var f=j.opt.iconRange[m],e=f.on||j.opt.starOn,k=f.off||j.opt.starOff,g=h?e:k;if(c<=f.range){d.attr("src",j.opt.path+g)}if(c==f.range){m++}}else{var g=h?"starOn":"starOff";d.attr("src",this.opt.path+this.opt[g])}}},_getHint:function(d){var c=this.opt.hints[d-1];return(c==="")?"":(c||d)},_lock:function(){var d=parseInt(this.score.val(),10),c=d?a._getHint.call(this,d):this.opt.noRatedMsg;b(this).data("readonly",true).css("cursor","").attr("title",c);this.score.attr("readonly","readonly");this.stars.attr("title",c);if(this.cancel){this.cancel.hide()}},_roundStars:function(d){var c=(d-Math.floor(d)).toFixed(2);if(c>this.opt.round.down){var e="starOn";if(this.opt.halfShow&&c<this.opt.round.up){e="starHalf"}else{if(c<this.opt.round.full){e="starOff"}}this.stars.eq(Math.ceil(d)-1).attr("src",this.opt.path+this.opt[e])}},_target:function(d,f){if(this.opt.target){var c=b(this.opt.target);if(c.length===0){a._error.call(this,"Target selector invalid or missing!")}if(this.opt.targetFormat.indexOf("{score}")<0){a._error.call(this,'Template "{score}" missing!')}var e=f&&f.type=="mouseover";if(d===undefined){d=this.opt.targetText}else{if(d===null){d=e?this.opt.cancelHint:this.opt.targetText}else{if(this.opt.targetType=="hint"){d=a._getHint.call(this,Math.ceil(d))}else{if(this.opt.precision){d=parseFloat(d).toFixed(1)}}if(!e&&!this.opt.targetKeep){d=this.opt.targetText}}}if(d){d=this.opt.targetFormat.toString().replace("{score}",d)}if(c.is(":input")){c.val(d)}else{c.html(d)}}},_unlock:function(){b(this).data("readonly",false).css("cursor","pointer").removeAttr("title");this.score.removeAttr("readonly","readonly");for(var c=0;c<this.opt.number;c++){this.stars.eq(c).attr("title",a._getHint.call(this,c+1))}if(this.cancel){this.cancel.css("display","")}},cancel:function(c){return this.each(function(){if(b(this).data("readonly")!==true){a[c?"click":"score"].call(this,null);this.score.removeAttr("value")}})},click:function(c){return b(this).each(function(){if(b(this).data("readonly")!==true){a._apply.call(this,c);if(!this.opt.click){a._error.call(this,'You must add the "click: function(score, evt) { }" callback.')}this.opt.click.call(this,c,{type:"click"});a._target.call(this,c)}})},destroy:function(){return b(this).each(function(){var d=b(this),c=d.data("raw");if(c){d.off(".raty").empty().css({cursor:c.style.cursor,width:c.style.width}).removeData("readonly")}else{d.data("raw",d.clone()[0])}})},getScore:function(){var d=[],c;b(this).each(function(){c=this.score.val();d.push(c?parseFloat(c):undefined)});return(d.length>1)?d:d[0]},readOnly:function(c){return this.each(function(){var d=b(this);if(d.data("readonly")!==c){if(c){d.off(".raty").children("img").off(".raty");a._lock.call(this)}else{a._binds.call(this);a._unlock.call(this)}d.data("readonly",c)}})},reload:function(){return a.set.call(this,{})},score:function(){return arguments.length?a.setScore.apply(this,arguments):a.getScore.call(this)},set:function(c){return this.each(function(){var f=b(this),d=f.data("settings"),e=b.extend({},d,c);f.raty(e)})},setScore:function(c){return b(this).each(function(){if(b(this).data("readonly")!==true){a._apply.call(this,c);a._target.call(this,c)}})}};b.fn.raty=function(c){if(a[c]){return a[c].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof c==="object"||!c){return a.init.apply(this,arguments)}else{b.error("Method "+c+" does not exist!")}}};b.fn.raty.defaults={cancel:false,cancelHint:"Cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:undefined,half:false,halfShow:true,hints:["bad","poor","regular","good","gorgeous"],iconRange:undefined,mouseout:undefined,mouseover:undefined,noRatedMsg:"Not rated yet!",number:5,numberMax:20,path:"",precision:false,readOnly:false,round:{down:0.25,full:0.6,up:0.76},score:undefined,scoreName:"score",single:false,size:16,space:true,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",target:undefined,targetFormat:"{score}",targetKeep:false,targetText:"",targetType:"hint",width:undefined}})(jQuery);