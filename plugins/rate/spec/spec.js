isClear=true;function context(c,d){describe(c,d)}function build(){$("body").append('<div id="element"></div>')}function buildDivTarget(){$("body").append('<div id="hint"></div>')}function buildComboboxTarget(){$("body").append('<select id="hint"><option value="Cancel this rating!">cancel hint default</option><option value="cancel-hint-custom">cancel hint custom</option><option value="">cancel number default</option><option value="0">cancel number custom</option><option value="bad">bad hint imutable</option><option value="1">bad number imutable</option><option value="targetText">targetText is setted without targetKeep</option><option value="score: bad">targetFormat</option></select>')}function buildTextareaTarget(){$("body").append('<textarea id="hint"></textarea>')}function buildTextTarget(){$("body").append('<input id="hint" type="text" />')}function clear(){if(isClear){$("#element").remove();$("#hint").remove()}}describe("Raty",function(){beforeEach(function(){build()});afterEach(function(){clear()});it("has the right values",function(){var c=$.fn.raty;var d=c.defaults;expect(d.cancel).toBeFalsy();expect(d.cancelHint).toEqual("Cancel this rating!");expect(d.cancelOff).toEqual("cancel-off.png");expect(d.cancelOn).toEqual("cancel-on.png");expect(d.cancelPlace).toEqual("left");expect(d.click).toBeUndefined();expect(d.half).toBeFalsy();expect(d.halfShow).toBeTruthy();expect(d.hints).toContain("bad","poor","regular","good","gorgeous");expect(d.iconRange).toBeUndefined();expect(d.mouseover).toBeUndefined();expect(d.noRatedMsg).toEqual("Not rated yet!");expect(d.number).toBe(5);expect(d.path).toEqual("");expect(d.precision).toBeFalsy();expect(d.readOnly).toBeFalsy();expect(d.round.down).toEqual(0.25);expect(d.round.full).toEqual(0.6);expect(d.round.up).toEqual(0.76);expect(d.score).toBeUndefined();expect(d.scoreName).toEqual("score");expect(d.single).toBeFalsy();expect(d.size).toBe(16);expect(d.space).toBeTruthy();expect(d.starHalf).toEqual("star-half.png");expect(d.starOff).toEqual("star-off.png");expect(d.starOn).toEqual("star-on.png");expect(d.target).toBeUndefined();expect(d.targetFormat).toEqual("{score}");expect(d.targetKeep).toBeFalsy();expect(d.targetText).toEqual("");expect(d.targetType).toEqual("hint");expect(d.width).toBeUndefined()});describe("common features",function(){it("is chainable",function(){var d=$("#element");var c=d.raty();expect(c).toBe(d)});it("creates the default markup",function(){var e=$("#element");e.raty();var f=e.children("img"),d=e.children("input");expect(f.eq(0)).toHaveAttr("title","bad");expect(f.eq(1)).toHaveAttr("title","poor");expect(f.eq(2)).toHaveAttr("title","regular");expect(f.eq(3)).toHaveAttr("title","good");expect(f.eq(4)).toHaveAttr("title","gorgeous");expect(f).toHaveAttr("src","star-off.png");expect(d).toHaveAttr("type","hidden");expect(d).toHaveAttr("name","score");expect(d.val()).toEqual("")})});describe("#star",function(){it("starts all off",function(){var b=$("#element");b.raty();expect(b.children("img")).toHaveAttr("src","star-off.png")});context("on :mouseover",function(){it("turns on the stars",function(){var d=$("#element").raty(),c=d.children("img");c.eq(4).mouseover();expect(c).toHaveAttr("src","star-on.png")});context("and :mouseout",function(){it("clears all stars",function(){var d=$("#element").raty(),c=d.children("img");c.eq(4).mouseover().mouseout();expect(c).toHaveAttr("src","star-off.png")})})});context("on rating",function(){it("changes the score",function(){var d=$("#element").raty(),c=d.children("img");c.eq(1).mouseover().click();expect(d.children("input")).toHaveValue(2)});context("on :mouseout",function(){it("keeps the stars on",function(){var d=$("#element").raty(),c=d.children("img");c.eq(4).mouseover().click().mouseout();expect(c).toHaveAttr("src","star-on.png")})})})});describe("options",function(){describe("#numberMax",function(){it("limits to 20 stars",function(){var d=$("#element").raty({number:50,score:50});var c=d.raty("score");expect(d.children("img").length).toEqual(20);expect(d.children("input")).toHaveValue(20)});context("with custom numberMax",function(){it("chages the limit",function(){var d=$("#element").raty({numberMax:10,number:50,score:50});var c=d.raty("score");expect(d.children("img").length).toEqual(10);expect(d.children("input")).toHaveValue(10)})})});describe("#starOff",function(){it("changes the icons",function(){var b=$("#element");b.raty({starOff:"icon.png"});expect(b.children("img")).toHaveAttr("src","icon.png")})});describe("#starOn",function(){it("changes the icons",function(){var d=$("#element").raty({starOn:"icon.png"}),c=d.children("img");c.eq(3).mouseover();expect(c.eq(0)).toHaveAttr("src","icon.png");expect(c.eq(1)).toHaveAttr("src","icon.png");expect(c.eq(2)).toHaveAttr("src","icon.png");expect(c.eq(3)).toHaveAttr("src","icon.png");expect(c.eq(4)).toHaveAttr("src","star-off.png")})});describe("#iconRange",function(){it("uses icon intervals",function(){var d=$("#element");d.raty({iconRange:[{range:2,on:"a.png",off:"a-off.png"},{range:3,on:"b.png",off:"b-off.png"},{range:4,on:"c.png",off:"c-off.png"},{range:5,on:"d.png",off:"d-off.png"}]});var c=d.children("img");expect(c.eq(0)).toHaveAttr("src","a-off.png");expect(c.eq(1)).toHaveAttr("src","a-off.png");expect(c.eq(2)).toHaveAttr("src","b-off.png");expect(c.eq(3)).toHaveAttr("src","c-off.png");expect(c.eq(4)).toHaveAttr("src","d-off.png")});context("when off icon is not especified",function(){it("uses the :starOff icon",function(){var b=$("#element");b.raty({iconRange:[{range:2,on:"on.png",off:"off.png"},{range:3,on:"on.png",off:"off.png"},{range:4,on:"on.png",off:"off.png"},{range:5,on:"on.png"}]});expect(b.children("img").eq(4)).toHaveAttr("src","star-off.png")})});context("on mouseover",function(){it("uses the on icon",function(){var d=$("#element").raty({iconRange:[{range:2,on:"a.png",off:"a-off.png"},{range:3,on:"b.png",off:"b-off.png"},{range:4,on:"c.png",off:"c-off.png"},{range:5,on:"d.png",off:"d-off.png"}]}),c=d.children("img");c.eq(4).mouseover();expect(c.eq(0)).toHaveAttr("src","a.png");expect(c.eq(1)).toHaveAttr("src","a.png");expect(c.eq(2)).toHaveAttr("src","b.png");expect(c.eq(3)).toHaveAttr("src","c.png");expect(c.eq(4)).toHaveAttr("src","d.png")});context("when on icon is not especified",function(){it("uses the :starOn icon",function(){var d=$("#element").raty({iconRange:[{range:2,off:"off.png",on:"on.png"},{range:3,off:"off.png",on:"on.png"},{range:4,off:"off.png",on:"on.png"},{range:5,off:"off.png"}]}),c=d.children("img");c.eq(4).mouseover();expect(c.eq(0)).toHaveAttr("src","on.png");expect(c.eq(1)).toHaveAttr("src","on.png");expect(c.eq(2)).toHaveAttr("src","on.png");expect(c.eq(3)).toHaveAttr("src","on.png");expect(c.eq(4)).toHaveAttr("src","star-on.png")})})});context("on mouseout",function(){it("changes to off icons",function(){var d=$("#element").raty({iconRange:[{range:2,on:"a.png",off:"a-off.png"},{range:3,on:"b.png",off:"b-off.png"},{range:4,on:"c.png",off:"c-off.png"},{range:5,on:"d.png",off:"d-off.png"}]}),c=d.children("img");c.eq(4).mouseover();d.mouseleave();expect(c.eq(0)).toHaveAttr("src","a-off.png");expect(c.eq(1)).toHaveAttr("src","a-off.png");expect(c.eq(2)).toHaveAttr("src","b-off.png");expect(c.eq(3)).toHaveAttr("src","c-off.png");expect(c.eq(4)).toHaveAttr("src","d-off.png")});it("keeps the score value",function(){var b=$("#element").raty({iconRange:[{range:2,on:"a.png",off:"a-off.png"},{range:3,on:"b.png",off:"b-off.png"},{range:4,on:"c.png",off:"c-off.png"},{range:5,on:"d.png",off:"d-off.png"}],score:1});b.children("img").eq(4).mouseover();b.mouseleave();expect(b.children("input")).toHaveValue(1)});context("when off icon is not especified",function(){it("uses the :starOff icon",function(){var c=$("#element").raty({iconRange:[{range:2,on:"on.png",off:"off.png"},{range:3,on:"on.png",off:"off.png"},{range:4,on:"on.png",off:"off.png"},{range:5,on:"on.png"}]}),d=c.children("img").eq(4);d.mouseover();c.mouseleave();expect(d).toHaveAttr("src","star-off.png")})})})});describe("#click",function(){it("has `this` as the self element",function(){var b=$("#element").raty({click:function(){$(this).data("self",this)}});b.children("img:first").mouseover().click();expect(b.data("self")).toBe(b)});it("is called on star click",function(){var b=$("#element").raty({click:function(){$(this).data("clicked",true)}});b.children("img:first").mouseover().click();expect(b.data("clicked")).toBeTruthy()});it("receives the score",function(){var b=$("#element").raty({click:function(a){$(this).data("score",a)}});b.children("img:first").mouseover().click();expect(b.data("score")).toEqual(1)});context("with :cancel",function(){it("executes cancel click callback",function(){var b=$("#element").raty({cancel:true,click:function(a){$(this).data("score",null)}});b.children(".raty-cancel").mouseover().click().mouseleave();expect(b.data("score")).toBeNull()})})});describe("#score",function(){it("starts with value",function(){var b=$("#element");b.raty({score:1});expect(b.children("input")).toHaveValue(1)});it("turns on 1 stars",function(){var d=$("#element");d.raty({score:1});var c=d.children("img");expect(c.eq(0)).toHaveAttr("src","star-on.png");expect(c.eq(1)).toHaveAttr("src","star-off.png");expect(c.eq(2)).toHaveAttr("src","star-off.png");expect(c.eq(3)).toHaveAttr("src","star-off.png");expect(c.eq(4)).toHaveAttr("src","star-off.png")});it("accepts callback",function(){var b=$("#element");b.raty({score:function(){return 1}});expect(b.raty("score")).toEqual(1)});context("with negative number",function(){it("gets none score",function(){var b=$("#element");b.raty({score:-1});expect(b.children("input").val()).toEqual("")})});context("with :readOnly",function(){it("becomes readOnly too",function(){var b=$("#element");b.raty({readOnly:true});expect(b.children("input")).toHaveAttr("readonly","readonly")})})});describe("#scoreName",function(){it("changes the score field name",function(){var b=$("#element");b.raty({scoreName:"entity.score"});expect(b.children("input")).toHaveAttr("name","entity.score")})});it("accepts callback",function(){var b=$("#element");b.raty({scoreName:function(){return"custom"}});expect(b.data("settings").scoreName).toEqual("custom")});describe("#readOnly",function(){it('Applies "Not rated yet!" on stars',function(){var b=$("#element");b.raty({readOnly:true});expect(b.children("img")).toHaveAttr("title","Not rated yet!")});it("removes the pointer cursor",function(){var b=$("#element");b.raty({readOnly:true});expect(b).not.toHaveCss({cursor:"pointer"});expect(b).not.toHaveCss({cursor:"default"})});it("accepts callback",function(){var b=$("#element");b.raty({readOnly:function(){return true}});expect(b.data("settings").readOnly).toEqual(true)});it("avoids trigger mouseover",function(){var d=$("#element").raty({readOnly:true}),c=d.children("img");c.eq(1).mouseover();expect(c).toHaveAttr("src","star-off.png")});it("avoids trigger click",function(){var d=$("#element").raty({readOnly:true}),c=d.children("img");c.eq(1).mouseover().click().mouseleave();expect(c).toHaveAttr("src","star-off.png");expect(d.children("input").val()).toEqual("")});it("avoids trigger mouseleave",function(){var d=$("#element").raty({readOnly:true,mouseout:function(){$(this).data("mouseleave",true)}}),c=d.children("img");c.eq(1).mouseover();d.mouseleave();expect(d.data("mouseleave")).toBeFalsy()});context("with :score",function(){context("as integer",function(){it("applies the score title on stars",function(){var b=$("#element");b.raty({readOnly:true,score:3});expect(b.children("img")).toHaveAttr("title","regular")})});context("as float",function(){it("applies the integer score title on stars",function(){var b=$("#element");b.raty({readOnly:true,score:3.1});expect(b.children("img")).toHaveAttr("title","regular")})})});context("with :cancel",function(){it("hides the button",function(){var b=$("#element");b.raty({cancel:true,readOnly:true,path:"../lib/img"});expect(b.children(".raty-cancel")).toBeHidden()})})});describe("#hints",function(){it("changes the hints",function(){var d=$("#element");d.raty({hints:["1","/","c","-","#"]});var c=d.children("img");expect(c.eq(0)).toHaveAttr("title",1);expect(c.eq(1)).toHaveAttr("title","/");expect(c.eq(2)).toHaveAttr("title","c");expect(c.eq(3)).toHaveAttr("title","-");expect(c.eq(4)).toHaveAttr("title","#")});it("receives the number of the star when is undefined",function(){var d=$("#element");d.raty({hints:[undefined,"a","b","c","d"]});var c=d.children("img");expect(c.eq(0)).toHaveAttr("title","bad");expect(c.eq(1)).toHaveAttr("title","a");expect(c.eq(2)).toHaveAttr("title","b");expect(c.eq(3)).toHaveAttr("title","c");expect(c.eq(4)).toHaveAttr("title","d")});it("receives empty when is empty string",function(){var d=$("#element");d.raty({hints:["","a","b","c","d"]});var c=d.children("img");expect(c.eq(0)).toHaveAttr("title","");expect(c.eq(1)).toHaveAttr("title","a");expect(c.eq(2)).toHaveAttr("title","b");expect(c.eq(3)).toHaveAttr("title","c");expect(c.eq(4)).toHaveAttr("title","d")});it("receives the number of the star when is null",function(){var d=$("#element");d.raty({hints:[null,"a","b","c","d"]});var c=d.children("img");expect(c.eq(0)).toHaveAttr("title",1);expect(c.eq(1)).toHaveAttr("title","a");expect(c.eq(2)).toHaveAttr("title","b");expect(c.eq(3)).toHaveAttr("title","c");expect(c.eq(4)).toHaveAttr("title","d")});context("whe has less hint than stars",function(){it("receives the default hint index",function(){var d=$("#element");d.raty({hints:["1","2","3","4"]});var c=d.children("img");expect(c.eq(0)).toHaveAttr("title",1);expect(c.eq(1)).toHaveAttr("title",2);expect(c.eq(2)).toHaveAttr("title",3);expect(c.eq(3)).toHaveAttr("title",4);expect(c.eq(4)).toHaveAttr("title","gorgeous")})});context("whe has more stars than hints",function(){it("sets star number",function(){var d=$("#element");d.raty({number:6,hints:["a","b","c","d","e"]});var c=d.children("img");expect(c.eq(0)).toHaveAttr("title","a");expect(c.eq(1)).toHaveAttr("title","b");expect(c.eq(2)).toHaveAttr("title","c");expect(c.eq(3)).toHaveAttr("title","d");expect(c.eq(4)).toHaveAttr("title","e");expect(c.eq(5)).toHaveAttr("title",6)})})});describe("#mouseover",function(){it("receives the score as int",function(){var b=$("#element").raty({mouseover:function(a){$(this).data("score",a)}});b.children("img:first").mouseover();expect(b.data("score")).toEqual(1)});it("receives the event",function(){var b=$("#element").raty({mouseover:function(d,a){$(this).data("evt",a)}});b.children("img:first").mouseover();expect(b.data("evt").type).toEqual("mouseover")});context("with :cancel",function(){it("receives null as score",function(){var b=$("#element").raty({cancel:true,mouseover:function(a){b.data("null",a)}});b.children(".raty-cancel").mouseover();expect(b.data("null")).toBeNull()})})});describe("#mouseout",function(){it("receives the score as int",function(){var b=$("#element").raty({mouseout:function(a){$(this).data("score",a)}});b.children("img:first").mouseover().click().mouseout();expect(b.data("score")).toEqual(1)});it("receives the event",function(){var b=$("#element").raty({mouseout:function(d,a){$(this).data("evt",a)}});b.children("img:first").mouseover().click().mouseout();expect(b.data("evt").type).toEqual("mouseout")});context("without score setted",function(){it("pass undefined on callback",function(){var b=$("#element").raty({cancel:true,mouseout:function(a){b.data("undefined",a===undefined)}});b.children("img:first").mouseenter().mouseleave();expect(b.data("undefined")).toBeTruthy()})});context("with :score rated",function(){it("pass the score on callback",function(){var b=$("#element").raty({score:1,mouseout:function(a){b.data("score",a)}});b.children("img:first").mouseenter().mouseleave();expect(b.data("score")).toEqual(1)})});context("with :cancel",function(){it("receives the event",function(){var b=$("#element").raty({cancel:true,mouseout:function(d,a){$(this).data("evt",a)}});b.children(".raty-cancel").mouseover().click().mouseout();expect(b.data("evt").type).toEqual("mouseout")});context("without score setted",function(){it("pass undefined on callback",function(){var b=$("#element").raty({mouseout:function(a){b.data("undefined",a===undefined)},cancel:true});b.children(".raty-cancel").mouseenter().mouseleave();expect(b.data("undefined")).toBeTruthy()})});context("with :score rated",function(){it("pass the score on callback",function(){var b=$("#element").raty({mouseout:function(a){b.data("score",a)},cancel:true,score:1});b.children(".raty-cancel").mouseenter().mouseleave();expect(b.data("score")).toEqual(1)})})})});describe("#number",function(){it("changes the number of stars",function(){var b=$("#element");b.raty({number:1});expect(b.children("img").length).toEqual(1)});it("accepts number as string",function(){var b=$("#element");b.raty({number:"10"});expect(b.children("img").length).toEqual(10)});it("accepts callback",function(){var b=$("#element");b.raty({number:function(){return 1}});expect(b.children("img").length).toEqual(1)})});describe("#path",function(){context("without last slash",function(){it("receives the slash",function(){var b=$("#element");b.raty({path:"path"});expect(b[0].opt.path).toEqual("path/")})});context("with last slash",function(){it("keeps it",function(){var b=$("#element");b.raty({path:"path/"});expect(b[0].opt.path).toEqual("path/")})});it("changes the path",function(){var b=$("#element");b.raty({path:"path"});expect(b.children("img")).toHaveAttr("src","path/star-off.png")});context("without path",function(){it("sets receives empty",function(){var b=$("#element");b.raty({path:null});expect(b.children("img")).toHaveAttr("src","star-off.png")})});context("with :cancel",function(){it("changes the path",function(){var b=$("#element");b.raty({cancel:true,path:"path"});expect(b.children(".raty-cancel")).toHaveAttr("src","path/cancel-off.png")})});context("with :iconRange",function(){it("changes the path",function(){var b=$("#element");b.raty({path:"path",iconRange:[{range:5}]});expect(b.children("img")).toHaveAttr("src","path/star-off.png")})})});describe("#cancelOff",function(){it("changes the icon",function(){var b=$("#element");b.raty({cancel:true,cancelOff:"off.png"});expect(b.children(".raty-cancel")).toHaveAttr("src","off.png")})});describe("#cancelOn",function(){it("changes the icon",function(){var d=$("#element").raty({cancel:true,cancelOn:"icon.png"});var c=d.children(".raty-cancel").mouseover();expect(c).toHaveAttr("src","icon.png")})});describe("#cancelHint",function(){it("changes the cancel hint",function(){var b=$("#element");b.raty({cancel:true,cancelHint:"hint"});expect(b.children(".raty-cancel")).toHaveAttr("title","hint")})});describe("#cancelPlace",function(){it("changes the place off cancel button",function(){var d=$("#element");d.raty({cancel:true,cancelPlace:"right"});var c=d.children("img:last");expect(c).toHaveClass("raty-cancel");expect(c).toHaveAttr("title","Cancel this rating!");expect(c).toHaveAttr("alt","x");expect(c).toHaveAttr("src","cancel-off.png")})});describe("#cancel",function(){it("creates the element",function(){var d=$("#element");d.raty({cancel:true});var c=d.children(".raty-cancel");expect(c).toHaveClass("raty-cancel");expect(c).toHaveAttr("title","Cancel this rating!");expect(c).toHaveAttr("alt","x");expect(c).toHaveAttr("src","cancel-off.png")});context("on mouseover",function(){it("turns on",function(){var d=$("#element").raty({cancel:true});var c=d.children(".raty-cancel").mouseover();expect(c).toHaveAttr("src","cancel-on.png")});context("with :score",function(){it("turns off the stars",function(){var d=$("#element").raty({score:3,cancel:true}),c=d.children("img:not(.raty-cancel)");d.children(".raty-cancel").mouseover();expect(c).toHaveAttr("src","star-off.png")})})});context("when :mouseout",function(){it("turns on",function(){var d=$("#element").raty({cancel:true});var c=d.children(".raty-cancel").mouseover().mouseout();expect(c).toHaveAttr("src","cancel-off.png")});context("with :score",function(){it("turns the star on again",function(){var d=$("#element").raty({score:4,cancel:true}),c=d.children("img:not(.raty-cancel)");d.children(".raty-cancel").mouseover().mouseout();expect(c.eq(0)).toHaveAttr("src","star-on.png");expect(c.eq(1)).toHaveAttr("src","star-on.png");expect(c.eq(2)).toHaveAttr("src","star-on.png");expect(c.eq(3)).toHaveAttr("src","star-on.png");expect(c.eq(4)).toHaveAttr("src","star-off.png")})})});context("on click",function(){it("cancel the rating",function(){var c=$("#element").raty({cancel:true,score:1});c.children(".raty-cancel").click().mouseout();var d=c.children("img:not(.raty-cancel)");expect(d).toHaveAttr("src","star-off.png");expect(c.children("input").val()).toEqual("")})});context("when starts :readOnly",function(){it("starts hidden",function(){var b=$("#element").raty({cancel:true,readOnly:true,path:"../img"});b.raty("readOnly",true);expect(b.children(".raty-cancel")).toBeHidden()});context("on click",function(){it("does not cancel the rating",function(){var c=$("#element").raty({cancel:true,readOnly:true,score:5});c.children(".raty-cancel").click().mouseout();var d=c.children("img:not(.raty-cancel)");expect(d).toHaveAttr("src","star-on.png");expect(c.children("input").val()).toEqual("5")})})});context("when become :readOnly",function(){it("becomes hidden",function(){var b=$("#element").raty({cancel:true,path:"../img"});b.raty("readOnly",true);expect(b.children(".raty-cancel")).toBeHidden()})})});describe("#targetType",function(){beforeEach(function(){buildDivTarget()});context("with missing target",function(){it("throws error",function(){var c=$("#element");var d=function(){c.raty({target:"missing"})};expect(d).toThrow(new Error("Target selector invalid or missing!"))})});context("as hint",function(){it("receives the hint",function(){var b=$("#element").raty({target:"#hint",targetType:"hint"});b.children("img:first").mouseover();expect($("#hint")).toHaveHtml("bad")});context("with :cancel",function(){it("receives the :cancelHint",function(){var b=$("#element").raty({cancel:true,target:"#hint",targetType:"hint"});b.children(".raty-cancel").mouseover();expect($("#hint")).toHaveHtml("Cancel this rating!")})})});context("as score",function(){it("receives the score",function(){var b=$("#element").raty({target:"#hint",targetType:"score"});b.children("img:first").mouseover();expect($("#hint")).toHaveHtml(1)});context("with :cancel",function(){it("receives the :cancelHint",function(){var b=$("#element").raty({cancel:true,target:"#hint",targetType:"score"});b.children(".raty-cancel").mouseover();expect($("#hint")).toHaveHtml("Cancel this rating!")})})})});describe("#targetText",function(){beforeEach(function(){buildDivTarget()});it("set target with none value",function(){var b=$("#element");b.raty({target:"#hint",targetText:"none"});expect($("#hint")).toHaveHtml("none")})});describe("#targetFormat",function(){context("with :target",function(){beforeEach(function(){buildDivTarget()});it("stars empty",function(){var b=$("#element");b.raty({target:"#hint",targetFormat:"score: {score}"});expect($("#hint")).toBeEmpty()});context("with missing score key",function(){it("throws error",function(){var c=$("#element");var d=function(){c.raty({target:"#hint",targetFormat:""})};expect(d).toThrow(new Error('Template "{score}" missing!'))})});context("on mouseover",function(){it("set target with format on mouseover",function(){var b=$("#element").raty({target:"#hint",targetFormat:"score: {score}"});b.children("img:first").mouseover();expect($("#hint")).toHaveHtml("score: bad")})});context("on mouseout",function(){it("clears the target",function(){var b=$("#element").raty({target:"#hint",targetFormat:"score: {score}"});b.children("img:first").mouseover().mouseout();expect($("#hint")).toBeEmpty()});context("with :targetKeep",function(){context("without score",function(){it("clears the target",function(){var b=$("#element").raty({target:"#hint",targetFormat:"score: {score}",targetKeep:true});b.children("img:first").mouseover().mouseleave();expect($("#hint")).toBeEmpty()})});context("with score",function(){it("keeps the template",function(){var b=$("#element").raty({score:1,target:"#hint",targetFormat:"score: {score}",targetKeep:true});b.children("img:first").mouseover().mouseleave();expect($("#hint")).toHaveHtml("score: bad")})})})})})});describe("#precision",function(){beforeEach(function(){buildDivTarget()});it("enables the :half options",function(){var b=$("#element");b.raty({precision:true});expect(b.data("settings").half).toBeTruthy()});it("changes the :targetType to score",function(){var b=$("#element");b.raty({precision:true});expect(b.data("settings").targetType).toEqual("score")});context("with :target",function(){context("with :targetKeep",function(){context("with :score",function(){it("sets the float with one fractional number",function(){var b=$("#element");b.raty({precision:true,score:1.23,target:"#hint",targetKeep:true,targetType:"score"});expect($("#hint")).toHaveHtml("1.2")})})})})});describe("#target",function(){context("on mouseover",function(){context("as div",function(){beforeEach(function(){buildDivTarget()});it("sets the hint",function(){var b=$("#element").raty({target:"#hint"});b.children("img:first").mouseover();expect($("#hint")).toHaveHtml("bad")})});context("as text field",function(){beforeEach(function(){buildTextTarget()});it("sets the hint",function(){var b=$("#element").raty({target:"#hint"});b.children("img:first").mouseover();expect($("#hint")).toHaveValue("bad")})});context("as textarea",function(){beforeEach(function(){buildTextareaTarget()});it("sets the hint",function(){var b=$("#element").raty({target:"#hint"});b.children("img:first").mouseover();expect($("#hint")).toHaveValue("bad")})});context("as combobox",function(){beforeEach(function(){buildComboboxTarget()});it("sets the hint",function(){var b=$("#element").raty({target:"#hint"});b.children("img:first").mouseover();expect($("#hint")).toHaveValue("bad")})})});context("on mouseout",function(){context("as div",function(){beforeEach(function(){buildDivTarget()});it("gets clear",function(){var b=$("#element").raty({target:"#hint"});b.children("img:first").mouseover().click().mouseleave();expect($("#hint")).toBeEmpty()})});context("as textarea",function(){beforeEach(function(){buildTextareaTarget()});it("gets clear",function(){var b=$("#element").raty({target:"#hint"});b.children("img:first").click().mouseover().mouseleave();expect($("#hint")).toHaveValue("")})});context("as text field",function(){beforeEach(function(){buildTextTarget()});it("gets clear",function(){var b=$("#element").raty({target:"#hint"});b.children("img:first").click().mouseover().mouseleave();expect($("#hint")).toHaveValue("")})});context("as combobox",function(){beforeEach(function(){buildComboboxTarget()});it("gets clear",function(){var b=$("#element").raty({target:"#hint"});b.children("img:first").click().mouseover().mouseleave();expect($("#hint")).toHaveValue("")})})})});describe("#size",function(){it("calculate the right icon size",function(){var e=$("#element"),h=24,f=5,g=4;e.raty({size:h});expect(e.width()).toEqual((f*h)+(f*g))});context("with :cancel",function(){it("addes the cancel and space witdh",function(){var f=$("#element"),j=24,g=5,i=j,h=4;f.raty({cancel:true,size:j});expect(f.width()).toEqual(i+h+(g*j)+(g*h))})})});describe("#space",function(){context("when off",function(){it("takes off the space",function(){var b=$("#element");size=16,stars=5;b.raty({space:false});expect(b.width()).toEqual(size*stars)});context("with :cancel",function(){it("takes off the space",function(){var b=$("#element");size=16,stars=5,cancel=size;b.raty({cancel:true,space:false});expect(b.width()).toEqual(cancel+(size*stars))})})})});describe("#single",function(){context("on mouseover",function(){it("turns on just one icon",function(){var d=$("#element").raty({single:true}),c=d.children("img");c.eq(2).mouseover();expect(c.eq(0)).toHaveAttr("src","star-off.png");expect(c.eq(1)).toHaveAttr("src","star-off.png");expect(c.eq(2)).toHaveAttr("src","star-on.png");expect(c.eq(3)).toHaveAttr("src","star-off.png");expect(c.eq(4)).toHaveAttr("src","star-off.png")});context("with :iconRange",function(){it("shows just on icon",function(){var d=$("#element").raty({single:true,iconRange:[{range:2,on:"a.png",off:"a-off.png"},{range:3,on:"b.png",off:"b-off.png"},{range:4,on:"c.png",off:"c-off.png"},{range:5,on:"d.png",off:"d-off.png"}]}),c=d.children("img");c.eq(3).mouseover();expect(c.eq(0)).toHaveAttr("src","a-off.png");expect(c.eq(1)).toHaveAttr("src","a-off.png");expect(c.eq(2)).toHaveAttr("src","b-off.png");expect(c.eq(3)).toHaveAttr("src","c.png");expect(c.eq(4)).toHaveAttr("src","d-off.png")})})});context("on click",function(){context("on mouseout",function(){it("keeps the score",function(){var b=$("#element").raty({single:true});imgs=b.children("img");imgs.eq(2).mouseover().click().mouseleave();expect(imgs.eq(0)).toHaveAttr("src","star-off.png");expect(imgs.eq(1)).toHaveAttr("src","star-off.png");expect(imgs.eq(2)).toHaveAttr("src","star-on.png");expect(imgs.eq(3)).toHaveAttr("src","star-off.png");expect(imgs.eq(4)).toHaveAttr("src","star-off.png")});context("and :iconRange",function(){it("keeps the score",function(){var d=$("#element").raty({single:true,iconRange:[{range:2,on:"a.png",off:"a-off.png"},{range:3,on:"b.png",off:"b-off.png"},{range:4,on:"c.png",off:"c-off.png"},{range:5,on:"d.png",off:"d-off.png"}]}),c=d.children("img");c.eq(3).mouseover().click().mouseleave();expect(c.eq(0)).toHaveAttr("src","a-off.png");expect(c.eq(1)).toHaveAttr("src","a-off.png");expect(c.eq(2)).toHaveAttr("src","b-off.png");expect(c.eq(3)).toHaveAttr("src","c.png");expect(c.eq(4)).toHaveAttr("src","d-off.png")})})})})});describe("#width",function(){it("set custom width",function(){var b=$("#element");b.raty({width:200});expect(b.width()).toEqual(200)});describe("when it is false",function(){it("does not apply the style",function(){var b=$("#element");b.raty({width:false});expect(b).not.toHaveCss({width:"100px"})})});describe("when :readOnly",function(){it("set custom width when readOnly",function(){var b=$("#element");b.raty({readOnly:true,width:200});expect(b.width()).toEqual(200)})})});describe("#half",function(){context("as false",function(){context("#halfShow",function(){context("as false",function(){it("rounds down while less the full limit",function(){var d=$("#element");d.raty({half:false,halfShow:false,round:{down:0.25,full:0.6,up:0.76},score:0.5});var c=d.children("img");expect(c.eq(0)).toHaveAttr("src","star-off.png");expect(c.eq(1)).toHaveAttr("src","star-off.png")});it("rounds full when equal the full limit",function(){var d=$("#element");d.raty({half:false,halfShow:false,round:{down:0.25,full:0.6,up:0.76},score:0.6});var c=d.children("img");expect(c.eq(0)).toHaveAttr("src","star-on.png")})})})});context("as true",function(){context("#halfShow",function(){context("as false",function(){it("ignores round down while less down limit",function(){var d=$("#element");d.raty({half:true,halfShow:false,round:{down:0.25,full:0.6,up:0.76},score:0.24});var c=d.children("img");expect(c.eq(0)).toHaveAttr("src","star-off.png");expect(d.children("input").val()).toEqual("0.24")});it("ignores half while greater then down limit",function(){var d=$("#element");d.raty({half:true,halfShow:false,round:{down:0.25,full:0.6,up:0.76},score:0.26});var c=d.children("img");expect(c.eq(0)).toHaveAttr("src","star-off.png");expect(d.children("input").val()).toEqual("0.26")});it("ignores half while equal full limit, ignoring it",function(){var d=$("#element");d.raty({half:true,halfShow:false,round:{down:0.25,full:0.6,up:0.76},score:0.6});var c=d.children("img");expect(c.eq(0)).toHaveAttr("src","star-on.png");expect(d.children("input").val()).toEqual("0.6")});it("ignores half while greater than down limit and less than up limit",function(){var d=$("#element");d.raty({half:true,halfShow:false,round:{down:0.25,full:0.6,up:0.76},score:0.75});var c=d.children("img");expect(c.eq(0)).toHaveAttr("src","star-on.png");expect(d.children("input").val()).toEqual("0.75")});it("ignores full while equal or greater than up limit",function(){var d=$("#element");d.raty({half:true,halfShow:false,round:{down:0.25,full:0.6,up:0.76},score:0.76});var c=d.children("img");expect(c.eq(0)).toHaveAttr("src","star-on.png")})});context("as true",function(){it("rounds down while less down limit",function(){var d=$("#element");d.raty({half:true,halfShow:true,round:{down:0.25,full:0.6,up:0.76},score:0.24});var c=d.children("img");expect(c.eq(0)).toHaveAttr("src","star-off.png")});it("receives half while greater then down limit",function(){var d=$("#element");d.raty({half:true,halfShow:true,round:{down:0.25,full:0.6,up:0.76},score:0.26});var c=d.children("img");expect(c.eq(0)).toHaveAttr("src","star-half.png")});it("receives half while equal full limit, ignoring it",function(){var d=$("#element");d.raty({half:true,halfShow:true,round:{down:0.25,full:0.6,up:0.76},score:0.6});var c=d.children("img");expect(c.eq(0)).toHaveAttr("src","star-half.png")});it("receives half while greater than down limit and less than up limit",function(){var d=$("#element");d.raty({half:true,halfShow:true,round:{down:0.25,full:0.6,up:0.76},score:0.75});var c=d.children("img");expect(c.eq(0)).toHaveAttr("src","star-half.png")});it("receives full while equal or greater than up limit",function(){var d=$("#element");d.raty({half:true,halfShow:true,round:{down:0.25,full:0.6,up:0.76},score:0.76});var c=d.children("img");expect(c.eq(0)).toHaveAttr("src","star-on.png")})})});context("with :target",function(){beforeEach(function(){buildDivTarget()});context("and :precision",function(){context("and :targetType as score",function(){context("and :targetKeep",function(){context("and :targetType as score",function(){it("set .5 increment value target with half option and no precision",function(){var b=$("#element");b.raty({half:true,precision:false,score:1.5,target:"#hint",targetKeep:true,targetType:"score"});expect($("#hint")).toHaveHtml("1.5")})})})})})})})})});describe("class bind",function(){beforeEach(function(){$("body").append('<div class="element"></div><div class="element"></div>')});afterEach(function(){$(".element").remove()});it("is chainable",function(){var c=$(".element");var d=c.raty();expect(d.eq(0)).toBe(c.eq(0));expect(d.eq(1)).toBe(c.eq(1))});it("creates the default markup",function(){var e=$(".element");e.raty();var f=e.eq(0).children("img"),d=e.eq(0).children("input");expect(f.eq(0)).toHaveAttr("title","bad");expect(f.eq(1)).toHaveAttr("title","poor");expect(f.eq(2)).toHaveAttr("title","regular");expect(f.eq(3)).toHaveAttr("title","good");expect(f.eq(4)).toHaveAttr("title","gorgeous");expect(f).toHaveAttr("src","star-off.png");expect(d).toHaveAttr("type","hidden");expect(d).toHaveAttr("name","score");expect(d.val()).toEqual("");f=e.eq(1).children("img");d=e.eq(0).children("input");expect(f.eq(0)).toHaveAttr("title","bad");expect(f.eq(1)).toHaveAttr("title","poor");expect(f.eq(2)).toHaveAttr("title","regular");expect(f.eq(3)).toHaveAttr("title","good");expect(f.eq(4)).toHaveAttr("title","gorgeous");expect(f).toHaveAttr("src","star-off.png");expect(d).toHaveAttr("type","hidden");expect(d).toHaveAttr("name","score");expect(d.val()).toEqual("")})});describe("functions",function(){describe("GET #score",function(){it("accepts number as string",function(){var b=$("#element");b.raty({score:"1"});expect(b.children("input")).toHaveValue(1)});it("accepts float string",function(){var b=$("#element");b.raty({score:"1.5"});expect(b.children("input")).toHaveValue(1.5)});context("with integer score",function(){it("gets as int",function(){var d=$("#element").raty({score:1});var c=d.raty("score");expect(c).toEqual(1)})});context("with float score",function(){it("gets as float",function(){var d=$("#element").raty({score:1.5});var c=d.raty("score");expect(c).toEqual(1.5)})});context("with score zero",function(){it("gets null to emulate cancel",function(){var d=$("#element").raty({score:0});var c=d.raty("score");expect(c).toEqual(null)})});context("with score greater than :numberMax",function(){it("gets the max",function(){var d=$("#element").raty({number:50,score:50});var c=d.raty("score");expect(c).toEqual(d.data("settings").numberMax)})})});describe("SET #score",function(){it("sets the score",function(){var b=$("#element");b.raty({score:1});expect(b.raty("score")).toEqual(1)});describe("with :click",function(){it("calls the click callback",function(){var b=$("#element").raty({click:function(a){$(this).data("score",a)}});b.raty("score",5);expect(b.children("img")).toHaveAttr("src","star-on.png")})});describe("without :click",function(){it("does not throw exception",function(){var c=$("#element").raty();var d=function(){c.raty("score",1)};expect(d).not.toThrow(new Error('You must add the "click: function(score, evt) { }" callback.'))})});describe("with :readOnly",function(){it("does not set the score",function(){var b=$("#element").raty({readOnly:true});b.raty("score",5);expect(b.children("img")).toHaveAttr("src","star-off.png")})})});describe("#set",function(){it("is chainable",function(){var d=$("#element").raty();var c=d.raty("set",{number:1});expect(c).toBe(d)});it("changes the declared options",function(){var d=$("#element").raty();var c=d.raty("set",{scoreName:"change-just-it"});expect(c.children("input")).toHaveAttr("name","change-just-it")});it("does not change other none declared options",function(){var d=$("#element").raty({number:6});var c=d.raty("set",{scoreName:"change-just-it"});expect(c.children("img").length).toEqual(6)});context("with external bind on wrapper",function(){it("keeps it",function(){var b=$("#element").on("click",function(){$(this).data("externalClick",true)}).raty();b.raty("set",{}).click();expect(b.data("externalClick")).toBeTruthy()})});context("when :readOnly by function",function(){it("is removes the readonly data info",function(){var d=$("#element").raty().raty("readOnly",true);var c=d.raty("set",{readOnly:false});expect(d).not.toHaveData("readonly")})})});describe("#readOnly",function(){context("changes to true",function(){it("sets score as readonly",function(){var b=$("#element").raty();b.raty("readOnly",true);expect(b.children("input")).toHaveAttr("readonly","readonly")});it("removes the pointer cursor",function(){var b=$("#element").raty();b.raty("readOnly",true);expect(b).not.toHaveCss({cursor:"pointer"});expect(b).not.toHaveCss({cursor:"default"})});it('Applies "Not rated yet!" on stars',function(){var b=$("#element").raty();b.raty("readOnly",true);expect(b.children("img")).toHaveAttr("title","Not rated yet!")});it("avoids trigger mouseover",function(){var d=$("#element").raty(),c=d.children("img");d.raty("readOnly",true);c.eq(0).mouseover();expect(c).toHaveAttr("src","star-off.png")});it("avoids trigger click",function(){var d=$("#element").raty(),c=d.children("img");d.raty("readOnly",true);c.eq(0).mouseover().click().mouseleave();expect(c).toHaveAttr("src","star-off.png");expect(d.children("input").val()).toEqual("")});context("with :score",function(){it("applies the score title on stars",function(){var b=$("#element").raty({score:1});b.raty("readOnly",true);expect(b.children("img")).toHaveAttr("title","bad")})});context("with :cancel",function(){it("hides the button",function(){var b=$("#element").raty({cancel:true,path:"../lib/img"});b.raty("readOnly",true);expect(b.children(".raty-cancel")).toBeHidden()})});context("with external bind on wrapper",function(){it("keeps it",function(){var b=$("#element").on("click",function(){$(this).data("externalClick",true)}).raty();b.raty("readOnly",true).click();expect(b.data("externalClick")).toBeTruthy()})});context("with external bind on stars",function(){it("keeps it",function(){var d=$("#element").raty(),c=d.children("img").first();c.on("click",function(){d.data("externalClick",true)});d.raty("readOnly",true);c.click();expect(d.data("externalClick")).toBeTruthy()})})});context("changes to false",function(){it("removes the :readOnly of the score",function(){var b=$("#element").raty();b.raty("readOnly",false);expect(b.children("input")).not.toHaveAttr("readonly","readonly")});it("applies the pointer cursor on wrapper",function(){var b=$("#element").raty();b.raty("readOnly",false);expect(b).toHaveCss({cursor:"pointer"})});it('Removes the "Not rated yet!" off the stars',function(){var d=$("#element").raty({readOnly:true}),c=d.children("img");d.raty("readOnly",false);expect(c.eq(0)).toHaveAttr("title","bad");expect(c.eq(1)).toHaveAttr("title","poor");expect(c.eq(2)).toHaveAttr("title","regular");expect(c.eq(3)).toHaveAttr("title","good");expect(c.eq(4)).toHaveAttr("title","gorgeous")});it("triggers mouseover",function(){var d=$("#element").raty({readOnly:true}),c=d.children("img");d.raty("readOnly",false);c.eq(0).mouseover();expect(c.eq(0)).toHaveAttr("src","star-on.png")});it("triggers click",function(){var d=$("#element").raty({readOnly:true}),c=d.children("img");d.raty("readOnly",false);c.eq(0).mouseover().click().mouseleave();expect(c).toHaveAttr("src","star-on.png");expect(d.children("input")).toHaveValue("1")});context("with :score",function(){it("removes the score title off the stars",function(){var d=$("#element").raty({readOnly:true,score:3});d.raty("readOnly",false);var c=d.children("img");expect(c.eq(0)).toHaveAttr("title","bad");expect(c.eq(1)).toHaveAttr("title","poor");expect(c.eq(2)).toHaveAttr("title","regular");expect(c.eq(3)).toHaveAttr("title","good");expect(c.eq(4)).toHaveAttr("title","gorgeous")})});context("with :cancel",function(){it("shows the button",function(){var b=$("#element").raty({readOnly:true,cancel:true,path:"../lib/img"});b.raty("readOnly",false);expect(b.children(".raty-cancel")).toBeVisible();expect(b.children(".raty-cancel")).not.toHaveCss({display:"block"})});it("rebinds the mouseover",function(){var e=$("#element").raty({readOnly:true,cancel:true}),d=e.children(".raty-cancel"),f=e.children("img:not(.raty-cancel)");e.raty("readOnly",false);d.mouseover();expect(d).toHaveAttr("src","cancel-on.png");expect(f).toHaveAttr("src","star-off.png")});it("rebinds the click",function(){var d=$("#element").raty({readOnly:true,cancel:true,score:5}),c=d.children("img:not(.raty-cancel)");d.raty("readOnly",false);d.children(".raty-cancel").click().mouseout();expect(c).toHaveAttr("src","star-off.png")})})})});describe("#cancel",function(){describe("with :readOnly",function(){it("does not cancel",function(){var b=$("#element").raty({readOnly:true,score:5});b.raty("cancel");expect(b.children("img")).toHaveAttr("src","star-on.png")})});context("without click trigger",function(){it("cancel the rating",function(){var b=$("#element").raty({score:1,click:function(){$(this).data("clicked",true)}});b.raty("cancel");expect(b.children("img")).toHaveAttr("src","star-off.png");expect(b.children("input").val()).toEqual("");expect(b.data("clicked")).toBeFalsy()})});context("with click trigger",function(){it("cancel the rating",function(){var b=$("#element").raty({score:1,click:function(){$(this).data("clicked",true)}});b.raty("cancel",true);expect(b.children("img")).toHaveAttr("src","star-off.png");expect(b.children("input").val()).toEqual("");expect(b.data("clicked")).toBeTruthy()})});context("with :target",function(){beforeEach(function(){buildDivTarget()});context("and :targetKeep",function(){it("sets the :targetText on target",function(){var c=$("#hint").html("dirty"),d=$("#element").raty({cancel:true,target:"#hint",targetKeep:true,targetText:"targetText"});d.raty("cancel");expect(c).toHaveHtml("targetText")})})})});describe("#click",function(){it("clicks on star",function(){var b=$("#element").raty({click:function(){$(this).data("clicked",true)}});b.raty("click",1);expect(b.children("img")).toHaveAttr("src","star-on.png");expect(b.data("clicked")).toBeTruthy()});it("receives the score",function(){var b=$("#element").raty({click:function(a){$(this).data("score",a)}});b.raty("click",1);expect(b.data("score")).toEqual(1)});it("receives the event",function(){var b=$("#element").raty({click:function(d,a){$(this).data("evt",a)}});b.raty("click",1);expect(b.data("evt").type).toEqual("click")});describe("with :readOnly",function(){it("does not set the score",function(){var b=$("#element").raty({readOnly:true});b.raty("click",1);expect(b.children("img")).toHaveAttr("src","star-off.png")})});context("without :click",function(){it("throws error",function(){var c=$("#element").raty();var d=function(){c.raty("click",1)};expect(d).toThrow(new Error('You must add the "click: function(score, evt) { }" callback.'))})});context("with :target",function(){beforeEach(function(){buildDivTarget()});context("and :targetKeep",function(){it("sets the score on target",function(){var b=$("#element").raty({target:"#hint",targetKeep:true,click:function(){}});b.raty("click",1);expect($("#hint")).toHaveHtml("bad")})})})});describe("#reload",function(){it("is chainable",function(){var d=$("#element").raty();var c=d.raty("reload");expect(c).toBe(d)});it("reloads with the same configuration",function(){var d=$("#element").raty({number:6});var c=d.raty("reload");expect(c.children("img").length).toEqual(6)});context("when :readOnly by function",function(){it("is removes the readonly data info",function(){var d=$("#element").raty().raty("readOnly",true);var c=d.raty("reload");expect(d).not.toHaveData("readonly")})})});describe("#destroy",function(){it("is chainable",function(){var d=$("#element").raty();var c=d.raty("destroy");expect(c).toBe(d)});it("clear the content",function(){var b=$("#element").raty();b.raty("destroy");expect(b).toBeEmpty()});it("removes the trigger mouseleave",function(){var b=$("#element").raty({mouseout:function(){console.log(this);$(this).data("mouseleave",true)}});b.raty("destroy");b.mouseleave();expect(b.data("mouseleave")).toBeFalsy()});it("resets the style attributes",function(){var b=$("#element").css({cursor:"help",width:10}).raty();b.raty("destroy");expect(b[0].style.cursor).toEqual("help");expect(b[0].style.width).toEqual("10px")})})})});