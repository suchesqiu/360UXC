<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../../uxc/comps/Panel/UXC.Panel.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/UXC.Calendar.html">UXC.Calendar</a></li>
            
                <li><a href="../classes/UXC.CustomEvent.html">UXC.CustomEvent</a></li>
            
                <li><a href="../classes/UXC.Panel.html">UXC.Panel</a></li>
            
                <li><a href="../classes/UXC.Toggle.html">UXC.Toggle</a></li>
            
                <li><a href="../classes/UXC.Valid.html">UXC.Valid</a></li>
            
                <li><a href="../classes/window.UXC.html">window.UXC</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ../../uxc/comps/Panel/UXC.Panel.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
(function($){
    !window.UXC &amp;&amp; (window.UXC = { log:function(){} });
    window.Panel = UXC.Panel = Panel;
    /**
     * 弹出层基础类 UXC.Panel
     * &lt;br /&gt;&lt;a href=&#x27;https://github.com/suchesqiu/360UXC.git&#x27; target=&#x27;_blank&#x27;&gt;https://github.com/suchesqiu/360UXC.git&lt;/a&gt;
     * &lt;br /&gt;&lt;a href=&#x27;http://uxc.btbtd.org/docs/uxc_docs/&#x27; target=&#x27;_blank&#x27;&gt;http://uxc.btbtd.org/docs/uxc_docs&lt;/a&gt;
     * @namespace UXC
     * @class Panel
     * @constructor
     * @uses jQuery
     * @param   {selector|string}   _selector   自定义弹框模板, 如果 _selector不能解析为 HTML, 将视为@param _headers 
     * @param   {string}            _headers    定义模板的 header 文字, 如果 _selector 不能解析为HTML, 视视为@param _bodys
     * @param   {string}            _bodys      定义模板的 body 文字, 如果 _selector 不能解析为HTML, 视视为@param _footers
     * @param   {string}            _footers    定义模板的 footer 文字
     * @version dev 0.1
     * @author  qiushaowei   &lt;suches@btbtd.org&gt; | 360 UXC-FE Team
     * @date    2013-06-04
     */
    function Panel( _selector, _headers, _bodys, _footers ){
        this._model = new Model( _selector, _headers, _bodys, _footers );
        this._view = new View( this._model );

        this._init();
    }

    $(document).delegate( &#x27;div.UPanel&#x27;, &#x27;click&#x27;, function( _evt ){
        var _panel = $(this), _src = $(_evt.target || _evt.srcElement), _evtName;
        if( _src &amp;&amp; _src.length &amp;&amp; _src.is(&quot;[eventtype]&quot;) ){
            _evtName = _src.attr(&#x27;eventtype&#x27;);
            UXC.log( _evtName, _panel.data(&#x27;PanelInstace&#x27;) );
            _evtName &amp;&amp; _panel.data(&#x27;PanelInstace&#x27;) &amp;&amp; _panel.data(&#x27;PanelInstace&#x27;).trigger( _evtName, _src, _evt );
        }
    });
    
    Panel.prototype = {
        /**
         * 初始化Panel
         * @method  _init
         * @private
         */
        _init:
            function(){
                var _p = this;
                this._view.getPanel().data(&#x27;PanelInstace&#x27;, this);

                /**
                 * 初始化Panel 默认关闭事件
                 * @event   close_default
                 * @type    function
                 * @private
                 */
                this._model.addEvent( &#x27;close_default&#x27;
                                    , function( _evt, _panel ){ _panel._view.close(); } );

                this._model.addEvent( &#x27;show_default&#x27;
                                    , function( _evt, _panel ){ _panel._view.show(); } );

                this._model.addEvent( &#x27;hide_default&#x27;
                                    , function( _evt, _panel ){ _panel._view.hide(); } );

                this._model.addEvent( &#x27;confirm_default&#x27;
                                    , function( _evt, _panel ){ _panel.trigger(&#x27;close&#x27;); } );

                this._model.addEvent( &#x27;cancel_default&#x27;
                                    , function( _evt, _panel ){ _panel.trigger(&#x27;close&#x27;); } );
               
               return this;
            }    

        , on:
            function( _evtName, _cb ){
                _evtName &amp;&amp; _cb &amp;&amp; this._model.addEvent( _evtName, _cb );
            }

        
        , show:
            function( _position ){
                var _p = this;
                setTimeout(
                    function(){
                        if( _position != undefined ){
                            switch( _position ){
                                case 0: _p.center(); break;
                            }
                        }
                    }, 50);
                this.trigger(&#x27;beforeshow&#x27;, this._view.getPanel() );
                this.trigger(&#x27;show&#x27;, this._view.getPanel() );
            }
        , hide:
            function(){
                this.trigger(&#x27;beforehide&#x27;, this._view.getPanel() );
                this.trigger(&#x27;hide&#x27;, this._view.getPanel() );
            }

        , close:
            function(){
                UXC.log(&#x27;Panel.close&#x27;);
                this.trigger(&#x27;beforeclose&#x27;, this._view.getPanel() );
                this.trigger(&#x27;close&#x27;, this._view.getPanel() );
            }

        , center:
            function(){
                this.trigger(&#x27;beforecenter&#x27;, this._view.getPanel() );
                this._view.center();
                this.trigger(&#x27;center&#x27;, this._view.getPanel() );
            }

        , selector: function(){ return this._view.getPanel(); }

        , trigger:
            function( _evtName, _srcElement ){
                UXC.log( &#x27;Panel.trigger&#x27;, _evtName );

                var _p = this, _evts = this._model.getEvent( _evtName ), _processDefEvt = true;
                if( _evts &amp;&amp; _evts.length ){
                    _srcElement &amp;&amp; (_srcElement = $(_srcElement) ) 
                        &amp;&amp; _srcElement.length &amp;&amp; (_srcElement = _srcElement[0]);

                    $.each( _evts, function( _ix, _cb ){
                        if( _cb.call( _srcElement, _evtName, _p ) === false ) 
                            return _processDefEvt = false; 
                    });
                }

                if( _processDefEvt ){
                    var _defEvts = this._model.getEvent( _evtName + &#x27;_default&#x27; );
                    if( _defEvts &amp;&amp; _defEvts.length ){
                        $.each( _defEvts, function( _ix, _cb ){
                            if( _cb.call( _srcElement, _evtName, _p ) === false ) 
                                return false; 
                        });
                    }
                }
            }

        , header:
            function( _html ){
                if( typeof _html != &#x27;undefined&#x27; ) this._view.getHeader( _html );
                var _selector = this._view.getHeader();
                if( _selector &amp;&amp; _selector.length ) return _selector.html();
            }

        , body:
            function( _html ){
                if( typeof _html != &#x27;undefined&#x27; ) this._view.getBody( _html );
                var _selector = this._view.getBody();
                if( _selector &amp;&amp; _selector.length ) return _selector.html();
            }

        , footer:
            function( _html ){
                if( typeof _html != &#x27;undefined&#x27; ) this._view.getFooter( _html );
                var _selector = this._view.getFooter();
                if( _selector &amp;&amp; _selector.length ) return _selector.html();
            }

        , panel:
            function( _html ){
                if( typeof _html != &#x27;undefined&#x27; ) this._view.getPanel( _html );
                var _selector = this._view.getPanel();
                if( _selector &amp;&amp; _selector.length ) return _selector.html();
            }
    }
    
    function Model( _selector, _headers, _bodys, _footers ){

        this.selector = _selector;
        this.headers = _headers;
        this.bodys = _bodys;
        this.footers = _footers;
        this.panel;

        this._events = {};

        this._init();
    }
    
    Model.prototype = {
        _init:
            function(){
                var _selector = typeof this.selector != &#x27;undefined&#x27; ? $(this.selector) : undefined;
                if( _selector &amp;&amp; _selector.length ){
                    this.selector = _selector;
                    UXC.log( &#x27;user tpl&#x27;, this.selector.parent().length );
                    if( !this.selector.parent().length ){
                        this.selector.appendTo( $(document.body ) );
                    }
                }else if( !_selector || _selector.length === 0 ){
                    this.footers = this.bodys;
                    this.bodys = this.headers;
                    this.headers = this.selector;
                    this.selector = undefined;
                }
                return this;
            }

        , addEvent:
            function( _evtName, _cb ){
                if( !(_evtName &amp;&amp; _cb ) ) return;
                _evtName &amp;&amp; ( _evtName = _evtName.toLowerCase() );
                if( !(_evtName in this._events ) ){
                    this._events[ _evtName ] = []
                }
                if( /\_default/i.test( _evtName ) ) this._events[ _evtName ].unshift( _cb );
                else this._events[ _evtName ].push( _cb );
            }

        , getEvent:
            function( _evtName ){
                return this._events[ _evtName ];
            }

    };
    
    function View( _model ){
        this._model = _model;
        this._tpl = _deftpl;

        this._init();
    }
    
    View.prototype = {
        _init:
            function(){
                if( !this._model.panel ){
                    if( this._model.selector ){
                        this._model.panel = this._model.selector;
                    }else{
                        this._model.panel = $(this._tpl);
                        this._model.panel.hide().appendTo(document.body);
                    }
                }

                this.getHeader();
                this.getBody();
                this.getFooter();

                return this;
            }

        , show:
            function(){
                this.getPanel().show();
            }

        , hide:
            function(){
                this.getPanel().hide();
            }

        , close:
            function(){
                UXC.log( &#x27;Panel._view.close()&#x27;);
                this.getPanel().remove();
            }

        , getPanel:
            function( _udata ){
                if( typeof _udata != &#x27;undefined&#x27; ){
                    this.getPanel().html( _udata );
                }
                return this._model.panel;
            }

        , getHeader:
            function( _udata ){
                var _selector = this.getPanel().find(&#x27;div.UPContent &gt; div.hd&#x27;);
                if( typeof _udata != &#x27;undefined&#x27; ) this._model.headers = _udata;
                if( typeof this._model.headers != &#x27;undefined&#x27; ){
                    if( !_selector.length ){
                        this.getPanel().find(&#x27;div.UPContent &gt; div.bd&#x27;)
                            .before( _selector = $(&#x27;&lt;div class=&quot;hd&quot;&gt;弹出框&lt;/div&gt;&#x27;) );
                    }
                    _selector.html( this._model.headers );
                    this._model.headers = undefined;
                }
                return _selector;
            }

        , getBody:
            function( _udata ){
                var _selector = this.getPanel().find(&#x27;div.UPContent &gt; div.bd&#x27;);
                if( typeof _udata != &#x27;undefined&#x27; ) this._model.bodys = _udata;
                if( typeof this._model.bodys!= &#x27;undefined&#x27; ){
                    _selector.html( this._model.bodys);
                    this._model.bodys = undefined;
                }
                return _selector;
            }


        , getFooter:
            function( _udata ){
                var _selector = this.getPanel().find(&#x27;div.UPContent &gt; div.ft&#x27;);
                if( typeof _udata != &#x27;undefined&#x27; ) this._model.footers = _udata;
                if( typeof this._model.footers != &#x27;undefined&#x27; ){
                    if( !_selector.length ){
                        this.getPanel().find(&#x27;div.UPContent &gt; div.bd&#x27;)
                            .after( _selector = $(&#x27;&lt;div class=&quot;ft&quot; &gt;&lt;/div&gt;&#x27;));
                    }
                    _selector.html( this._model.footers );
                    this._model.footers = undefined;
                }
                return _selector;
            }

        , center:
            function( ){
                var _layout = this.getPanel(), _lw = _layout.width(), _lh = _layout.height()
                    , _x, _y, _winw = $(window).width(), _winh = $(window).height()
                    , _scrleft = $(document).scrollLeft(), _scrtop = $(document).scrollTop()
                    ;

                _layout.css( {&#x27;left&#x27;: &#x27;-9999px&#x27;, &#x27;top&#x27;: &#x27;-9999px&#x27;} ).show();
                _x = (_winw - _lw) / 2 + _scrleft; 
                _y = (_winh - _lh) / 2 + _scrtop;
                if( (_winh - _lh  - 100) &gt; 300 ){
                    _y -= 100;
                }
                UXC.log( (_winh - _lh / 2 - 100) )

                if( ( _y + _lh - _scrtop ) &gt; _winh ){
                    UXC.log(&#x27;y overflow&#x27;);
                    _y = _scrtop + _winh - _lh;

                }

                if( _y &lt; _scrtop || _y &lt; 0 ) _y = _scrtop;

                _layout.css( {left: _x+&#x27;px&#x27;, top: _y+&#x27;px&#x27;} );

                UXC.log( _lw, _lh, _winw, _winh );
            }
    };
    /**
     * Panel 关闭前会触发的事件&lt;br/&gt;
     * 这个事件只有用户调用 _panelInstance.close() 时才会触发
     * @event   beforeclose
     * @type    function
     * @example     
     *      panelInstace.on( &#x27;beforeclose&#x27;, function( _evt, _panelInstance ){ do something });
     */
    /**
     * 关闭事件
     * @event   close
     * @type    function
     * @example     
     *      panelInstace.on( &#x27;close&#x27;, function( _evt, _panelInstance ){ do something });
     */
    /**
     * Panel 显示前会触发的事件&lt;br/&gt;
     * 这个事件只有用户调用 _panelInstance.show() 时才会触发
     * @event   beforeshow
     * @type    function
     * @example     
     *      panelInstace.on( &#x27;beforeshow&#x27;, function( _evt, _panelInstance ){ do something });
     */
    /**
     * 显示Panel时会触发的事件
     * @event   show
     * @type    function
     * @example     
     *      panelInstace.on( &#x27;show&#x27;, function( _evt, _panelInstance ){ do something });
     */

    var _deftpl =
        [
        &#x27;&lt;div class=&quot;UPanel&quot; style=&quot;width: 600px;&quot;&gt;\n&#x27;
        ,&#x27;    &lt;div class=&quot;UPContent&quot;&gt;\n&#x27;
        ,&#x27;        &lt;div class=&quot;bd&quot;&gt;&lt;/div&gt;\n&#x27;
        ,&#x27;        &lt;span class=&quot;close&quot; eventtype=&quot;close&quot;&gt;&lt;/span&gt;\n&#x27;
        ,&#x27;    &lt;/div&gt;&lt;!--end UPContent--&gt;\n&#x27;
        ,&#x27;&lt;/div&gt;&lt;!--end UPanel--&gt;\n&#x27;
        ].join(&#x27;&#x27;)

}(jQuery));

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
