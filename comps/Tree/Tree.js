(function(a){!window.UXC&&(window.UXC={log:function(){}});window.Tree=UXC.Tree=b;function b(e,f){if(e&&a(e).length){e=a(e);if(b.getInstance(e)){return b.getInstance(e)}e.data("TreeIns",this)}this._model=new d(e,f);this._view=new c(this._model)}b.getInstance=function(e){e=a(e);return e.data("TreeIns")};b.dataFilter;b.prototype={init:function(){this._view.init();this._view.treeRoot().data("TreeIns",this);return this},open:function(e){if(typeof e=="undefined"){this._view.openAll();return this}this._view.open(e);return this},close:function(e){if(typeof e=="undefined"){this._view.closeAll();return this}this._view.close(e);return this},idPrefix:function(){return this._model.idPrefix()},getItem:function(e){var f;e&&(f=a("#"+this._model.id(e)));return f},on:function(f,e){if(!(f&&e)){return this}this._model.addEvent(f,e);return this},event:function(e){if(!e){return}return this._model.event(e)},highlight:function(e){return this._model.highlight(e)}};function d(e,f){this._container=e;this._data=f;this._id="tree_"+new Date().getTime()+"_";this._highlight;this._events={};this._init()}d.prototype={_init:function(){b.dataFilter&&(this._data=b.dataFilter(this._data));return this},container:function(){return this._container},id:function(e){return this._id+e},idPrefix:function(){return this._id},data:function(){return this._data},root:function(){return this._data.root},child:function(e){return this._data.data[e]},hasChild:function(e){return e in this._data.data},event:function(e){e=e.toLowerCase();return this._events[e]},addEvent:function(f,e){f=f.toLowerCase();if(!(f in this._events)){this._events[f]=[]}this._events[f].unshift(e)},highlight:function(e){e&&(this._highlight=e);return this._highlight}};function c(e){this._model=e;this._treeRoot}c.prototype={init:function(){if(!(this._model.data()&&this._model.root())){return}this._process(this._model.child(this._model.root()[0]),this._initRoot());return this},treeRoot:function(e){e&&(this._treeRoot=e);return this._treeRoot},_process:function(k,l){for(var h=0,f=k.length,g,e;h<f;h++){g=k[h];e=h===f-1;if(this._model.hasChild(g[0])){this._initFolder(l,g,e)}else{this._initFile(l,g,e)}}},_initRoot:function(){var e=this;if(!e._model.data().root){return}var g=e._model.data().root;var j=a('<ul class="tree_wrap"></ul>');var i=this._initLabel(g);var f=a('<li class="folder_open"></li>');f.html('<span class="folder_img_root folderRoot folder_img_open">&nbsp;</span>');i.appendTo(f);f.appendTo(j);j.appendTo(e._model.container());this.treeRoot(j);var h=a('<ul style="" class="tree_wrap_inner"></ul>');h.appendTo(f);return h},_initFolder:function(l,h,e){var g="",i="";e&&(g="folder_span_lst ",i="folder_last");var k=this._initLabel(h);var f=a(printf('<li><span class="folder_img_closed folder {1}">&nbsp;</span></li>',h[1],g));f.addClass(printf("folder_closed {0} folder",i));k.appendTo(f);var j=a('<ul style="display:none;" class="folder_ul_lst" ></ul>');j.appendTo(f);f.appendTo(l);this._process(this._model.child(h[0]),j)},_initFile:function(k,h,e){var g="folder_img_bottom ",i="";e&&(g="folder_img_last ",i="");var j=this._initLabel(h);var f=a(printf('<li><span class="{1}file">&nbsp;</span></li>',h[1],g));f.addClass("folder_closed file");j.appendTo(f);f.appendTo(k)},_initLabel:function(e){var f=a('<div class="node_ctn"></div>');f.attr("id",this._model.id(e[0])).attr("dataid",e[0]).attr("dataname",e[1]).data("nodeData",e);if(this._model.event("RenderLabel")){a.each(this._model.event("RenderLabel"),function(h,g){if(g.call(f,e,f)===false){return false}})}else{f.html(e[1]||"没有标签")}return f},openAll:function(){if(!this.treeRoot()){return}this.treeRoot().find("span.folder_img_closed").each(function(){a(this).trigger("click")})},closeAll:function(){if(!this.treeRoot()){return}this.treeRoot().find("span.folder_img_open, span.folder_img_root").each(function(){if(a(this).hasClass("folder_img_closed")){return}a(this).trigger("click")})},open:function(f){if(!f){return}var e=a("#"+this._model.id(f));if(!e.length){return}var g=e.parents("li");if(this._model.highlight()){this._model.highlight().removeClass("highlight")}e.addClass("highlight");this._model.highlight(e);g.each(function(){var h=a(this),i=h.find("> span.folderRoot, > span.folder");if(i.length){if(i.hasClass("folder_img_open")){return}i.trigger("click")}})},close:function(f){if(!f){return}var e=a("#"+this._model.id(f));if(!e.length){return}var g=e.parent("li").find("> span.folderRoot, > span.folder");if(g.length){if(g.hasClass("folder_img_closed")){return}g.trigger("click")}}};b.lastHover=null;a(document).delegate("ul.tree_wrap div.node_ctn","mouseenter",function(){if(b.lastHover){b.lastHover.removeClass("ms_over")}a(this).addClass("ms_over");b.lastHover=a(this)});a(document).delegate("ul.tree_wrap div.node_ctn","mouseleave",function(){if(b.lastHover){b.lastHover.removeClass("ms_over")}});a(document).delegate("ul.tree_wrap div.node_ctn","click",function(f){var e=a(this),h=e.parents("ul.tree_wrap"),i=h.data("TreeIns");if(!i){return}var g=i.event("click");if(g&&g.length){a.each(g,function(k,j){if(j.call(e,f)===false){return false}})}if(i.highlight()){i.highlight().removeClass("highlight")}e.addClass("highlight");i.highlight(e)});a(document).delegate("ul.tree_wrap span.folder, ul.tree_wrap span.folderRoot","click",function(f){var e=a(this),g=e.parent("li"),k=g.find("> ul");var i=e.parents("ul.tree_wrap"),j=i.data("TreeIns");var h=j.event("FolderClick");if(h&&h.length){a.each(h,function(m,l){if(l.call(e,f)===false){return false}})}if(e.hasClass("folder_img_open")){e.removeClass("folder_img_open").addClass("folder_img_closed");k.hide()}else{if(e.hasClass("folder_img_closed")){e.addClass("folder_img_open").removeClass("folder_img_closed");k.show()}}if(g.hasClass("folder_closed")){g.addClass("folder_open").removeClass("folder_closed")}else{if(g.hasClass("folder_open")){g.removeClass("folder_open").addClass("folder_closed")}}})}(jQuery));