(function(f){!window.UXC&&(window.UXC={log:function(){}});var d=UXC.Valid=window.Valid={check:function(a){var j=true,a=f(a),m=a.length?a.prop("nodeName").toLowerCase():"";if(a.length){if(m=="form"){var n=d.errorAbort,c;a.is("[errorabort]")&&(n=(_tmp=a.attr("errorabort").toLowerCase())=="false"||_tmp=="0"||(!_tmp)?false:true);for(var i=0,b=a[0].length;i<b;i++){if(f(a[0][i]).is("[ignoreprocess]")){continue}!e.parse(f(a[0][i]))&&(j=false);if(n&&!j){break}}}else{j=e.parse(a)}}return j},clearError:function(a){f(a).each(function(){var j=f(this);UXC.log("clearError: "+j.prop("nodeName"));switch(j.prop("nodeName").toLowerCase()){case"form":for(var b=0,i=j[0].length;b<i;b++){var c=f(j[0][b]);if(c.is("[disabled]")){return}e.valid(c,1)}break;default:e.valid(f(this),1);break}})},errorAbort:false,autoTrim:true,formHasValue:function(a,b){var j=false,c,m;a&&(a=f(a));if(a&&a.length){for(var i=0,n=a[0].length;i<n;i++){c=f(a[0][i]);if(c.is("[disabled]")){return}m=c.prop("nodeName").toLowerCase();if(b){if(c.is(b)){continue}}switch(c.prop("type").toLowerCase()){case"select-multiple":case"select-one":case"select":case"file":case"textarea":case"password":case"text":if(f.trim(c.val()).length){return true}break;case"checkbox":case"radio":if(c.prop("checked")){return true}break}}}return j},setValid:function(b,a){e.valid.apply(this,[].slice.apply(arguments))},setError:function(b,c,a){e.error.apply(this,[].slice.apply(arguments))}};d.checkAll=d.check;f(document).delegate("input[type=text], input[type=password], textarea","blur",function(a){UXC.Valid.check(this)});f(document).delegate("select, input[type=file]","change",function(a){UXC.Valid.check(this)});var e={parse:function(b){var a=true,b=f(b);b.each(function(){if(!e.isValidItem(this)){return}var c=f(this),l=e.getDatatype(c),k=e.getSubdatatype(c),j=c.prop("nodeName").toLowerCase();if(!c.is(":visible")){return}if(c.is("[disabled]")){return}UXC.log(l,k);switch(j){case"input":case"textarea":c.val(f.trim(c.val()||""));break}if(c.is("[reqmsg]")){if(!e.datatype.reqmsg(c)){a=false;return}}if(!e.datatype.length(c)){a=false;return}if(l in e.datatype&&c.val()){if(!e.datatype[l](c)){a=false;return}}if(k&&k in e.subdatatype&&(c.val()||k=="alternative")){if(!e.subdatatype[k](c)){a=false;return}}e.valid(c)});return a},isValidItem:function(a){a=f(a);var b,c;a.each(function(){c=f(this);if(c.is("[datatype]")||c.is("[subdatatype]")||c.is("[minlength]")||c.is("[maxlength]")||c.is("[reqmsg]")){b=true}});return b},valid:function(b,a){if(!e.isValidItem(b)){return false}setTimeout(function(){b.removeClass("error");b.find("~ em").show();b.find("~ em.error").hide();b.attr("emel")&&e.getElement(b.attr("emel"),b).hide()},a||150)},error:function(c,h,a){if(!e.isValidItem(c)){return false}var b=arguments;setTimeout(function(){var g=e.getMsg.apply(null,[].slice.call(b)),j;c.addClass("error");c.find("~ em:not(.error)").hide();if(c.is("[emEl]")){(j=e.getElement(c.attr("emEl"),c))&&j.length&&j.addClass("error")}!(j&&j.length)&&(j=c.find("~ em.error"));if(!j.length){(j=f('<em class="error"></em>')).insertAfter(c)}UXC.log("error: "+g);j.html(g).show()},150);return false},getElement:function(b,a){if(/^\^$/.test(b)){b=f(a.parent().find("~ em.error"))}else{if(/^[\w-]+$/.test(b)){b="#"+b}}return f(b)},getDatatype:function(a){return(a.attr("datatype")||"text").toLowerCase().replace(/\-.*/,"")},getSubdatatype:function(a){return(a.attr("subdatatype")||"text").toLowerCase().replace(/\-.*/,"")},getMsg:function(h,a,b){var c=h.is("[errmsg]")?" "+h.attr("errmsg"):h.is("[reqmsg]")?h.attr("reqmsg"):"";a&&(c=h.attr(a)||c);b&&c&&(c=" "+c);if(c&&!/^[\s]/.test(c)){switch(h.prop("type").toLowerCase()){case"file":c="请上传"+c;break;case"select-multiple":case"select-one":case"select":c="请选择"+c;break;case"textarea":case"password":case"text":c="请填写"+c;break}}UXC.log("_msg: "+c,h.prop("type").toLowerCase());return f.trim(c)},bytelen:function(a){return a.replace(/[^\x00-\xff]/g,"11").length},getTimestamp:function(a){a=a.replace(/[^\d]/g,"");return new Date(a.slice(0,4),parseInt(a.slice(4,6),10)-1,a.slice(6,8)).getTime()},subdatatype:{alternative:function(h){var c=true,a;UXC.log("alternative");if(h.is("[datatarget]")&&(a=f(h.attr("datatarget"))).length&&!h.val()){var b=false;a.each(function(){if(f(this).val()){b=true;return false}});c=b}!c&&e.error(h,"alternativemsg",true);!c&&a&&a.length&&a.each(function(){e.error(f(this),"alternativemsg",true)});c&&a&&a.length&&a.each(function(){e.valid(f(this))});return c},reconfirm:function(c){var b=true,a;UXC.log("reconfirm");if(c.is("[datatarget]")&&(a=f(c.attr("datatarget"))).length){a.each(function(){if(c.val()!=f(this).val()){return b=false}})}!b&&e.error(c,"reconfirmmsg",true);!b&&a.length&&a.each(function(){e.error(f(this),"reconfirmmsg",true)});b&&a.length&&a.each(function(){e.valid(f(this))});return b}},datatype:{n:function(m){var a=true,c=m.val(),q=+c,o=0,b=Math.pow(10,10),r,p,n;if(!isNaN(q)&&q>=0){m.attr("datatype").replace(/^n[^\-]*\-(.*)$/,function(g,h){n=h.split(".");r=n[0];p=n[1]});if(m.is("[minvalue]")){o=+m.attr("minvalue")||o}if(m.is("[maxvalue]")){b=+m.attr("maxvalue")||b}if(q>=o&&q<=b){typeof r!="undefined"&&typeof p!="undefined"&&(a=new RegExp("^(?:[\\d]{0,"+r+"}|)(?:\\.[\\d]{1,"+p+"}|)$").test(c));typeof r!="undefined"&&typeof p=="undefined"&&(a=new RegExp("^[\\d]{1,"+r+"}$").test(c));typeof r=="undefined"&&typeof p!="undefined"&&(a=new RegExp("^\\.[\\d]{1,"+p+"}$").test(c));typeof p=="undefined"&&/\./.test(c)&&(a=false)}else{a=false}UXC.log("nValid",q,typeof r,typeof p,typeof o,typeof b,o,b)}else{a=false}!a&&e.error(m);return a},nrange:function(c){var m=e.datatype.n(c),a,l;UXC.log("zzzz",m);if(m){var o,b;if(c.is("[fromNEl]")){o=e.getElement(c.attr("fromNEl"))}if(c.is("[toNEl]")){b=e.getElement(c.attr("toNEl"))}if(!(o&&o.length||b&&b.length)){var n=c.parent(),p=[];n.find("input[datatype]").each(function(){var g=f(this);/nrange/i.test(g.attr("datatype"))&&p.push(this)});UXC.log("ccc",p.length);if(p.length===2){o=f(p[0]);b=f(p[1])}}UXC.log("aaaa",m);if(o&&o.length||b&&b.length){o&&o.length&&!(b&&b.length)&&(b=c);!(o&&o.length)&&b&&b.length&&(o=c);UXC.log("nrange",o.length,b.length);b.val(f.trim(b.val()));o.val(f.trim(o.val()));if(b[0]!=o[0]&&b.val().length&&o.val().length){m&&(m=e.datatype.n(b));m&&(m=e.datatype.n(o));m&&(+o.val())>(+b.val())&&(m=false);UXC.log(+o.val(),+b.val(),m);m&&e.valid(o);m&&e.valid(b);if(m){o.removeClass("error");b.removeClass("error")}else{o.addClass("error");b.addClass("error")}}}}!m&&e.error(c);return m},d:function(k){var l=f.trim(k.val()),a,m=/^[\d]{4}([\/.-]|)[01][\d]\1[0-3][\d]$/;if(!l){return true}if(a=m.test(l)){var n=e.getTimestamp(k.val()),c,b;if(k.is("[minvalue]")&&(a=m.test(k.attr("minvalue")))){c=e.getTimestamp(k.attr("minvalue"));n<c&&(a=false)}if(a&&k.is("[maxvalue]")&&(a=m.test(k.attr("maxvalue")))){b=e.getTimestamp(k.attr("maxvalue"));n>b&&(a=false)}}!a&&e.error(k);return a},daterange:function(c){var m=e.datatype.d(c),a,l;if(m){var o,p;if(c.is("[fromDateEl]")){o=e.getElement(c.attr("fromDateEl"))}if(c.is("[toDateEl]")){p=e.getElement(c.attr("toDateEl"))}if(!(o&&o.length||p&&p.length)){var b=c.parent(),n=b.find("input[datatype=daterange]");if(n.length===2){o=f(n[0]);p=f(n[1])}}if(o&&o.length||p&&p.length){o&&o.length&&!(p&&p.length)&&(p=c);!(o&&o.length)&&p&&p.length&&(o=c);UXC.log("daterange",o.length,p.length);p.val(f.trim(p.val()));o.val(f.trim(o.val()));if(p[0]!=o[0]&&p.val().length&&o.val().length){m&&(m=e.datatype.d(p));m&&(m=e.datatype.d(o));m&&e.getTimestamp(o.val())>e.getTimestamp(p.val())&&(m=false);m&&e.valid(o);m&&e.valid(p);if(m){o.removeClass("error");p.removeClass("error")}else{o.addClass("error");p.addClass("error")}}}}!m&&e.error(c);return m},time:function(b){var a=/^(([0-1]\d)|(2[0-3])):[0-5]\d:[0-5]\d$/.test(b.val());!a&&e.error(b);return a},minute:function(b){var a=/^(([0-1]\d)|(2[0-3])):[0-5]\d$/.test(b.val());!a&&e.error(b);return a},bankcard:function(b){var a=/^[1-9][\d]{3}(?: |)(?:[\d]{4}(?: |))(?:[\d]{4}(?: |))(?:[\d]{4})(?:(?: |)[\d]{3}|)$/.test(b.val());!a&&e.error(b);return a},cnname:function(b){var a=e.bytelen(b.val())<32&&/^[\u4e00-\u9fa5a-zA-Z.\u3002\u2022]{2,32}$/.test(b.val());!a&&e.error(b);return a},username:function(b){var a=/^[a-zA-Z0-9][\w-]{2,29}$/.test(b.val());!a&&e.error(b);return a},idnumber:function(b){var a=/^[0-9]{15}(?:[0-9]{2}(?:[0-9xX]|)|)$/.test(b.val());!a&&e.error(b);return a},mobilecode:function(c,a){var b=/^(?:13|14|15|16|18|19)\d{9}$/.test(c.val());!a&&!b&&e.error(c);return b},mobile:function(a,b){return e.datatype.mobilecode(a,b)},mobilezonecode:function(c,a){var b=/^(?:\+[0-9]{1,6} |)(?:0|)(?:13|14|15|16|18|19)\d{9}$/.test(c.val());!a&&!b&&e.error(c);return b},mobilephone:function(b){var a=e.datatype.mobilecode(b,true)||e.datatype.phone(b,true);!a&&e.error(b);return a},mobilephoneall:function(b){var a=e.datatype.mobilezonecode(b,true)||e.datatype.phoneall(b,true);!a&&e.error(b);return a},phone:function(c,a){var b=/^(?:0(?:10|2\d|[3-9]\d\d)(?: |\-|)|)[1-9]\d{6,7}$/.test(c.val());!a&&!b&&e.error(c);return b},phoneall:function(c,a){var b=/^(?:\+[\d]{1,6}(?: |\-)|)(?:0[\d]{2,3}(?:\-| |)|)[1-9][\d]{6,7}(?:(?: |)\#[\d]{1,6}|)$/.test(c.val());!a&&!b&&e.error(c);return b},phonezone:function(b){var a=/^[0-9]{3,4}$/.test(b.val());!a&&e.error(b);return a},phonecode:function(b){var a=/^[0-9]{7,8}$/.test(b.val());!a&&e.error(b);return a},phoneext:function(b){var a=/^[0-9]{1,6}$/.test(b.val());!a&&e.error(b);return a},length:function(c){var m=true,a=e.getDatatype(c),b,k,l=f.trim(c.val()),n;if(!l){return m}if(c.is("[minlength]")){UXC.log("minlength");b=parseInt(c.attr("minlength"),10)||0}if(c.is("[maxlength]")){UXC.log("maxlength");k=parseInt(c.attr("maxlength"),10)||0}switch(a){case"richtext":case"bytetext":n=e.bytelen(l);break;default:n=l.length;break}b&&(n<b)&&(m=false);k&&(n>k)&&(m=false);UXC.log("lengthValid: ",b,k,m);!m&&e.error(c);return m},reqmsg:function(b){var a;if(b.val()&&b.val().constructor==Array){a=!!(f.trim(b.val().join("")+""))}else{a=!!f.trim(b.val()||"")}!a&&e.error(b,"reqmsg");UXC.log("regmsgValid: "+a);return a},reg:function(c){var b=true,a;if(c.is("[reg-pattern]")){a=c.attr("reg-pattern")}if(!a){a=f.trim(c.attr("datatype")).replace(/^reg(?:\-|)/i,"")}a.replace(/^\/([\s\S]*)\/([\w]{0,3})$/,function(k,l,j){UXC.log(l,j);b=new RegExp(l,j||"").test(c.val())});!b&&e.error(c);return b},vcode:function(c){var b,a=parseInt(f.trim(c.attr("datatype")).replace(/^vcode(?:\-|)/i,""),10)||4;UXC.log("vcodeValid: "+a);b=new RegExp("^[0-9a-zA-Z]{"+a+"}$").test(c.val());!b&&e.error(c);return b},text:function(a){return true},bytetext:function(a){return true},richtext:function(a){return true},url:function(b){var a=/^((http|ftp|https):\/\/|)[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])$/.test(b.val());!a&&e.error(b);return a},domain:function(b){var a=/^(?:(?:f|ht)tp\:\/\/|)((?:(?:(?:\w[\.\-\+]*))\w)*)((?:(?:(?:\w[\.\-\+]*){0,62})\w)+)\.(\w{2,6})(?:\/|)$/.test(b.val());!a&&e.error(b);return a},email:function(b){var a=/^[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(b.val());!a&&e.error(b);return a},zipcode:function(b){var a=/^[0-9]{6}$/.test(b.val());!a&&e.error(b);return a}}}}(jQuery));