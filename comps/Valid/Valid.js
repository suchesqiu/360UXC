(function(d){!window.UXC&&(window.UXC={log:function(){}});var e=UXC.Valid=window.Valid={check:function(c){var a=true,c=d(c),m=c.length?c.prop("nodeName").toLowerCase():"";if(c.length){if(m=="form"){var b=e.errorAbort,i;c.is("[errorabort]")&&(b=(_tmp=c.attr("errorabort").toLowerCase())=="false"||_tmp=="0"||(!_tmp)?false:true);for(var j=0,n=c[0].length;j<n;j++){if(d(c[0][j]).is("[ignoreprocess]")){continue}!f.parse(d(c[0][j]))&&(a=false);if(b&&!a){break}}}else{a=f.parse(c)}}return a},clearError:function(a){d(a).each(function(){var b=d(this);UXC.log("clearError: "+b.prop("nodeName"));switch(b.prop("nodeName").toLowerCase()){case"form":for(var c=0,j=b[0].length;c<j;c++){var i=d(b[0][c]);if(i.is("[disabled]")){return}f.valid(i,1)}break;default:f.valid(d(this),1);break}})},errorAbort:false,autoTrim:true,formHasValue:function(n,c){var a=false,i,b;n&&(n=d(n));if(n&&n.length){for(var j=0,m=n[0].length;j<m;j++){i=d(n[0][j]);if(i.is("[disabled]")){return}b=i.prop("nodeName").toLowerCase();if(c){if(i.is(c)){continue}}switch(i.prop("type").toLowerCase()){case"select-multiple":case"select-one":case"select":case"file":case"textarea":case"password":case"text":if(d.trim(i.val()).length){return true}break;case"checkbox":case"radio":if(i.prop("checked")){return true}break}}}return a},setValid:function(b,a){f.valid.apply(this,[].slice.apply(arguments))},setError:function(a,b,c){f.error.apply(this,[].slice.apply(arguments))}};e.checkAll=e.check;d(document).delegate("input[type=text], input[type=password], textarea","blur",function(a){UXC.Valid.check(this)});d(document).delegate("select, input[type=file]","change",function(a){UXC.Valid.check(this)});var f={parse:function(b){var a=true,b=d(b);b.each(function(){if(!f.isValidItem(this)){return}var c=d(this),l=f.getDatatype(c),k=f.getSubdatatype(c),j=c.prop("nodeName").toLowerCase();if(!c.is(":visible")){return}if(c.is("[disabled]")){return}UXC.log(l,k);switch(j){case"input":case"textarea":c.val(d.trim(c.val()||""));break}if(c.is("[reqmsg]")){if(!f.datatype.reqmsg(c)){a=false;return}}if(!f.datatype.length(c)){a=false;return}if(l in f.datatype&&c.val()){if(!f.datatype[l](c)){a=false;return}}if(k&&k in f.subdatatype&&(c.val()||k=="alternative")){if(!f.subdatatype[k](c)){a=false;return}}f.valid(c)});return a},isValidItem:function(c){c=d(c);var a,b;c.each(function(){b=d(this);if(b.is("[datatype]")||b.is("[subdatatype]")||b.is("[minlength]")||b.is("[maxlength]")||b.is("[reqmsg]")){a=true}});return a},valid:function(b,a){if(!f.isValidItem(b)){return false}setTimeout(function(){b.removeClass("error");b.find("~ em").show();b.find("~ em.error").hide();b.attr("emel")&&f.getElement(b.attr("emel"),b).hide()},a||150)},error:function(a,b,c){if(!f.isValidItem(a)){return false}var h=arguments;setTimeout(function(){var g=f.getMsg.apply(null,[].slice.call(h)),j;a.addClass("error");a.find("~ em:not(.error)").hide();if(a.is("[emEl]")){(j=f.getElement(a.attr("emEl"),a))&&j.length&&j.addClass("error")}!(j&&j.length)&&(j=a.find("~ em.error"));if(!j.length){(j=d('<em class="error"></em>')).insertAfter(a)}UXC.log("error: "+g);j.html(g).show()},150);return false},getElement:function(b,a){if(/^\^$/.test(b)){b=d(a.parent().find("~ em.error"))}else{if(/^[\w-]+$/.test(b)){b="#"+b}}return d(b)},getDatatype:function(a){return(a.attr("datatype")||"text").toLowerCase().replace(/\-.*/,"")},getSubdatatype:function(a){return(a.attr("subdatatype")||"text").toLowerCase().replace(/\-.*/,"")},getMsg:function(b,c,h){var a=b.is("[errmsg]")?" "+b.attr("errmsg"):b.is("[reqmsg]")?b.attr("reqmsg"):"";c&&(a=b.attr(c)||a);h&&a&&(a=" "+a);if(a&&!/^[\s]/.test(a)){switch(b.prop("type").toLowerCase()){case"file":a="请上传"+a;break;case"select-multiple":case"select-one":case"select":a="请选择"+a;break;case"textarea":case"password":case"text":a="请填写"+a;break}}UXC.log("_msg: "+a,b.prop("type").toLowerCase());return d.trim(a)},bytelen:function(a){return a.replace(/[^\x00-\xff]/g,"11").length},getTimestamp:function(a){a=a.replace(/[^\d]/g,"");return new Date(a.slice(0,4),parseInt(a.slice(4,6),10)-1,a.slice(6,8)).getTime()},subdatatype:{alternative:function(b){var a=true,c;UXC.log("alternative");if(b.is("[datatarget]")&&(c=d(b.attr("datatarget"))).length&&!b.val()){var h=false;c.each(function(){if(d(this).val()){h=true;return false}});a=h}!a&&f.error(b,"alternativemsg",true);!a&&c&&c.length&&c.each(function(){f.error(d(this),"alternativemsg",true)});a&&c&&c.length&&c.each(function(){f.valid(d(this))});return a},reconfirm:function(b){var a=true,c;UXC.log("reconfirm");if(b.is("[datatarget]")&&(c=d(b.attr("datatarget"))).length){c.each(function(){if(b.val()!=d(this).val()){return a=false}})}!a&&f.error(b,"reconfirmmsg",true);!a&&c.length&&c.each(function(){f.error(d(this),"reconfirmmsg",true)});a&&c.length&&c.each(function(){f.valid(d(this))});return a}},datatype:{n:function(m){var a=true,c=m.val(),q=+c,o=0,b=Math.pow(10,10),r,p,n;if(m.is("[minvalue]")){if(/\./.test(m.attr("minvalue"))){n=parseFloat(m.attr("minvalue"))}else{n=parseInt(m.attr("minvalue"))}if(!isNaN(n)){o+=n}}if(!isNaN(q)&&q>=o){m.attr("datatype").replace(/^n[^\-]*\-(.*)$/,function(h,g){n=g.split(".");r=n[0];p=n[1]});if(m.is("[maxvalue]")){b=+m.attr("maxvalue")||b}if(q>=o&&q<=b){typeof r!="undefined"&&typeof p!="undefined"&&(a=new RegExp("^(?:-|)(?:[\\d]{0,"+r+"}|)(?:\\.[\\d]{1,"+p+"}|)$").test(c));typeof r!="undefined"&&typeof p=="undefined"&&(a=new RegExp("^(?:-|)[\\d]{1,"+r+"}$").test(c));typeof r=="undefined"&&typeof p!="undefined"&&(a=new RegExp("^(?:-|)\\.[\\d]{1,"+p+"}$").test(c));typeof p=="undefined"&&/\./.test(c)&&(a=false)}else{a=false}UXC.log("nValid",q,typeof r,typeof p,typeof o,typeof b,o,b)}else{a=false}!a&&f.error(m);return a},nrange:function(o){var a=f.datatype.n(o),n,p;UXC.log("zzzz",a);if(a){var b,c;if(o.is("[fromNEl]")){b=f.getElement(o.attr("fromNEl"))}if(o.is("[toNEl]")){c=f.getElement(o.attr("toNEl"))}if(!(b&&b.length||c&&c.length)){var l=o.parent(),m=[];l.find("input[datatype]").each(function(){var g=d(this);/nrange/i.test(g.attr("datatype"))&&m.push(this)});UXC.log("ccc",m.length);if(m.length===2){b=d(m[0]);c=d(m[1])}}UXC.log("aaaa",a);if(b&&b.length||c&&c.length){b&&b.length&&!(c&&c.length)&&(c=o);!(b&&b.length)&&c&&c.length&&(b=o);UXC.log("nrange",b.length,c.length);c.val(d.trim(c.val()));b.val(d.trim(b.val()));if(c[0]!=b[0]&&c.val().length&&b.val().length){a&&(a=f.datatype.n(c));a&&(a=f.datatype.n(b));a&&(+b.val())>(+c.val())&&(a=false);UXC.log(+b.val(),+c.val(),a);a&&f.valid(b);a&&f.valid(c);if(a){b.removeClass("error");c.removeClass("error")}else{b.addClass("error");c.addClass("error")}}}}!a&&f.error(o);return a},d:function(l){var a=d.trim(l.val()),c,b=/^[\d]{4}([\/.-]|)[01][\d]\1[0-3][\d]$/;if(!a){return true}if(c=b.test(a)){var m=f.getTimestamp(l.val()),k,n;if(l.is("[minvalue]")&&(c=b.test(l.attr("minvalue")))){k=f.getTimestamp(l.attr("minvalue"));m<k&&(c=false)}if(c&&l.is("[maxvalue]")&&(c=b.test(l.attr("maxvalue")))){n=f.getTimestamp(l.attr("maxvalue"));m>n&&(c=false)}}!c&&f.error(l);return c},daterange:function(o){var a=f.datatype.d(o),n,p;if(a){var m,b;if(o.is("[fromDateEl]")){m=f.getElement(o.attr("fromDateEl"))}if(o.is("[toDateEl]")){b=f.getElement(o.attr("toDateEl"))}if(!(m&&m.length||b&&b.length)){var c=o.parent(),l=c.find("input[datatype=daterange]");if(l.length===2){m=d(l[0]);b=d(l[1])}}if(m&&m.length||b&&b.length){m&&m.length&&!(b&&b.length)&&(b=o);!(m&&m.length)&&b&&b.length&&(m=o);UXC.log("daterange",m.length,b.length);b.val(d.trim(b.val()));m.val(d.trim(m.val()));if(b[0]!=m[0]&&b.val().length&&m.val().length){a&&(a=f.datatype.d(b));a&&(a=f.datatype.d(m));a&&f.getTimestamp(m.val())>f.getTimestamp(b.val())&&(a=false);a&&f.valid(m);a&&f.valid(b);if(a){m.removeClass("error");b.removeClass("error")}else{m.addClass("error");b.addClass("error")}}}}!a&&f.error(o);return a},time:function(b){var a=/^(([0-1]\d)|(2[0-3])):[0-5]\d:[0-5]\d$/.test(b.val());!a&&f.error(b);return a},minute:function(b){var a=/^(([0-1]\d)|(2[0-3])):[0-5]\d$/.test(b.val());!a&&f.error(b);return a},bankcard:function(b){var a=/^[1-9][\d]{3}(?: |)(?:[\d]{4}(?: |))(?:[\d]{4}(?: |))(?:[\d]{4})(?:(?: |)[\d]{3}|)$/.test(b.val());!a&&f.error(b);return a},cnname:function(b){var a=f.bytelen(b.val())<32&&/^[\u4e00-\u9fa5a-zA-Z.\u3002\u2022]{2,32}$/.test(b.val());!a&&f.error(b);return a},username:function(b){var a=/^[a-zA-Z0-9][\w-]{2,29}$/.test(b.val());!a&&f.error(b);return a},idnumber:function(b){var a=/^[0-9]{15}(?:[0-9]{2}(?:[0-9xX]|)|)$/.test(b.val());!a&&f.error(b);return a},mobilecode:function(b,c){var a=/^(?:13|14|15|16|18|19)\d{9}$/.test(b.val());!c&&!a&&f.error(b);return a},mobile:function(a,b){return f.datatype.mobilecode(a,b)},mobilezonecode:function(b,c){var a=/^(?:\+[0-9]{1,6} |)(?:0|)(?:13|14|15|16|18|19)\d{9}$/.test(b.val());!c&&!a&&f.error(b);return a},mobilephone:function(b){var a=f.datatype.mobilecode(b,true)||f.datatype.phone(b,true);!a&&f.error(b);return a},mobilephoneall:function(b){var a=f.datatype.mobilezonecode(b,true)||f.datatype.phoneall(b,true);!a&&f.error(b);return a},phone:function(b,c){var a=/^(?:0(?:10|2\d|[3-9]\d\d)(?: |\-|)|)[1-9]\d{6,7}$/.test(b.val());!c&&!a&&f.error(b);return a},phoneall:function(b,c){var a=/^(?:\+[\d]{1,6}(?: |\-)|)(?:0[\d]{2,3}(?:\-| |)|)[1-9][\d]{6,7}(?:(?: |)\#[\d]{1,6}|)$/.test(b.val());!c&&!a&&f.error(b);return a},phonezone:function(b){var a=/^[0-9]{3,4}$/.test(b.val());!a&&f.error(b);return a},phonecode:function(b){var a=/^[0-9]{7,8}$/.test(b.val());!a&&f.error(b);return a},phoneext:function(b){var a=/^[0-9]{1,6}$/.test(b.val());!a&&f.error(b);return a},length:function(k){var b=true,n=f.getDatatype(k),c,l,a=d.trim(k.val()),m;if(!a){return b}if(k.is("[minlength]")){UXC.log("minlength");c=parseInt(k.attr("minlength"),10)||0}if(k.is("[maxlength]")){UXC.log("maxlength");l=parseInt(k.attr("maxlength"),10)||0}switch(n){case"richtext":case"bytetext":m=f.bytelen(a);break;default:m=a.length;break}c&&(m<c)&&(b=false);l&&(m>l)&&(b=false);UXC.log("lengthValid: ",c,l,b);!b&&f.error(k);return b},reqmsg:function(b){var a;if(b.val()&&b.val().constructor==Array){a=!!(d.trim(b.val().join("")+""))}else{a=!!d.trim(b.val()||"")}!a&&f.error(b,"reqmsg");UXC.log("regmsgValid: "+a);return a},reg:function(b){var a=true,c;if(b.is("[reg-pattern]")){c=b.attr("reg-pattern")}if(!c){c=d.trim(b.attr("datatype")).replace(/^reg(?:\-|)/i,"")}c.replace(/^\/([\s\S]*)\/([\w]{0,3})$/,function(k,l,j){UXC.log(l,j);a=new RegExp(l,j||"").test(b.val())});!a&&f.error(b);return a},vcode:function(b){var a,c=parseInt(d.trim(b.attr("datatype")).replace(/^vcode(?:\-|)/i,""),10)||4;UXC.log("vcodeValid: "+c);a=new RegExp("^[0-9a-zA-Z]{"+c+"}$").test(b.val());!a&&f.error(b);return a},text:function(a){return true},bytetext:function(a){return true},richtext:function(a){return true},url:function(b){var a=/^((http|ftp|https):\/\/|)[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])$/.test(b.val());!a&&f.error(b);return a},domain:function(b){var a=/^(?:(?:f|ht)tp\:\/\/|)((?:(?:(?:\w[\.\-\+]*))\w)*)((?:(?:(?:\w[\.\-\+]*){0,62})\w)+)\.(\w{2,6})(?:\/|)$/.test(b.val());!a&&f.error(b);return a},email:function(b){var a=/^[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(b.val());!a&&f.error(b);return a},zipcode:function(b){var a=/^[0-9]{6}$/.test(b.val());!a&&f.error(b);return a}}}}(jQuery));