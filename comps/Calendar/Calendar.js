(function(a){!window.UXC&&(window.UXC={log:function(){}});window.ZINDEX_COUNT=window.ZINDEX_COUNT||50001;var c=UXC.Calendar=window.Calendar={pickDate:function(d){d=a(d);if(!(d&&d.length)){return}a("body > div.UXCCalendar").hide();c.lastIpt=d;d=a(d);var e=a.trim(d.attr("multidate")||"").toLowerCase();switch(e){case"week":c.pickWeek&&c.pickWeek(d);break;case"month":c.pickMonth&&c.pickMonth(d);break;case"season":c.pickSeason&&c.pickSeason(d);break;default:b.pickDate(d)}c.layoutInitedCallback&&c.layoutInitedCallback(a("body > div.UXCCalendar:visible"),d)},init:function(d){b.initTrigger(d)},autoInit:true,defaultDateSpan:20,lastIpt:null,setPosition:function(d,q){if(!(d&&q)){return}q.css({left:"-9999px",top:"-9999px","z-index":ZINDEX_COUNT++}).show();var o=q.width(),g=q.height(),p=d.width(),h=d.height(),n=d.offset(),m,k,e=a(window).width(),l=a(window).height(),f=a(document).scrollTop();m=n.left;k=n.top+h+5;if((k+g-f)>l){UXC.log("y overflow");k=n.top-g-3;if(k<f){k=f}}q.css({left:m+"px",top:k+"px"});UXC.log(o,g,p,h,n.left,n.top,e,l);UXC.log(f,m,k)},isCalendarElement:function(d){d=a(d);var e=0;if(d.length){if(d.hasClass("UXCCalendar_btn")){e=1}if(d.prop("nodeName")&&d.attr("datatype")&&d.prop("nodeName").toLowerCase()=="input"&&d.attr("datatype").toLowerCase()=="date"){e=1}if(d.prop("nodeName")&&d.attr("multidate")&&d.prop("nodeName").toLowerCase()=="input"){e=1}}return e},layoutInitedCallback:null,layoutHideCallback:null,domClickFilter:null,hide:function(){a("body > div.UXCCalendar").hide();c.layoutHideCallback&&c.layoutHideCallback(c.lastIpt)},getDate:function(d){var f={date:0,minvalue:0,maxvalue:0,initMinvalue:0,initMaxvalue:0},e;if(e=parseISODate(d.val())){f.date=e}else{if(d.val()&&(e=d.val().replace(/[^\d]/g,"")).length==16){f.date=parseISODate(e.slice(0,8));f.rangeStart=cloneDate(f.date);f.rangeEnd=parseISODate(e.slice(8))}else{f.date=new Date()}}f.minvalue=parseISODate(d.attr("minvalue"));f.maxvalue=parseISODate(d.attr("maxvalue"));c.updateInitYearList(f);return f},updateInitYearList:function(d){d.initMinvalue=cloneDate(d.date);d.initMinvalue.setFullYear(d.initMinvalue.getFullYear()-c.defaultDateSpan);d.initMaxvalue=cloneDate(d.date);d.initMaxvalue.setFullYear(d.initMaxvalue.getFullYear()+c.defaultDateSpan)},cnWeek:"日一二三四五六",cnUnit:"十一二三四五六七八九",getCnNum:function(d){var e=c.cnUnit.charAt(d%10);d>10&&(e=(d%10!==0?c.cnUnit.charAt(0):"")+e);d>19&&(e=c.cnUnit.charAt(Math.floor(d/10))+e);return e},tpl:""};var b={initTrigger:function(d){d.each(function(){var f=a(this),e=(f.prop("nodeName")||"").toLowerCase();UXC.log("\nCalendar.init: ",e);if(e!="input"){b.initTrigger(d.find(a("input[type=text]")));return}if(!(a.trim(f.attr("datatype")||"").toLowerCase()=="date"||a.trim(f.attr("multidate")||"")||a.trim(f.attr("datatype")||"").toLowerCase()=="daterange")){return}UXC.log("find Calendar item:",f.attr("name"),f.attr("id"),f.attr("datatype"));var g=f.find("+ input.UXCCalendar_btn");if(!g.length){f.after(g=a('<input type="button" class="UXCCalendar_btn"  />'))}g[0].forCalendar=f})},lastDateObj:null,pickDate:function(d){UXC.log("Calendar.pickDate",new Date().getTime());d=a(d);var e=b.lastDateObj=c.getDate(d);UXC.log(e.date.getFullYear(),e.date.getMonth()+1,e.date.getDate());b.initDateLayout(e);c.setPosition(d,b.getLayout());d.blur()},initDateLayout:function(d){c.updateInitYearList(d);b.initYear(d);b.initMonth(d);b.initMonthDate(d)},initMonthDate:function(t){var v=b.getLayout();var u=maxDayOfMonth(t.date),m=t.date.getDay()||7,s=m+u,g=6,e=[],f,d,p,k,l;var h=new Date(t.date.getFullYear(),t.date.getMonth(),1);var o=h.getDay()||7;if(o<2){h.setDate(-(o-1+6))}else{h.setDate(-(o-2))}var q=new Date();var r=UXC.Calendar.lastIpt,n=true;if(r.is("[currentcanselect]")){n=parseBool(r.attr("currentcanselect"))}if(t.maxvalue&&!n){t.maxvalue.setDate(t.maxvalue.getDate()-1)}e.push("<tr>");for(k=1;k<=42;k++){l=[];if(h.getDay()===0||h.getDay()==6){l.push("weekend")}if(!isSameMonth(t.date,h)){l.push("other")}if(t.minvalue&&h.getTime()<t.minvalue.getTime()){l.push("unable")}if(t.maxvalue&&h.getTime()>t.maxvalue.getTime()){l.push("unable")}if(isSameDay(h,q)){l.push("today")}if(isSameDay(t.date,h)){l.push("cur")}e.push('<td class="',l.join(" "),'">','<a href="javascript:" date="',h.getTime(),'" title="'+formatISODate(h)+'" >',h.getDate(),"</a></td>");h.setDate(h.getDate()+1);if(k%7===0&&k!=42){e.push("</tr><tr>")}}e.push("</tr>");v.find("table.UTableBorder tbody").html(a(e.join("")));UXC.log(d,f,u,m,s,g)},initMonth:function(d){var e=b.getLayout();a(e.find("select.UMonth").val(d.date.getMonth()))},initYear:function(l){var m=b.getLayout(),h=[],f,g,e=l.initMinvalue.getFullYear(),k=l.initMaxvalue.getFullYear();UXC.log(e,k);if(!g){g=l.date.getFullYear()}for(var d=e;d<=k;d++){f="";if(g===d){f=" selected "}h.push('<option value="'+d+'"'+f+">"+d+"</option>")}a(h.join("")).appendTo(m.find("select.UYear").html(""))},updateYear:function(f){UXC.log(f);if(!b.lastDateObj){return}var g=maxDayOfMonth(b.lastDateObj.date),e=new Date(f,b.lastDateObj.date.getMonth(),1),d=maxDayOfMonth(e);if(g>d){e.setDate(d)}else{e.setDate(b.lastDateObj.date.getDate())}b.lastDateObj.date=e;b.initDateLayout(b.lastDateObj)},setNewMonth:function(f){UXC.log(f);if(!b.lastDateObj){return}var g=maxDayOfMonth(b.lastDateObj.date),e=new Date(b.lastDateObj.date.getFullYear(),f,1),d=maxDayOfMonth(e);if(g>d){e.setDate(d)}else{e.setDate(b.lastDateObj.date.getDate())}b.lastDateObj.date=e;b.initMonth(b.lastDateObj);b.initMonthDate(b.lastDateObj)},getLayout:function(){var e=a("#UXCCalendar");if(!e.length){e=a(c.tpl||b.tpl);e.attr("id","UXCCalendar").hide().appendTo(document.body);var d=a(['<option value="0">一月</option>','<option value="1">二月</option>','<option value="2">三月</option>','<option value="3">四月</option>','<option value="4">五月</option>','<option value="5">六月</option>','<option value="6">七月</option>','<option value="7">八月</option>','<option value="8">九月</option>','<option value="9">十月</option>','<option value="10">十一月</option>','<option value="11">十二月</option>'].join("")).appendTo(e.find("select.UMonth"));e.hide();e.data("confirmMethod",b.onConfirm);e.data("updateYearMethod",b.updateYear)}return e},setDate:function(h){if(!(h&&c.lastIpt&&c.lastIpt.length)){return}var f=new Date(),e="-";f.setTime(h);var g=c.lastIpt.attr("dateFormat");if(g){g=g.replace(/[\da-zA-Z]/g,"");if(g.length){g=g.slice(0,1)}e=g}var d=formatISODate(f,e);c.lastIpt.val(d).focus()},onConfirm:function(){var d;d=b.getLayout().find("table td.cur a");if(d.parent("td").hasClass("unable")){return 0}d&&d.length&&d.attr("date")&&b.setDate(d.attr("date"));return 1},tpl:['<div id="UXCCalendar" class="UXCCalendar">\n','    <div class="UHeader">\n','        <select class="UYear"></select>\n','        <img class="UImg yearctl" align="absMiddle" usemap="#UXCCalendar_Year" />\n','        <map name="UXCCalendar_Year"><area shape="rect" coords="0,0,13,8" href="#" action="up"><area shape="rect" coords="0,10,13,17" href="#" action="down"></map>\n','        <select class="UMonth"></select>\n','        <img class="UImg monthctl" align="absMiddle" usemap="#UXCCalendar_Month"  />\n','        <map name="UXCCalendar_Month"><area shape="rect" coords="0,0,13,8" href="#" action="up"><area shape="rect" coords="0,10,13,17" href="#" action="down"></map>\n',"    </div>\n",'    <table class="UTable">\n',"        <thead>\n","            <tr>\n","                <th>一</th>\n","                <th>二</th>\n","                <th>三</th>\n","                <th>四</th>\n","                <th>五</th>\n","                <th>六</th>\n","                <th>日</th>\n","            </tr>\n","        </thead>\n","   </table>\n",'   <table class="UTable UTableBorder">\n',"        <tbody>\n","           <!--<tr>\n",'                <td class="cur"><a href="#">2</a></td>\n','                <td class="unable"><a href="#">2</a></td>\n','                <td class="weekend cur"><a href="#">6</a></td>\n','                <td class="weekend hover"><a href="#">13</a></td>\n','                <td class="weekend other"><a href="#">41</a></td>\n','                <td class="weekend other"><a href="#">42</a></td>\n',"            </tr>\n-->","        </tbody>\n","    </table>\n",'    <div class="UFooter">\n','        <button type="button" class="UConfirm">确定</button>\n','        <button type="button" class="UClear">清空</button>\n','        <button type="button" class="UCancel">取消</button>\n',"    </div>\n","</div>\n"].join("")};a(document).ready(function(d){setTimeout(function(e){if(!c.autoInit){return}c.init(a("input[type=text]"))},200);a(document).delegate("body > div.UXCCalendar select.UYear","change",function(e){var f=a(this).parents("div.UXCCalendar");f.length&&f.data("updateYearMethod")&&f.data("updateYearMethod")(a(this).val())});a(document).delegate("body > div.UXCCalendar button.UNextYear","click",function(e){var f=a(this).parents("div.UXCCalendar");f.length&&f.data("nextYearMethod")&&f.data("nextYearMethod")()});a(document).delegate("body > div.UXCCalendar button.UPreYear","click",function(e){var f=a(this).parents("div.UXCCalendar");f.length&&f.data("preYearMethod")&&f.data("preYearMethod")()});a(document).delegate("#UXCCalendar select.UMonth","change",function(e){b.setNewMonth(a(this).val())});a(document).delegate("body > div.UXCCalendar button.UConfirm","click",function(e){var g=a(this).parents("div.UXCCalendar"),f;if(g.length&&(f=g.find("td.cur")).length){if(f.hasClass("unable")){return}}g.length&&g.data("confirmMethod")&&g.data("confirmMethod")(this);c.hide()});a(document).delegate("map[name=UXCCalendar_Year] area","click",function(f){f.preventDefault();var e=a(this),g=b.lastDateObj;if(!(g&&e.attr("action"))){return}if(e.attr("action").toLowerCase()=="up"){g.date.setFullYear(g.date.getFullYear()+1)}else{if(e.attr("action").toLowerCase()=="down"){g.date.setFullYear(g.date.getFullYear()-1)}}b.initDateLayout(g);UXC.log(e.attr("action"))});a(document).delegate("map[name=UXCCalendar_Month] area","click",function(f){f.preventDefault();var e=a(this),g=b.lastDateObj;if(!(g&&e.attr("action"))){return}if(e.attr("action").toLowerCase()=="up"){g.date.setMonth(g.date.getMonth()+1);g.initMinvalue.setMonth(g.initMinvalue.getMonth()+1);g.initMaxvalue.setMonth(g.initMaxvalue.getMonth()+1)}else{if(e.attr("action").toLowerCase()=="down"){g.date.setMonth(g.date.getMonth()-1);g.initMinvalue.setMonth(g.initMinvalue.getMonth()-1);g.initMaxvalue.setMonth(g.initMaxvalue.getMonth()-1)}}b.initDateLayout(g);UXC.log(e.attr("action"))});a(document).delegate("body > div.UXCCalendar button.UClear","click",function(e){c.lastIpt&&c.lastIpt.length&&c.lastIpt.val("")});a(document).delegate("body > div.UXCCalendar button.UCancel","click",function(e){c.hide()});a(document).on("click",function(e){var f=e.target||e.srcElement;if(c.domClickFilter){if(c.domClickFilter(a(f))===false){return}}if(c.isCalendarElement(e.target||e.targetElement)){return}if(f&&f.nodeName.toLowerCase()!="input"){c.hide();return}setTimeout(function(){if(c.lastIpt&&c.lastIpt.length&&f==c.lastIpt[0]){return}c.hide()},100)});a(document).delegate("input.UXCCalendar_btn","click",function(e){if(this.forCalendar){c.pickDate(this.forCalendar)}});a(document).delegate("input[datatype=date], input[datatype=daterange], input[multidate]","focus",function(e){c.pickDate(this)});a(document).delegate("body > div.UXCCalendar","click",function(e){e.stopPropagation()});a(document).delegate("#UXCCalendar table a","click",function(f){f.preventDefault();var e=a(this),g=e.attr("date")||"";if(!g){return}if(e.parent("td").hasClass("unable")){return}UXC.log(g);b.setDate(g);c.hide()});a(window).on("scroll resize",function(e){var f=a("body > div.UXCCalendar:visible");if(!(f.length&&c.lastIpt)){return}c.setPosition(c.lastIpt,f)})})}(jQuery));(function(b){UXC.Calendar.pickWeek=function(d){c.lastDateObj=UXC.Calendar.getDate(d);UXC.Calendar.lastIpt=d;UXC.Calendar.setPosition(d,c.update(c.lastDateObj))};UXC.Calendar.pickWeek.tpl="";UXC.Calendar.pickWeek.dayOffset=1;var c={getLayout:function(){var d;if(!(d=b("#UXCCalendar_week")).length){d=b(UXC.Calendar.pickWeek.tpl||c.tpl);d.appendTo(document.body);d.data("confirmMethod",c.onConfirm);d.data("updateYearMethod",c.updateYear);d.data("nextYearMethod",c.nextYear);d.data("preYearMethod",c.preYear)}return d},onConfirm:function(){UXC.log("Calendar.pickWeek, onConfirm");var d=c.getLayout().find("td.cur");if(!d.length){c.getLayout().find("td.today")}if(d.length){d.find("a").trigger("click")}},updateYear:function(d){if(!c.lastDateObj){return}c.lastDateObj.date.setFullYear(d);UXC.Calendar.updateInitYearList(c.lastDateObj);c.update(c.lastDateObj)},nextYear:function(){UXC.log("nextYearMethod");if(!c.lastDateObj){return}c.updateYear(c.lastDateObj.date.getFullYear()+1)},preYear:function(){UXC.log("preYearMethod");if(!c.lastDateObj){return}c.updateYear(c.lastDateObj.date.getFullYear()-1)},update:function(d){c.getLayout();c.updateHead(d);c.updateBody(d);return c.getLayout()},updateHead:function(l){var m=c.getLayout(),h=[],f,g,e=l.initMinvalue.getFullYear(),k=l.initMaxvalue.getFullYear();if(!g){g=l.date.getFullYear()}for(var d=e;d<=k;d++){f="";if(g===d){f=" selected "}h.push('<option value="'+d+'"'+f+">"+d+"</option>")}b(h.join("")).appendTo(m.find("select.UYear").html(""))},updateBody:function(r){var n=r.date;var h=c.getLayout();h.find("button.UYearButton").html(n.getFullYear());var u=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime();var k=a(n.getFullYear(),UXC.Calendar.pickWeek.dayOffset);var t=a(n.getFullYear()+1,UXC.Calendar.pickWeek.dayOffset);var l=0;var v=[],f,p,o,m,s,g=n.getFullYear(),e=Math.ceil(k.length/8);var q=UXC.Calendar.lastIpt,d=parseBool(q.attr("currentcanselect"));if(r.maxvalue&&d){var w=r.maxvalue.getDay();if(w>0){r.maxvalue.setDate(r.maxvalue.getDate()+(7-w))}}v.push("<tr>");for(i=1,j=e*8;i<=j;i++){p=k[i-1];if(!p){p=t[l++];g=n.getFullYear()+1}m=new Date();s=new Date();m.setTime(p.start);s.setTime(p.end);o=printf("{0}年 第{1}周<br/>开始日期: {2} (周{4})<br />结束日期: {3} (周{5})",g,UXC.Calendar.getCnNum(p.week),formatISODate(m),formatISODate(s),UXC.Calendar.cnWeek.charAt(m.getDay()%7),UXC.Calendar.cnWeek.charAt(s.getDay()%7));f=[];if(r.minvalue&&m.getTime()<r.minvalue.getTime()){f.push("unable")}if(r.maxvalue&&s.getTime()>r.maxvalue.getTime()){f.push("unable")}if(n.getTime()>=m.getTime()&&n.getTime()<=s.getTime()){f.push("cur")}if(u>=m.getTime()&&u<=s.getTime()){f.push("today")}v.push(printf('<td class="{0}"><a href="javascript:" title="{2}" dstart="{3}" dend="{4}" week="{1}" >{1}</a></td>',f.join(" "),p.week,o,m.getTime(),s.getTime()));if(i%8===0&&i!=j){v.push("</tr><tr>")}}v.push("</tr>");h.find("table.UTableBorder tbody").html(b(v.join("")))},lastDateObj:null,tpl:['<div id="UXCCalendar_week" class="UXCCalendar UXCCalendar_week" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("")};function a(g,f){var k=[],h,e=1,f=f||0,g=parseInt(g,10),d=new Date(g,0,1);d.getDay()>1&&d.setDate(d.getDate()-d.getDay()+7);f>0&&(f=(new Date(2000,1,2)-new Date(2000,1,1))*f);while(d.getFullYear()<=g){h={week:e++,start:null,end:null};h.start=d.getTime()+f;d.setDate(d.getDate()+6);h.end=d.getTime()+f;d.setDate(d.getDate()+1);if(d.getFullYear()>g){d=new Date(d.getFullYear(),0,1);if(d.getDay()<2){break}}k.push(h)}return k}b(document).delegate("#UXCCalendar_week table a","click",function(e){var f=b(this),d=new Date(),g=new Date();if(!UXC.Calendar.lastIpt){return}if(f.parent("td").hasClass("unable")){return}d.setTime(f.attr("dstart"));g.setTime(f.attr("dend"));UXC.Calendar.lastIpt.val(printf("{0} 至 {1}",formatISODate(d),formatISODate(g)));UXC.Calendar.hide()})}(jQuery));(function(a){UXC.Calendar.pickMonth=function(c){b.lastDateObj=UXC.Calendar.getDate(c);UXC.Calendar.lastIpt=c;UXC.Calendar.setPosition(c,b.update(b.lastDateObj))};UXC.Calendar.pickMonth.tpl="";var b={getLayout:function(){var c;if(!(c=a("#UXCCalendar_month")).length){c=a(UXC.Calendar.pickMonth.tpl||b.tpl);c.appendTo(document.body);c.data("confirmMethod",b.onConfirm);c.data("updateYearMethod",b.updateYear);c.data("nextYearMethod",b.nextYear);c.data("preYearMethod",b.preYear)}return c},onConfirm:function(){UXC.log("Calendar.pickMonth, onConfirm");var c=b.getLayout().find("td.cur");if(!c.length){b.getLayout().find("td.today")}if(c.length){c.find("a").trigger("click")}},updateYear:function(c){if(!b.lastDateObj){return}b.lastDateObj.date.setFullYear(c);UXC.Calendar.updateInitYearList(b.lastDateObj);b.update(b.lastDateObj)},nextYear:function(){UXC.log("nextYearMethod");if(!b.lastDateObj){return}b.updateYear(b.lastDateObj.date.getFullYear()+1)},preYear:function(){UXC.log("preYearMethod");if(!b.lastDateObj){return}b.updateYear(b.lastDateObj.date.getFullYear()-1)},update:function(c){b.getLayout();b.updateHead(c);b.updateBody(c);return b.getLayout()},updateHead:function(k){var l=b.getLayout(),g=[],e,f,d=k.initMinvalue.getFullYear(),h=k.initMaxvalue.getFullYear();if(!f){f=k.date.getFullYear()}for(var c=d;c<=h;c++){e="";if(f===c){e=" selected "}g.push('<option value="'+c+'"'+e+">"+c+"</option>")}a(g.join("")).appendTo(l.find("select.UYear").html(""))},updateBody:function(o){var r=o.date;var q=b.getLayout();q.find("button.UYearButton").html(r.getFullYear());var m=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime();var c=[],h,d,p,f,l,g,e=r.getFullYear();var n=UXC.Calendar.lastIpt,k=parseBool(n.attr("currentcanselect"));if(o.maxvalue&&k){o.maxvalue.setDate(maxDayOfMonth(o.maxvalue))}c.push("<tr>");for(i=1,j=12;i<=j;i++){f=new Date(e,i-1,1);l=new Date(e,i-1,maxDayOfMonth(f));p=printf("{0}年 {1}月<br/>开始日期: {2} (周{4})<br />结束日期: {3} (周{5})",e,UXC.Calendar.getCnNum(i),formatISODate(f),formatISODate(l),UXC.Calendar.cnWeek.charAt(f.getDay()%7),UXC.Calendar.cnWeek.charAt(l.getDay()%7));h=[];if(o.minvalue&&f.getTime()<o.minvalue.getTime()){h.push("unable")}if(o.maxvalue&&l.getTime()>o.maxvalue.getTime()){h.push("unable")}if(r.getTime()>=f.getTime()&&r.getTime()<=l.getTime()){h.push("cur")}if(m>=f.getTime()&&m<=l.getTime()){h.push("today")}g=UXC.Calendar.cnUnit.charAt(i%10);i>10&&(g="十"+g);c.push(printf('<td class="{0}"><a href="javascript:" title="{1}" dstart="{3}" dend="{4}" month="{5}" >{2}月</a></td>',h.join(" "),p,g,f.getTime(),l.getTime(),i));if(i%3===0&&i!=j){c.push("</tr><tr>")}}c.push("</tr>");q.find("table.UTableBorder tbody").html(a(c.join("")))},lastDateObj:null,tpl:['<div id="UXCCalendar_month" class="UXCCalendar UXCCalendar_week UXCCalendar_month" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("")};a(document).delegate("#UXCCalendar_month table a","click",function(d){var e=a(this),c=new Date(),f=new Date();if(!UXC.Calendar.lastIpt){return}if(e.parent("td").hasClass("unable")){return}c.setTime(e.attr("dstart"));f.setTime(e.attr("dend"));UXC.Calendar.lastIpt.val(printf("{0} 至 {1}",formatISODate(c),formatISODate(f)));UXC.Calendar.hide()})}(jQuery));(function(a){UXC.Calendar.pickSeason=function(c){b.lastDateObj=UXC.Calendar.getDate(c);UXC.Calendar.lastIpt=c;UXC.Calendar.setPosition(c,b.update(b.lastDateObj))};UXC.Calendar.pickSeason.tpl="";var b={getLayout:function(){var c;if(!(c=a("#UXCCalendar_season")).length){c=a(UXC.Calendar.pickSeason.tpl||b.tpl);c.appendTo(document.body);c.data("confirmMethod",b.onConfirm);c.data("updateYearMethod",b.updateYear);c.data("nextYearMethod",b.nextYear);c.data("preYearMethod",b.preYear)}return c},onConfirm:function(){UXC.log("Calendar.pickSeason, onConfirm");var c=b.getLayout().find("td.cur");if(!c.length){b.getLayout().find("td.today")}if(c.length){c.find("a").trigger("click")}},updateYear:function(c){if(!b.lastDateObj){return}b.lastDateObj.date.setFullYear(c);UXC.Calendar.updateInitYearList(b.lastDateObj);b.update(b.lastDateObj)},nextYear:function(){UXC.log("nextYearMethod");if(!b.lastDateObj){return}b.updateYear(b.lastDateObj.date.getFullYear()+1)},preYear:function(){UXC.log("preYearMethod");if(!b.lastDateObj){return}b.updateYear(b.lastDateObj.date.getFullYear()-1)},update:function(c){b.getLayout();b.updateHead(c);b.updateBody(c);return b.getLayout()},updateHead:function(k){var l=b.getLayout(),g=[],e,f,d=k.initMinvalue.getFullYear(),h=k.initMaxvalue.getFullYear();if(!f){f=k.date.getFullYear()}for(var c=d;c<=h;c++){e="";if(f===c){e=" selected "}g.push('<option value="'+c+'"'+e+">"+c+"</option>")}a(g.join("")).appendTo(l.find("select.UYear").html(""))},updateBody:function(q){var t=q.date;var s=b.getLayout();s.find("button.UYearButton").html(t.getFullYear());var o=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime();var c=[],l,d,r,h,n,k,g=t.getFullYear();var p=UXC.Calendar.lastIpt,m=parseBool(p.attr("currentcanselect"));if(q.maxvalue&&m){var e=q.maxvalue.getMonth()+1,f;if(e%3!==0){q.maxvalue.setDate(1);q.maxvalue.setMonth(e+(3-(e%3)-1))}q.maxvalue.setDate(maxDayOfMonth(q.maxvalue))}c.push("<tr>");for(i=1,j=4;i<=j;i++){h=new Date(g,i*3-3,1);n=new Date(g,i*3-1,1);n.setDate(maxDayOfMonth(n));k=UXC.Calendar.cnUnit.charAt(i%10);i>10&&(k="十"+k);r=printf("{0}年 第{1}季度<br/>开始日期: {2} (周{4})<br />结束日期: {3} (周{5})",g,UXC.Calendar.getCnNum(i),formatISODate(h),formatISODate(n),UXC.Calendar.cnWeek.charAt(h.getDay()%7),UXC.Calendar.cnWeek.charAt(n.getDay()%7));l=[];if(q.minvalue&&h.getTime()<q.minvalue.getTime()){l.push("unable")}if(q.maxvalue&&n.getTime()>q.maxvalue.getTime()){l.push("unable")}if(t.getTime()>=h.getTime()&&t.getTime()<=n.getTime()){l.push("cur")}if(o>=h.getTime()&&o<=n.getTime()){l.push("today")}c.push(printf('<td class="{0}"><a href="javascript:" title="{1}" dstart="{3}" dend="{4}" month="{5}" >{2}季度</a></td>',l.join(" "),r,k,h.getTime(),n.getTime(),i));if(i%2===0&&i!=j){c.push("</tr><tr>")}}c.push("</tr>");s.find("table.UTableBorder tbody").html(a(c.join("")))},lastDateObj:null,tpl:['<div id="UXCCalendar_season" class="UXCCalendar UXCCalendar_week UXCCalendar_season" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("")};a(document).delegate("#UXCCalendar_season table a","click",function(d){var e=a(this),c=new Date(),f=new Date();if(!UXC.Calendar.lastIpt){return}if(e.parent("td").hasClass("unable")){return}c.setTime(e.attr("dstart"));f.setTime(e.attr("dend"));UXC.Calendar.lastIpt.val(printf("{0} 至 {1}",formatISODate(c),formatISODate(f)));UXC.Calendar.hide()})}(jQuery));