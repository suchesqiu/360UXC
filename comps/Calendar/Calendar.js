(function(a){!window.UXC&&(window.UXC={log:function(){}});window.ZINDEX_COUNT=window.ZINDEX_COUNT||50001;var c=UXC.Calendar=window.Calendar={pickDate:function(d){d=a(d);if(!(d&&d.length)){return}a("body > div.UXCCalendar").hide();c.lastIpt=d;d=a(d);var e=a.trim(d.attr("multidate")||"").toLowerCase();switch(e){case"week":c.pickWeek&&c.pickWeek(d);break;case"month":c.pickMonth&&c.pickMonth(d);break;case"season":c.pickSeason&&c.pickSeason(d);break;default:b.pickDate(d)}c.layoutInitedCallback&&c.layoutInitedCallback(a("body > div.UXCCalendar:visible"),d)},init:function(d){b.initTrigger(d)},autoInit:true,defaultDateSpan:20,lastIpt:null,setPosition:function(p,h){if(!(p&&h)){return}h.css({left:"-9999px",top:"-9999px","z-index":ZINDEX_COUNT++}).show();var n=h.width(),k=h.height(),d=p.width(),f=p.height(),l=p.offset(),o,g,q=a(window).width(),m=a(window).height(),e=a(document).scrollTop();o=l.left;g=l.top+f+5;if((g+k-e)>m){UXC.log("y overflow");g=l.top-k-3;if(g<e){g=e}}h.css({left:o+"px",top:g+"px"});UXC.log(n,k,d,f,l.left,l.top,q,m);UXC.log(e,o,g)},isCalendarElement:function(d){d=a(d);var e=0;if(d.length){if(d.hasClass("UXCCalendar_btn")){e=1}if(d.prop("nodeName")&&d.attr("datatype")&&d.prop("nodeName").toLowerCase()=="input"&&d.attr("datatype").toLowerCase()=="date"){e=1}if(d.prop("nodeName")&&d.attr("multidate")&&d.prop("nodeName").toLowerCase()=="input"){e=1}}return e},layoutInitedCallback:null,layoutHideCallback:null,domClickFilter:null,hide:function(){a("body > div.UXCCalendar").hide();c.layoutHideCallback&&c.layoutHideCallback(c.lastIpt)},getDate:function(d){var f={date:0,minvalue:0,maxvalue:0,initMinvalue:0,initMaxvalue:0},e;if(e=parseISODate(d.val())){f.date=e}else{if(d.val()&&(e=d.val().replace(/[^\d]/g,"")).length==16){f.date=parseISODate(e.slice(0,8));f.rangeStart=cloneDate(f.date);f.rangeEnd=parseISODate(e.slice(8))}else{f.date=new Date()}}f.minvalue=parseISODate(d.attr("minvalue"));f.maxvalue=parseISODate(d.attr("maxvalue"));c.updateInitYearList(f);return f},updateInitYearList:function(d){d.initMinvalue=cloneDate(d.date);d.initMinvalue.setFullYear(d.initMinvalue.getFullYear()-c.defaultDateSpan);d.initMaxvalue=cloneDate(d.date);d.initMaxvalue.setFullYear(d.initMaxvalue.getFullYear()+c.defaultDateSpan)},cnWeek:"日一二三四五六",cnUnit:"十一二三四五六七八九",getCnNum:function(d){var e=c.cnUnit.charAt(d%10);d>10&&(e=(d%10!==0?c.cnUnit.charAt(0):"")+e);d>19&&(e=c.cnUnit.charAt(Math.floor(d/10))+e);return e},tpl:""};var b={initTrigger:function(d){d.each(function(){var f=a(this),e=(f.prop("nodeName")||"").toLowerCase();UXC.log("\nCalendar.init: ",e);if(e!="input"){b.initTrigger(d.find(a("input[type=text]")));return}if(!(a.trim(f.attr("datatype")||"").toLowerCase()=="date"||a.trim(f.attr("multidate")||"")||a.trim(f.attr("datatype")||"").toLowerCase()=="daterange")){return}UXC.log("find Calendar item:",f.attr("name"),f.attr("id"),f.attr("datatype"));var g=f.find("+ input.UXCCalendar_btn");if(!g.length){f.after(g=a('<input type="button" class="UXCCalendar_btn"  />'))}g[0].forCalendar=f})},lastDateObj:null,pickDate:function(d){UXC.log("Calendar.pickDate",new Date().getTime());d=a(d);var e=b.lastDateObj=c.getDate(d);UXC.log(e.date.getFullYear(),e.date.getMonth()+1,e.date.getDate());b.initDateLayout(e);c.setPosition(d,b.getLayout());d.blur()},initDateLayout:function(d){c.updateInitYearList(d);b.initYear(d);b.initMonth(d);b.initMonthDate(d)},initMonthDate:function(o){var t=b.getLayout();var s=maxDayOfMonth(o.date),m=o.date.getDay()||7,k=m+s,g=6,e=[],f,d,r,q,l;var p=new Date(o.date.getFullYear(),o.date.getMonth(),1);var n=p.getDay()||7;if(n<2){p.setDate(-(n-1+6))}else{p.setDate(-(n-2))}var h=new Date();e.push("<tr>");for(q=1;q<=42;q++){l=[];if(p.getDay()===0||p.getDay()==6){l.push("weekend")}if(!isSameMonth(o.date,p)){l.push("other")}if(o.minvalue&&p.getTime()<o.minvalue.getTime()){l.push("unable")}if(o.maxvalue&&p.getTime()>o.maxvalue.getTime()){l.push("unable")}if(isSameDay(p,h)){l.push("today")}if(isSameDay(o.date,p)){l.push("cur")}e.push('<td class="',l.join(" "),'">','<a href="javascript:" date="',p.getTime(),'" title="'+formatISODate(p)+'" >',p.getDate(),"</a></td>");p.setDate(p.getDate()+1);if(q%7===0&&q!=42){e.push("</tr><tr>")}}e.push("</tr>");t.find("table.UTableBorder tbody").html(a(e.join("")));UXC.log(d,f,s,m,k,g)},initMonth:function(d){var e=b.getLayout();a(e.find("select.UMonth").val(d.date.getMonth()))},initYear:function(h){var k=b.getLayout(),g=[],e,d,m=h.initMinvalue.getFullYear(),f=h.initMaxvalue.getFullYear();UXC.log(m,f);if(!d){d=h.date.getFullYear()}for(var l=m;l<=f;l++){e="";if(d===l){e=" selected "}g.push('<option value="'+l+'"'+e+">"+l+"</option>")}a(g.join("")).appendTo(k.find("select.UYear").html(""))},updateYear:function(d){UXC.log(d);if(!b.lastDateObj){return}var e=maxDayOfMonth(b.lastDateObj.date),g=new Date(d,b.lastDateObj.date.getMonth(),1),f=maxDayOfMonth(g);if(e>f){g.setDate(f)}else{g.setDate(b.lastDateObj.date.getDate())}b.lastDateObj.date=g;b.initDateLayout(b.lastDateObj)},setNewMonth:function(d){UXC.log(d);if(!b.lastDateObj){return}var e=maxDayOfMonth(b.lastDateObj.date),g=new Date(b.lastDateObj.date.getFullYear(),d,1),f=maxDayOfMonth(g);if(e>f){g.setDate(f)}else{g.setDate(b.lastDateObj.date.getDate())}b.lastDateObj.date=g;b.initMonth(b.lastDateObj);b.initMonthDate(b.lastDateObj)},getLayout:function(){var e=a("#UXCCalendar");if(!e.length){e=a(c.tpl||b.tpl);e.attr("id","UXCCalendar").hide().appendTo(document.body);var d=a(['<option value="0">一月</option>','<option value="1">二月</option>','<option value="2">三月</option>','<option value="3">四月</option>','<option value="4">五月</option>','<option value="5">六月</option>','<option value="6">七月</option>','<option value="7">八月</option>','<option value="8">九月</option>','<option value="9">十月</option>','<option value="10">十一月</option>','<option value="11">十二月</option>'].join("")).appendTo(e.find("select.UMonth"));e.hide();e.data("confirmMethod",b.onConfirm);e.data("updateYearMethod",b.updateYear)}return e},setDate:function(f){if(!(f&&c.lastIpt&&c.lastIpt.length)){return}var h=new Date(),e="-";h.setTime(f);var g=c.lastIpt.attr("dateFormat");if(g){g=g.replace(/[\da-zA-Z]/g,"");if(g.length){g=g.slice(0,1)}e=g}var d=formatISODate(h,e);c.lastIpt.val(d).focus()},onConfirm:function(){var d;d=b.getLayout().find("table td.cur a");if(d.parent("td").hasClass("unable")){return 0}d&&d.length&&d.attr("date")&&b.setDate(d.attr("date"));return 1},tpl:['<div id="UXCCalendar" class="UXCCalendar">\n','    <div class="UHeader">\n','        <select class="UYear"></select>\n','        <img class="UImg yearctl" align="absMiddle" usemap="#UXCCalendar_Year" />\n','        <map name="UXCCalendar_Year"><area shape="rect" coords="0,0,13,8" href="#" action="up"><area shape="rect" coords="0,10,13,17" href="#" action="down"></map>\n','        <select class="UMonth"></select>\n','        <img class="UImg monthctl" align="absMiddle" usemap="#UXCCalendar_Month"  />\n','        <map name="UXCCalendar_Month"><area shape="rect" coords="0,0,13,8" href="#" action="up"><area shape="rect" coords="0,10,13,17" href="#" action="down"></map>\n',"    </div>\n",'    <table class="UTable">\n',"        <thead>\n","            <tr>\n","                <th>一</th>\n","                <th>二</th>\n","                <th>三</th>\n","                <th>四</th>\n","                <th>五</th>\n","                <th>六</th>\n","                <th>日</th>\n","            </tr>\n","        </thead>\n","   </table>\n",'   <table class="UTable UTableBorder">\n',"        <tbody>\n","           <!--<tr>\n",'                <td class="cur"><a href="#">2</a></td>\n','                <td class="unable"><a href="#">2</a></td>\n','                <td class="weekend cur"><a href="#">6</a></td>\n','                <td class="weekend hover"><a href="#">13</a></td>\n','                <td class="weekend other"><a href="#">41</a></td>\n','                <td class="weekend other"><a href="#">42</a></td>\n',"            </tr>\n-->","        </tbody>\n","    </table>\n",'    <div class="UFooter">\n','        <button type="button" class="UConfirm">确定</button>\n','        <button type="button" class="UClear">清空</button>\n','        <button type="button" class="UCancel">取消</button>\n',"    </div>\n","</div>\n"].join("")};a(document).ready(function(d){setTimeout(function(e){if(!c.autoInit){return}c.init(a("input[type=text]"))},200);a(document).delegate("body > div.UXCCalendar select.UYear","change",function(f){var e=a(this).parents("div.UXCCalendar");e.length&&e.data("updateYearMethod")&&e.data("updateYearMethod")(a(this).val())});a(document).delegate("body > div.UXCCalendar button.UNextYear","click",function(f){var e=a(this).parents("div.UXCCalendar");e.length&&e.data("nextYearMethod")&&e.data("nextYearMethod")()});a(document).delegate("body > div.UXCCalendar button.UPreYear","click",function(f){var e=a(this).parents("div.UXCCalendar");e.length&&e.data("preYearMethod")&&e.data("preYearMethod")()});a(document).delegate("#UXCCalendar select.UMonth","change",function(e){b.setNewMonth(a(this).val())});a(document).delegate("body > div.UXCCalendar button.UConfirm","click",function(e){var g=a(this).parents("div.UXCCalendar"),f;if(g.length&&(f=g.find("td.cur")).length){if(f.hasClass("unable")){return}}g.length&&g.data("confirmMethod")&&g.data("confirmMethod")(this);c.hide()});a(document).delegate("map[name=UXCCalendar_Year] area","click",function(f){f.preventDefault();var e=a(this),g=b.lastDateObj;if(!(g&&e.attr("action"))){return}if(e.attr("action").toLowerCase()=="up"){g.date.setFullYear(g.date.getFullYear()+1)}else{if(e.attr("action").toLowerCase()=="down"){g.date.setFullYear(g.date.getFullYear()-1)}}b.initDateLayout(g);UXC.log(e.attr("action"))});a(document).delegate("map[name=UXCCalendar_Month] area","click",function(f){f.preventDefault();var e=a(this),g=b.lastDateObj;if(!(g&&e.attr("action"))){return}if(e.attr("action").toLowerCase()=="up"){g.date.setMonth(g.date.getMonth()+1);g.initMinvalue.setMonth(g.initMinvalue.getMonth()+1);g.initMaxvalue.setMonth(g.initMaxvalue.getMonth()+1)}else{if(e.attr("action").toLowerCase()=="down"){g.date.setMonth(g.date.getMonth()-1);g.initMinvalue.setMonth(g.initMinvalue.getMonth()-1);g.initMaxvalue.setMonth(g.initMaxvalue.getMonth()-1)}}b.initDateLayout(g);UXC.log(e.attr("action"))});a(document).delegate("body > div.UXCCalendar button.UClear","click",function(e){c.lastIpt&&c.lastIpt.length&&c.lastIpt.val("")});a(document).delegate("body > div.UXCCalendar button.UCancel","click",function(e){c.hide()});a(document).on("click",function(f){var e=f.target||f.srcElement;if(c.domClickFilter){if(c.domClickFilter(a(e))===false){return}}if(c.isCalendarElement(f.target||f.targetElement)){return}if(e&&e.nodeName.toLowerCase()!="input"){c.hide();return}setTimeout(function(){if(c.lastIpt&&c.lastIpt.length&&e==c.lastIpt[0]){return}c.hide()},100)});a(document).delegate("input.UXCCalendar_btn","click",function(e){if(this.forCalendar){c.pickDate(this.forCalendar)}});a(document).delegate("input[datatype=date], input[datatype=daterange], input[multidate]","focus",function(e){c.pickDate(this)});a(document).delegate("body > div.UXCCalendar","click",function(e){e.stopPropagation()});a(document).delegate("#UXCCalendar table a","click",function(f){f.preventDefault();var e=a(this),g=e.attr("date")||"";if(!g){return}if(e.parent("td").hasClass("unable")){return}UXC.log(g);b.setDate(g);c.hide()});a(window).on("scroll resize",function(f){var e=a("body > div.UXCCalendar:visible");if(!(e.length&&c.lastIpt)){return}c.setPosition(c.lastIpt,e)})})}(jQuery));(function(b){UXC.Calendar.pickWeek=function(d){c.lastDateObj=UXC.Calendar.getDate(d);UXC.Calendar.lastIpt=d;UXC.Calendar.setPosition(d,c.update(c.lastDateObj))};UXC.Calendar.pickWeek.tpl="";UXC.Calendar.pickWeek.dayOffset=1;var c={getLayout:function(){var d;if(!(d=b("#UXCCalendar_week")).length){d=b(UXC.Calendar.pickWeek.tpl||c.tpl);d.appendTo(document.body);d.data("confirmMethod",c.onConfirm);d.data("updateYearMethod",c.updateYear);d.data("nextYearMethod",c.nextYear);d.data("preYearMethod",c.preYear)}return d},onConfirm:function(){UXC.log("Calendar.pickWeek, onConfirm");var d=c.getLayout().find("td.cur");if(!d.length){c.getLayout().find("td.today")}if(d.length){d.find("a").trigger("click")}},updateYear:function(d){if(!c.lastDateObj){return}c.lastDateObj.date.setFullYear(d);UXC.Calendar.updateInitYearList(c.lastDateObj);c.update(c.lastDateObj)},nextYear:function(){UXC.log("nextYearMethod");if(!c.lastDateObj){return}c.updateYear(c.lastDateObj.date.getFullYear()+1)},preYear:function(){UXC.log("preYearMethod");if(!c.lastDateObj){return}c.updateYear(c.lastDateObj.date.getFullYear()-1)},update:function(d){c.getLayout();c.updateHead(d);c.updateBody(d);return c.getLayout()},updateHead:function(h){var k=c.getLayout(),g=[],e,d,m=h.initMinvalue.getFullYear(),f=h.initMaxvalue.getFullYear();if(!d){d=h.date.getFullYear()}for(var l=m;l<=f;l++){e="";if(d===l){e=" selected "}g.push('<option value="'+l+'"'+e+">"+l+"</option>")}b(g.join("")).appendTo(k.find("select.UYear").html(""))},updateBody:function(k){var t=k.date;var s=c.getLayout();s.find("button.UYearButton").html(t.getFullYear());var r=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime();var d=a(t.getFullYear(),UXC.Calendar.pickWeek.dayOffset);var e=a(t.getFullYear()+1,UXC.Calendar.pickWeek.dayOffset);var m=0;var f=[],o,g,l,q,p,n=t.getFullYear(),h=Math.ceil(d.length/8);f.push("<tr>");for(i=1,j=h*8;i<=j;i++){g=d[i-1];if(!g){g=e[m++];n=t.getFullYear()+1}q=new Date();p=new Date();q.setTime(g.start);p.setTime(g.end);l=printf("{0}年 第{1}周<br/>开始日期: {2} (周{4})<br />结束日期: {3} (周{5})",n,UXC.Calendar.getCnNum(g.week),formatISODate(q),formatISODate(p),UXC.Calendar.cnWeek.charAt(q.getDay()%7),UXC.Calendar.cnWeek.charAt(p.getDay()%7));o=[];if(k.minvalue&&q.getTime()<k.minvalue.getTime()){o.push("unable")}if(k.maxvalue&&p.getTime()>k.maxvalue.getTime()){o.push("unable")}if(t.getTime()>=q.getTime()&&t.getTime()<=p.getTime()){o.push("cur")}if(r>=q.getTime()&&r<=p.getTime()){o.push("today")}f.push(printf('<td class="{0}"><a href="javascript:" title="{2}" dstart="{3}" dend="{4}" week="{1}" >{1}</a></td>',o.join(" "),g.week,l,q.getTime(),p.getTime()));if(i%8===0&&i!=j){f.push("</tr><tr>")}}f.push("</tr>");s.find("table.UTableBorder tbody").html(b(f.join("")))},lastDateObj:null,tpl:['<div id="UXCCalendar_week" class="UXCCalendar UXCCalendar_week" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("")};function a(k,g){var f=[],e,d=1,g=g||0,k=parseInt(k,10),h=new Date(k,0,1);h.getDay()>1&&h.setDate(h.getDate()-h.getDay()+7);g>0&&(g=(new Date(2000,1,2)-new Date(2000,1,1))*g);while(h.getFullYear()<=k){e={week:d++,start:null,end:null};e.start=h.getTime()+g;h.setDate(h.getDate()+6);e.end=h.getTime()+g;h.setDate(h.getDate()+1);if(h.getFullYear()>k){h=new Date(h.getFullYear(),0,1);if(h.getDay()<2){break}}f.push(e)}return f}b(document).delegate("#UXCCalendar_week table a","click",function(g){var d=b(this),f=new Date(),e=new Date();if(!UXC.Calendar.lastIpt){return}if(d.parent("td").hasClass("unable")){return}f.setTime(d.attr("dstart"));e.setTime(d.attr("dend"));UXC.Calendar.lastIpt.val(printf("{0} 至 {1}",formatISODate(f),formatISODate(e)));UXC.Calendar.hide()})}(jQuery));(function(a){UXC.Calendar.pickMonth=function(c){b.lastDateObj=UXC.Calendar.getDate(c);UXC.Calendar.lastIpt=c;UXC.Calendar.setPosition(c,b.update(b.lastDateObj))};UXC.Calendar.pickMonth.tpl="";var b={getLayout:function(){var c;if(!(c=a("#UXCCalendar_month")).length){c=a(UXC.Calendar.pickMonth.tpl||b.tpl);c.appendTo(document.body);c.data("confirmMethod",b.onConfirm);c.data("updateYearMethod",b.updateYear);c.data("nextYearMethod",b.nextYear);c.data("preYearMethod",b.preYear)}return c},onConfirm:function(){UXC.log("Calendar.pickMonth, onConfirm");var c=b.getLayout().find("td.cur");if(!c.length){b.getLayout().find("td.today")}if(c.length){c.find("a").trigger("click")}},updateYear:function(c){if(!b.lastDateObj){return}b.lastDateObj.date.setFullYear(c);UXC.Calendar.updateInitYearList(b.lastDateObj);b.update(b.lastDateObj)},nextYear:function(){UXC.log("nextYearMethod");if(!b.lastDateObj){return}b.updateYear(b.lastDateObj.date.getFullYear()+1)},preYear:function(){UXC.log("preYearMethod");if(!b.lastDateObj){return}b.updateYear(b.lastDateObj.date.getFullYear()-1)},update:function(c){b.getLayout();b.updateHead(c);b.updateBody(c);return b.getLayout()},updateHead:function(l){var d=b.getLayout(),h=[],g,f,e=l.initMinvalue.getFullYear(),k=l.initMaxvalue.getFullYear();if(!f){f=l.date.getFullYear()}for(var c=e;c<=k;c++){g="";if(f===c){g=" selected "}h.push('<option value="'+c+'"'+g+">"+c+"</option>")}a(h.join("")).appendTo(d.find("select.UYear").html(""))},updateBody:function(k){var g=k.date;var c=b.getLayout();c.find("button.UYearButton").html(g.getFullYear());var n=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime();var o=[],f,p,m,h,l,e,d=g.getFullYear();o.push("<tr>");for(i=1,j=12;i<=j;i++){h=new Date(d,i-1,1);l=new Date(d,i-1,maxDayOfMonth(h));m=printf("{0}年 {1}月<br/>开始日期: {2} (周{4})<br />结束日期: {3} (周{5})",d,UXC.Calendar.getCnNum(i),formatISODate(h),formatISODate(l),UXC.Calendar.cnWeek.charAt(h.getDay()%7),UXC.Calendar.cnWeek.charAt(l.getDay()%7));f=[];if(k.minvalue&&h.getTime()<k.minvalue.getTime()){f.push("unable")}if(k.maxvalue&&l.getTime()>k.maxvalue.getTime()){f.push("unable")}if(g.getTime()>=h.getTime()&&g.getTime()<=l.getTime()){f.push("cur")}if(n>=h.getTime()&&n<=l.getTime()){f.push("today")}e=UXC.Calendar.cnUnit.charAt(i%10);i>10&&(e="十"+e);o.push(printf('<td class="{0}"><a href="javascript:" title="{1}" dstart="{3}" dend="{4}" month="{5}" >{2}月</a></td>',f.join(" "),m,e,h.getTime(),l.getTime(),i));if(i%3===0&&i!=j){o.push("</tr><tr>")}}o.push("</tr>");c.find("table.UTableBorder tbody").html(a(o.join("")))},lastDateObj:null,tpl:['<div id="UXCCalendar_month" class="UXCCalendar UXCCalendar_week UXCCalendar_month" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("")};a(document).delegate("#UXCCalendar_month table a","click",function(f){var c=a(this),e=new Date(),d=new Date();if(!UXC.Calendar.lastIpt){return}if(c.parent("td").hasClass("unable")){return}e.setTime(c.attr("dstart"));d.setTime(c.attr("dend"));UXC.Calendar.lastIpt.val(printf("{0} 至 {1}",formatISODate(e),formatISODate(d)));UXC.Calendar.hide()})}(jQuery));(function(a){UXC.Calendar.pickSeason=function(c){b.lastDateObj=UXC.Calendar.getDate(c);UXC.Calendar.lastIpt=c;UXC.Calendar.setPosition(c,b.update(b.lastDateObj))};UXC.Calendar.pickSeason.tpl="";var b={getLayout:function(){var c;if(!(c=a("#UXCCalendar_season")).length){c=a(UXC.Calendar.pickSeason.tpl||b.tpl);c.appendTo(document.body);c.data("confirmMethod",b.onConfirm);c.data("updateYearMethod",b.updateYear);c.data("nextYearMethod",b.nextYear);c.data("preYearMethod",b.preYear)}return c},onConfirm:function(){UXC.log("Calendar.pickSeason, onConfirm");var c=b.getLayout().find("td.cur");if(!c.length){b.getLayout().find("td.today")}if(c.length){c.find("a").trigger("click")}},updateYear:function(c){if(!b.lastDateObj){return}b.lastDateObj.date.setFullYear(c);UXC.Calendar.updateInitYearList(b.lastDateObj);b.update(b.lastDateObj)},nextYear:function(){UXC.log("nextYearMethod");if(!b.lastDateObj){return}b.updateYear(b.lastDateObj.date.getFullYear()+1)},preYear:function(){UXC.log("preYearMethod");if(!b.lastDateObj){return}b.updateYear(b.lastDateObj.date.getFullYear()-1)},update:function(c){b.getLayout();b.updateHead(c);b.updateBody(c);return b.getLayout()},updateHead:function(l){var d=b.getLayout(),h=[],g,f,e=l.initMinvalue.getFullYear(),k=l.initMaxvalue.getFullYear();if(!f){f=l.date.getFullYear()}for(var c=e;c<=k;c++){g="";if(f===c){g=" selected "}h.push('<option value="'+c+'"'+g+">"+c+"</option>")}a(h.join("")).appendTo(d.find("select.UYear").html(""))},updateBody:function(k){var g=k.date;var c=b.getLayout();c.find("button.UYearButton").html(g.getFullYear());var n=new Date(new Date().getFullYear(),new Date().getMonth(),new Date().getDate()).getTime();var o=[],f,p,m,h,l,e,d=g.getFullYear();o.push("<tr>");for(i=1,j=4;i<=j;i++){h=new Date(d,i*3-3,1);l=new Date(d,i*3-1,1);l.setDate(maxDayOfMonth(l));e=UXC.Calendar.cnUnit.charAt(i%10);i>10&&(e="十"+e);m=printf("{0}年 第{1}季度<br/>开始日期: {2} (周{4})<br />结束日期: {3} (周{5})",d,UXC.Calendar.getCnNum(i),formatISODate(h),formatISODate(l),UXC.Calendar.cnWeek.charAt(h.getDay()%7),UXC.Calendar.cnWeek.charAt(l.getDay()%7));f=[];if(k.minvalue&&h.getTime()<k.minvalue.getTime()){f.push("unable")}if(k.maxvalue&&l.getTime()>k.maxvalue.getTime()){f.push("unable")}if(g.getTime()>=h.getTime()&&g.getTime()<=l.getTime()){f.push("cur")}if(n>=h.getTime()&&n<=l.getTime()){f.push("today")}o.push(printf('<td class="{0}"><a href="javascript:" title="{1}" dstart="{3}" dend="{4}" month="{5}" >{2}季度</a></td>',f.join(" "),m,e,h.getTime(),l.getTime(),i));if(i%2===0&&i!=j){o.push("</tr><tr>")}}o.push("</tr>");c.find("table.UTableBorder tbody").html(a(o.join("")))},lastDateObj:null,tpl:['<div id="UXCCalendar_season" class="UXCCalendar UXCCalendar_week UXCCalendar_season" >','    <div class="UHeader">','        <button type="button" class="UButton UNextYear">&nbsp;&gt;&gt;&nbsp;</button>','        <button type="button" class="UButton UPreYear">&nbsp;&lt;&lt;&nbsp;</button>','        <select class="UYear" style=""></select>',"    </div>",'    <table class="UTable UTableBorder">',"        <tbody></tbody>","    </table>",'    <div class="UFooter">','        <button type="button" class="UConfirm">确定</button>','        <button type="button" class="UClear">清空</button>','        <button type="button" class="UCancel">取消</button>',"    </div>","</div>"].join("")};a(document).delegate("#UXCCalendar_season table a","click",function(f){var c=a(this),e=new Date(),d=new Date();if(!UXC.Calendar.lastIpt){return}if(c.parent("td").hasClass("unable")){return}e.setTime(c.attr("dstart"));d.setTime(c.attr("dend"));UXC.Calendar.lastIpt.val(printf("{0} 至 {1}",formatISODate(e),formatISODate(d)));UXC.Calendar.hide()})}(jQuery));