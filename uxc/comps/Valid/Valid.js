(function(f){!window.UXC&&(window.UXC={log:function(){}});var d=UXC.Valid=window.Valid={check:function(j){var i=true,j=f(j),b=j.length?j.prop("nodeName").toLowerCase():"";if(j.length){if(b=="form"){for(var a=0,c=j[0].length;a<c;a++){!e.parse(f(j[0][a]))&&(i=false)}}else{i=e.parse(j)}}return i},clearError:function(a){f(a).each(function(){var j=f(this);UXC.log("clearError: "+j.prop("nodeName"));switch(j.prop("nodeName").toLowerCase()){case"form":for(var b=0,i=j[0].length;b<i;b++){var c=f(j[0][b]);if(c.is("[disabled]")){return}e.valid(c)}break;default:e.valid(f(this));break}})}};d.checkAll=d.check;f(document).delegate("input[type=text], input[type=password], textarea","blur",function(a){UXC.Valid.check(this)});f(document).delegate("select, input[type=file]","change",function(a){UXC.Valid.check(this)});var e={parse:function(b){var a=true,b=f(b);b.each(function(){if(!e.isValidItem(this)){return}var c=f(this),j=e.getDatatype(c),i=e.getSubdatatype(c);if(c.is("[disabled]")){return}UXC.log(j,i);if(c.is("[reqmsg]")){if(!e.datatype.reqmsg(c)){a=false;return}}if(!e.datatype.length(c)){a=false;return}if(j in e.datatype&&c.val()){if(!e.datatype[j](c)){a=false;return}}if(i&&i in e.subdatatype&&(c.val()||i=="alternative")){if(!e.subdatatype[i](c)){a=false;return}}e.valid(c)});return a},isValidItem:function(a){a=f(a);var b,c;a.each(function(){c=f(this);if(c.is("[datatype]")||c.is("[subdatatype]")||c.is("[minlength]")||c.is("[maxlength]")||c.is("[reqmsg]")){b=true}});return b},valid:function(a){if(!e.isValidItem(a)){return}a.removeClass("error");a.find("~ em").show();a.find("~ em.error").hide()},error:function(a,b,c){if(!e.isValidItem(a)){return}var i=e.getMsg.apply(null,[].slice.call(arguments)),j;a.addClass("error");a.find("~ em:not(.error)").hide();if(a.is("[emEl]")){(j=e.getElement(a.attr("emEl")))&&j.length&&j.addClass("error")}!(j&&j.length)&&(j=a.find("~ em.error"));if(!j.length){(j=f('<em class="error"></em>')).insertAfter(a)}UXC.log("error: "+i);j.html(i).show();return false},getElement:function(a){if(/^[\w-]+$/.test(a)){a="#"+a}return f(a)},getDatatype:function(a){return(a.attr("datatype")||"text").toLowerCase().replace(/\-.*/,"")},getSubdatatype:function(a){return(a.attr("subdatatype")||"text").toLowerCase().replace(/\-.*/,"")},getMsg:function(h,a,b){var c=h.is("[errmsg]")?" "+h.attr("errmsg"):h.is("[reqmsg]")?h.attr("reqmsg"):"";a&&(c=h.attr(a)||c);b&&c&&(c=" "+c);if(c&&!/^[\s]/.test(c)){switch(h.prop("type").toLowerCase()){case"file":c="请上传"+c;break;case"select-multiple":case"select-one":case"select":c="请选择"+c;break;case"textarea":case"password":case"text":c="请填写"+c;break}}UXC.log("_msg: "+c,h.prop("type").toLowerCase());return f.trim(c)},bytelen:function(a){return a.replace(/[^\x00-\xff]/g,"11").length},getTimestamp:function(a){a=a.replace(/[^\d]/g,"");return new Date(a.slice(0,4),parseInt(a.slice(4,6),10)-1,a.slice(6,8)).getTime()},subdatatype:{alternative:function(h){var c=true,a;UXC.log("alternative");if(h.is("[datatarget]")&&(a=f(h.attr("datatarget"))).length&&!h.val()){var b=false;a.each(function(){if(f(this).val()){b=true;return false}});c=b}!c&&e.error(h,"alternativemsg",true);!c&&a&&a.length&&a.each(function(){e.error(f(this),"alternativemsg",true)});c&&a&&a.length&&a.each(function(){e.valid(f(this))});return c},reconfirm:function(c){var b=true,a;UXC.log("reconfirm");if(c.is("[datatarget]")&&(a=f(c.attr("datatarget"))).length){a.each(function(){if(c.val()!=f(this).val()){return b=false}})}!b&&e.error(c,"reconfirmmsg",true);!b&&a.length&&a.each(function(){e.error(f(this),"reconfirmmsg",true)});b&&a.length&&a.each(function(){e.valid(f(this))});return b}},datatype:{n:function(m){var a=true,c=m.val(),q=+c,o=0,b=Math.pow(10,10),r,p,n;if(!isNaN(q)&&q>=0){m.attr("datatype").replace(/^n\-(.*)$/,function(g,h){n=h.split(".");r=n[0];p=n[1]});if(m.is("[minvalue]")){o=+m.attr("minvalue")||o}if(m.is("[maxvalue]")){b=+m.attr("maxvalue")||b}if(q>=o&&q<=b){typeof r!="undefined"&&typeof p!="undefined"&&(a=new RegExp("^(?:[\\d]{0,"+r+"}|)(?:\\.[\\d]{1,"+p+"}|)$").test(c));typeof r!="undefined"&&typeof p=="undefined"&&(a=new RegExp("^[\\d]{1,"+r+"}$").test(c));typeof r=="undefined"&&typeof p!="undefined"&&(a=new RegExp("^\\.[\\d]{1,"+p+"}$").test(c));typeof p=="undefined"&&/\./.test(c)&&(a=false)}else{a=false}UXC.log("nValid",q,typeof r,typeof p,typeof o,typeof b,o,b)}else{a=false}!a&&e.error(m);return a},d:function(k){var l=k.val().trim(),a,m=/^[\d]{4}([\/.-]|)[01][\d]\1[0-3][\d]$/;if(!l){return true}if(a=m.test(l)){var n=e.getTimestamp(k.val()),c,b;if(k.is("[minvalue]")&&(a=m.test(k.attr("minvalue")))){c=e.getTimestamp(k.attr("minvalue"));n<c&&(a=false)}if(a&&k.is("[maxvalue]")&&(a=m.test(k.attr("maxvalue")))){b=e.getTimestamp(k.attr("maxvalue"));n>b&&(a=false)}}!a&&e.error(k);return a},daterange:function(j){var k=e.datatype.d(j),a,c;if(k){if(k){var b,l;if(j.is("[fromDateEl]")){b=e.getElement(j.attr("fromDateEl"))}if(j.is("[toDateEl]")){l=e.getElement(j.attr("toDateEl"))}if(b&&b.length||l&&l.length){b&&b.length&&!(l&&l.length)&&(l=j);!(b&&b.length)&&l&&l.length&&(b=j);UXC.log("daterange",b.length,l.length);if(l[0]!=b[0]){k&&(k=e.datatype.d(l));k&&(k=e.datatype.d(b));k&&e.getTimestamp(b.val())>e.getTimestamp(l.val())&&(k=false);k&&e.valid(b);k&&e.valid(l)}}}}!k&&e.error(j);return k},time:function(b){var a=/^(([0-1]\d)|(2[0-3])):[0-5]\d:[0-5]\d$/.test(b.val());!a&&e.error(b);return a},minute:function(b){var a=/^(([0-1]\d)|(2[0-3])):[0-5]\d$/.test(b.val());!a&&e.error(b);return a},bankcard:function(b){var a=/^[1-9][\d]{3}(?: |)(?:[\d]{4}(?: |))(?:[\d]{4}(?: |))(?:[\d]{4})(?:(?: |)[\d]{3}|)$/.test(b.val());!a&&e.error(b);return a},cnname:function(b){var a=e.bytelen(b.val())<32&&/^[\u4e00-\u9fa5a-zA-Z.\u3002\u2022]{2,32}$/.test(b.val());!a&&e.error(b);return a},username:function(b){var a=/^[a-zA-Z0-9][\w-]{2,29}$/.test(b.val());!a&&e.error(b);return a},idnumber:function(b){var a=/^[0-9]{15}(?:[0-9]{2}(?:[0-9xX]|)|)$/.test(b.val());!a&&e.error(b);return a},mobilecode:function(b){var a=/^(?:13|14|15|16|18|19)\d{9}$/.test(b.val());!a&&e.error(b);return a},mobilezonecode:function(b){var a=/^(?:\+[0-9]{1,6} |)(?:0|)(?:13|14|15|16|18|19)\d{9}$/.test(b.val());!a&&e.error(b);return a},phone:function(b){var a=/^(?:0(?:10|2\d|[3-9]\d\d)(?: |\-|)|)[1-9]\d{6,7}$/.test(b.val());!a&&e.error(b);return a},phoneall:function(b){var a=/^(?:\+[\d]{1,6}(?: |\-)|)(?:0[\d]{2,3}(?:\-| |)|)[1-9][\d]{6,7}(?:(?: |)\#[\d]{1,6}|)$/.test(b.val());!a&&e.error(b);return a},phonezone:function(b){var a=/^[0-9]{3,4}$/.test(b.val());!a&&e.error(b);return a},phonecode:function(b){var a=/^[0-9]{7,8}$/.test(b.val());!a&&e.error(b);return a},phoneext:function(b){var a=/^[0-9]{1,6}$/.test(b.val());!a&&e.error(b);return a},length:function(c){var m=true,a=e.getDatatype(c),b,k,l=c.val(),n;if(c.is("[minlength]")){UXC.log("minlength");b=parseInt(c.attr("minlength"),10)||0}if(c.is("[maxlength]")){UXC.log("maxlength");k=parseInt(c.attr("maxlength"),10)||0}switch(a){case"richtext":case"bytetext":n=e.bytelen(l);break;default:n=l.length;break}b&&(n<b)&&(m=false);k&&(n>k)&&(m=false);UXC.log("lengthValid: ",b,k,m);!m&&e.error(c);return m},reqmsg:function(b){var a;if(b.val()&&b.val().constructor==Array){a=!!((b.val().join("")+"").trim())}else{a=!!f.trim(b.val()||"")}!a&&e.error(b,"reqmsg");UXC.log("regmsgValid: "+a);return a},reg:function(c){var b=true,a;if(c.is("[reg-pattern]")){a=c.attr("reg-pattern")}if(!a){a=f.trim(c.attr("datatype")).replace(/^reg(?:\-|)/i,"")}a.replace(/^\/([\s\S]*)\/([\w]{0,3})$/,function(k,l,j){UXC.log(l,j);b=new RegExp(l,j||"").test(c.val())});!b&&e.error(c);return b},vcode:function(c){var b,a=parseInt(c.attr("datatype").trim().replace(/^vcode(?:\-|)/i,""),10)||4;UXC.log("vcodeValid: "+a);b=new RegExp("^[0-9a-zA-Z]{"+a+"}$").test(c.val());!b&&e.error(c);return b},text:function(a){return true},bytetext:function(a){return true},richtext:function(a){return true},url:function(b){var a=/^((http|ftp|https):\/\/|)[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])$/.test(b.val());!a&&e.error(b);return a},domain:function(b){var a=/^(?:(?:f|ht)tp\:\/\/|)((?:(?:(?:\w[\.\-\+]?)*)\w)*)((?:(?:(?:\w[\.\-\+]?){0,62})\w)+)\.(\w{2,6})(?:\/|)$/.test(b.val());!a&&e.error(b);return a},email:function(b){var a=/^[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(b.val());!a&&e.error(b);return a},zipcode:function(b){var a=/^[0-9]{6}$/.test(b.val());!a&&e.error(b);return a}}}}(jQuery));